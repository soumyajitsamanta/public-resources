head	1.2;
access;
symbols
	jpivot_1_8_0:1.2
	focus_1_6_0:1.2.0.4
	jpivot_1_7_0:1.2
	jpivot_1_6_0:1.2
	jpivot_1_5_0:1.2.0.2
	Root_jpivot_1_5_0:1.2
	mondrian_xmla_2005_08_25:1.1.0.2
	sourceforge_sync:1.2;
locks; strict;
comment	@# @;
expand	@k@;


1.2
date	2005.12.13.11.56.41;	author avix;	state Exp;
branches;
next	1.1;

1.1
date	2005.07.05.14.19.50;	author avix;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Synchronized with Tonbeller CVS:
  * Supports Mondrian 2.x API
  * Added BEA / Websphere Support
  * More tags in wcf tag library
  * Bugfixes
@
text
@package com.tonbeller.jpivot.mondrian;

import com.tonbeller.jpivot.olap.model.OlapException;
import com.tonbeller.tbutils.res.Resources;

/**
 * provide settings for test environment
 */
public class TestConnection {
  static Resources res = Resources.instance();

  public static String getConnectString() {
    String catalog = res.getString("catalog.uri");
    if (catalog == null)
      throw new RuntimeException(
          "missing system property \"catalog.uri\", e.g. -Dcatalog.uri=file:///c:/dev/mondrian/demo/FoodMart.xml");
    return getConnectString(catalog);
  }

  public static String getConnectString(String catUri) {
    String jdbcUrl = res.getString("jdbc.url");
    String jdbcUser = res.getString("jdbc.user");
    String jdbcPassword = res.getString("jdbc.password");

    StringBuffer con = new StringBuffer();
    con.append("provider=Mondrian;");
    con.append("Jdbc=");
    con.append(jdbcUrl);
    con.append(";Catalog=");
    con.append(catUri);
    if (jdbcUser.length() > 0)
      con.append(";JdbcUser=").append(jdbcUser);
    if (jdbcPassword.length() > 0)
      con.append(";JdbcPassword=").append(jdbcPassword);

    return con.toString();
  }

  public static String getJdbcDriver() {
    return res.getString("jdbc.driver");
  }

  public static void initModel(MondrianModel model) throws OlapException {
    String connectString = getConnectString();
    model.setConnectString(connectString);
    String jdbcDriver = getJdbcDriver();
    model.setJdbcDriver(jdbcDriver);
    model.initialize();
  }
}@


1.1
log
@initial version
@
text
@d4 1
d10 2
d13 1
a13 1
    String catalog = System.getProperty("catalog.uri");
d21 3
a23 5
    String jdbcUrl = System.getProperty("jdbc.url", "jdbc:odbc:MondrianFoodMart");
    //String jdbcUrl = System.getProperty("jdbc.url",
    // "jdbc:mysql://localhost/foodmart");
    String jdbcUser = System.getProperty("jdbc.user", "");
    String jdbcPassword = System.getProperty("jdbc.password", "");
a25 1

a30 1

d40 1
a40 2
    String jdbcDriver = System.getProperty("jdbc.driver", "sun.jdbc.odbc.JdbcOdbcDriver");
    return jdbcDriver;
@

