head	1.2;
access;
symbols
	jpivot_1_8_0:1.1
	focus_1_6_0:1.1.0.6
	wcf_1_7_0:1.1
	wcf_1_6_0:1.1
	jpivot_1_5_0:1.1.0.4
	Root_jpivot_1_5_0:1.1
	mondrian_xmla_2005_08_25:1.1.0.2
	sourceforge_sync:1.1;
locks; strict;
comment	@# @;


1.2
date	2009.12.18.19.45.33;	author willgorman;	state Exp;
branches;
next	1.1;

1.1
date	2005.07.05.14.08.04;	author avix;	state Exp;
branches;
next	;


desc
@@


1.2
log
@renamed getBookmarkState to retrieveBookmarkState so that JPivot works with beanutils-1.8
@
text
@/*
 * ====================================================================
 * This software is subject to the terms of the Common Public License
 * Agreement, available at the following URL:
 *   http://www.opensource.org/licenses/cpl.html .
 * Copyright (C) 2003-2004 TONBELLER AG.
 * All Rights Reserved.
 * You must accept the terms of that agreement to use this software.
 * ====================================================================
 *
 * 
 */
package com.tonbeller.wcf.bookmarks;

import java.util.Collections;
import java.util.Enumeration;
import java.util.HashMap;
import java.util.Iterator;
import java.util.Map;

import javax.servlet.http.HttpSession;

/**
 * @@author av
 */
public class BookmarkManager {
  private HttpSession session;
  private Map state = Collections.EMPTY_MAP;
  private static final String WEBKEY = BookmarkManager.class.getName();

  /** session singleton */
  BookmarkManager(HttpSession session) {
    this.session = session;
  }

  public static BookmarkManager instance(HttpSession session) {
    BookmarkManager bm = (BookmarkManager) session.getAttribute(WEBKEY);
    if (bm == null) {
      bm = new BookmarkManager(session);
      session.setAttribute(WEBKEY, bm);
    }
    return bm;
  }

  /**
   * collects tht state of all Bookmarkable Session Attributes
   * @@return memento object
   */
  public Object collectSessionState(int levelOfDetail) {
    Map map = new HashMap();
    for (Enumeration en = session.getAttributeNames(); en.hasMoreElements();) {
      String name = (String) en.nextElement();
      Object attr = session.getAttribute(name);
      if (attr instanceof Bookmarkable) {
        Object value = ((Bookmarkable) attr).retrieveBookmarkState(levelOfDetail);
        if (value != null)
          map.put(name, value);
      }
    }
    return map;
  }

  /**
   * restores the State of all Bookmarkable Session Atributes
   * @@param memento created by collectBookmarkState()
   * @@see #collectBookmarkState
   */
  public void restoreSessionState(Object memento) {
    // no bookmark state?
    if (memento == null) {
      state = Collections.EMPTY_MAP;
      return;
    }
    state = (Map) memento;
    for (Iterator it = state.keySet().iterator(); it.hasNext();) {
      String name = (String) it.next();
      restoreAttributeState(name);
    }
  }

  /**
   * restores bookmark state for a single session attribute.
   * This is used
   * for objects that were created after restoreSessionState() was called.
   * (e.g. via jsp tags on different jsp pages).
   * @@param name name of the session attribute
   */
  public void restoreAttributeState(String name) {
    Object attr = session.getAttribute(name);
    if (attr instanceof Bookmarkable) {
      Object value = state.get(name);
      if (value != null)
         ((Bookmarkable) attr).setBookmarkState(value);
    }
  }
}
@


1.1
log
@initial version
@
text
@d55 1
a55 1
        Object value = ((Bookmarkable) attr).getBookmarkState(levelOfDetail);
@

