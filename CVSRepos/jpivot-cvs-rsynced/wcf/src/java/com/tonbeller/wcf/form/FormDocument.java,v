head	1.3;
access;
symbols
	jpivot_1_8_0:1.3
	focus_1_6_0:1.3.0.2
	wcf_1_7_0:1.3
	wcf_1_6_0:1.3
	jpivot_1_5_0:1.2.0.2
	Root_jpivot_1_5_0:1.2
	mondrian_xmla_2005_08_25:1.1.0.2
	sourceforge_sync:1.3;
locks; strict;
comment	@# @;


1.3
date	2006.11.09.13.24.04;	author avix;	state Exp;
branches;
next	1.2;

1.2
date	2005.12.13.11.54.18;	author avix;	state Exp;
branches;
next	1.1;

1.1
date	2005.07.05.14.04.35;	author avix;	state Exp;
branches;
next	;


desc
@@


1.3
log
@synchronized with tonbeller cvs
@
text
@package com.tonbeller.wcf.form;

import java.net.MalformedURLException;
import java.net.URL;
import java.util.Locale;
import java.util.MissingResourceException;
import java.util.ResourceBundle;

import org.w3c.dom.Document;

import com.tonbeller.tbutils.res.Resources;
import com.tonbeller.wcf.controller.RequestContext;
import com.tonbeller.wcf.utils.I18nReplacer;
import com.tonbeller.wcf.utils.ResourceLocator;
import com.tonbeller.wcf.utils.XmlUtils;

/**
 * Loads an xml document and replaces locale dependant labels 
 */
public class FormDocument {

  /**
   * Shortcut for replaceI18N(parseDocument())
   */
  public static Document loadDocument(RequestContext context, String bundle, String name) throws MalformedURLException, MissingResourceException {
    Document doc = parseDocument(context, name);
    replaceI18n(context, doc, bundle);
    return doc;
  }
  
  /**
   * replaces attr value "fmt:xxx" with string for key "xxx" from resource bundle.
   */
  public static void replaceI18n(RequestContext context, Document dom, String bundle)
      throws MissingResourceException {

    String bundleAttr = dom.getDocumentElement().getAttribute("bundle");
    if (bundleAttr.length() > 0) {
      bundle = bundleAttr;
    }

    if (bundle != null) {
      Locale loc = context.getLocale();
      ResourceBundle resb = ResourceBundle.getBundle(bundle, loc);
      I18nReplacer replacer = I18nReplacer.instance(resb);
      replacer.replaceAll(dom);
    } else {
      Resources res = context.getResources();
      I18nReplacer replacer = I18nReplacer.instance(res);
      replacer.replaceAll(dom);
    }
  }

  public static Document parseDocument(RequestContext context, String name) throws MalformedURLException,
      MissingResourceException {

    Locale loc = context.getLocale(); // Default: browser setting
    URL url = ResourceLocator.getResource(context.getServletContext(), loc, name);
    return XmlUtils.parse(url);
  }

}@


1.2
log
@Synchronized with Tonbeller CVS:
  * Added BEA / Websphere Support
  * More tags in wcf tag library
  * Bugfixes
@
text
@d11 1
d47 4
@


1.1
log
@initial version
@
text
@d35 6
@

