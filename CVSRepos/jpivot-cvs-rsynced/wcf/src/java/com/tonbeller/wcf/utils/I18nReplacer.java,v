head	1.2;
access;
symbols
	jpivot_1_8_0:1.2
	focus_1_6_0:1.2.0.2
	wcf_1_7_0:1.2
	wcf_1_6_0:1.2
	jpivot_1_5_0:1.1.0.4
	Root_jpivot_1_5_0:1.1
	mondrian_xmla_2005_08_25:1.1.0.2
	sourceforge_sync:1.2;
locks; strict;
comment	@# @;


1.2
date	2006.11.09.13.24.05;	author avix;	state Exp;
branches;
next	1.1;

1.1
date	2005.07.05.14.04.32;	author avix;	state Exp;
branches;
next	;


desc
@@


1.2
log
@synchronized with tonbeller cvs
@
text
@/*
 * ====================================================================
 * This software is subject to the terms of the Common Public License
 * Agreement, available at the following URL:
 *   http://www.opensource.org/licenses/cpl.html .
 * Copyright (C) 2003-2004 TONBELLER AG.
 * All Rights Reserved.
 * You must accept the terms of that agreement to use this software.
 * ====================================================================
 *
 * 
 */
package com.tonbeller.wcf.utils;

import java.util.MissingResourceException;
import java.util.ResourceBundle;

import org.w3c.dom.Attr;
import org.w3c.dom.Element;
import org.w3c.dom.NamedNodeMap;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.w3c.dom.Text;


/**
 * replaces attribute values in a DOM tree with values from a resource bundle
 * Attribute value must start with "fmt:", e.g. "fmt:akey" will replace
 * the string "fmt:akey" with the value of found for "akey" in the resource
 * bundle.
 * 
 * @@author av
 */
public abstract class I18nReplacer {
  
  public static final String PREFIX = "fmt:";
  
  public static I18nReplacer instance(final ResourceBundle resb) {
    return new I18nReplacer() {
      protected String internalReplace(String key) {
        try {
          return resb.getString(key);
        } catch (MissingResourceException e) {
          return "???" + key + "???";
        }
      }
      
    };
  }

  public static I18nReplacer instance(final com.tonbeller.tbutils.res.Resources res) {
    return new I18nReplacer() {
      protected String internalReplace(String key) {
        try {
          return res.getString(key);
        } catch (MissingResourceException e) {
          return "???" + key + "???";
        }
      }
    };
  }
  
  protected abstract String internalReplace(String key);
  
  public String replace(String value) {
    if (value.startsWith(PREFIX)) {
      return internalReplace(value.substring(4));
    }
    return value;
  }
  
  public void replaceAll(Node root) {
    if (root.getNodeType() == Node.ELEMENT_NODE) {
      Element e = (Element) root;
      NamedNodeMap atts = e.getAttributes();
      final int N = atts.getLength();
      for (int i = 0; i < N; i++) {
        Attr attr = (Attr) atts.item(i);
        String value = attr.getValue();
        if (value.startsWith(PREFIX)) {
          value = internalReplace(value.substring(4));
          attr.setValue(value);
        }
      }
    }
    if (root.getNodeType() == Node.TEXT_NODE) {
      Text text = (Text) root;
      String data = text.getData();
      if (data.startsWith(PREFIX)) {
        data = internalReplace(data.substring(4));
        text.setData(data);
      }
    }
    NodeList list = root.getChildNodes();
    int N = list.getLength();
    for (int i = 0; i < N; i++)
      replaceAll(list.item(i));
  }
}
@


1.1
log
@initial version
@
text
@d40 1
a40 1
      protected String replace(String key) {
d53 1
a53 1
      protected String replace(String key) {
d63 8
a70 1
  protected abstract String replace(String key);
d81 1
a81 1
          value = replace(value.substring(4));
d90 1
a90 1
        data = replace(data.substring(4));
@

