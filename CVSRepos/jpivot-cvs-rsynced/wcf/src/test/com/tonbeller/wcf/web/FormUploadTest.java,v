head	1.2;
access;
symbols
	jpivot_1_8_0:1.2
	focus_1_6_0:1.2.0.2
	wcf_1_7_0:1.2
	wcf_1_6_0:1.2
	jpivot_1_5_0:1.1.0.4
	Root_jpivot_1_5_0:1.1
	mondrian_xmla_2005_08_25:1.1.0.2
	sourceforge_sync:1.2;
locks; strict;
comment	@# @;


1.2
date	2006.11.09.13.24.06;	author avix;	state Exp;
branches;
next	1.1;

1.1
date	2005.07.05.14.04.31;	author avix;	state Exp;
branches;
next	;


desc
@@


1.2
log
@synchronized with tonbeller cvs
@
text
@package com.tonbeller.wcf.web;

import java.io.IOException;

import javax.xml.transform.TransformerException;

import org.jaxen.JaxenException;
import org.xml.sax.SAXException;

import com.meterware.httpunit.GetMethodWebRequest;
import com.meterware.httpunit.UploadFileSpec;
import com.meterware.httpunit.WebForm;

/**
 * Adds file upload to form test. It is important to test all
 * control types since parameters are parsed with a different encoding
 */
public class FormUploadTest extends HttpUnitTestCase {

  public FormUploadTest(String arg0) {
    super(arg0);
  }

  private void check(String name, String id) throws JaxenException, IOException, SAXException,
      TransformerException {
    utils.check(name, "filter.xsl", id);
  }

  /**
   * run form tests w/o faces servlet. This tests WCF EL and navigation
   */
  public void testWcfForm() throws Exception {
    wc.sendRequest(new GetMethodWebRequest(servletUrl + "/uploaddemo.jsp"));
    runTests();
  }

  private void runTests() throws Exception {
    check("upload-01", "form01");
    WebForm wf = wc.getCurrentPage().getFormWithID("form01");
    String id = "uploadcomp"; 
    // ********* test valid input ****************
    wf.setParameter(id + ".string", "--ÄÖÜß--");
    wf.setParameter(id + ".int", "12");
    wf.setParameter(id + ".double", "123.456");
    wf.setParameter(id + ".date", "12/31/2003");
    wf.setParameter(id + ".password", "xxxx");
    wf.setParameter(id + ".textarea", "some\nmulti\nline\ntext\n");
    wf.setParameter(id + ".checkbox1", "x");
    wf.setParameter(id + ".checkbox2", "x");
    wf.setParameter(id + ".list1", id + ".list1.1");
    wf.setParameter(id + ".listN", new String[] { id + ".listN.1", id + ".listN.4"});
    wf.setParameter("group1", id + ".radio1");
    wf.submit(wf.getSubmitButtonWithID("uploadcomp.validate"));
    check("upload-02", "form01");

    // ******** test invalid input *************
    wf = wc.getCurrentPage().getFormWithID("form01");
    wf.setParameter(id + ".int", "nan");
    wf.setParameter(id + ".double", "nan");
    wf.setParameter(id + ".date", "nad");
    wf.submit(wf.getSubmitButtonWithID("uploadcomp.ok"));
    check("upload-03", "form01");
    wf.submit(wf.getSubmitButtonWithID("uploadcomp.revert"));
    check("upload-04", "form01");

    // ******** test upload *************
    UploadFileSpec fileSpec = new UploadFileSpec("uploadtest.txt", getClass().getResourceAsStream(
        "uploadtest.txt"), "text/plain");
    wf.setParameter(id + ".fileUpload1", new UploadFileSpec[] { fileSpec});
    wf.submit(wf.getSubmitButtonWithID("uploadcomp.validate"));
    check("upload-05", "uploadInfo");
  }

}@


1.1
log
@initial version
@
text
@d40 1
a40 1

d42 12
a53 12
    wf.setParameter("string", "--ÄÖÜß--");
    wf.setParameter("int", "12");
    wf.setParameter("double", "123.456");
    wf.setParameter("date", "12/31/2003");
    wf.setParameter("password", "xxxx");
    wf.setParameter("textarea", "some\nmulti\nline\ntext\n");
    wf.setParameter("checkbox1", "x");
    wf.setParameter("checkbox2", "x");
    wf.setParameter("list1", "list1.1");
    wf.setParameter("listN", new String[] { "listN.1", "listN.4"});
    wf.setParameter("group1", "radio1");
    wf.submit(wf.getSubmitButtonWithID("formcomp.validate"));
d58 4
a61 4
    wf.setParameter("int", "nan");
    wf.setParameter("double", "nan");
    wf.setParameter("date", "nad");
    wf.submit(wf.getSubmitButtonWithID("formcomp.ok"));
d63 1
a63 1
    wf.submit(wf.getSubmitButtonWithID("formcomp.revert"));
d69 2
a70 2
    wf.setParameter("fileUpload1", new UploadFileSpec[] { fileSpec});
    wf.submit(wf.getSubmitButtonWithID("formcomp.validate"));
@

