head	1.3;
access;
symbols
	jpivot_1_8_0:1.3
	focus_1_6_0:1.3.0.2
	wcf_1_7_0:1.3
	wcf_1_6_0:1.3
	jpivot_1_5_0:1.2.0.2
	Root_jpivot_1_5_0:1.2
	mondrian_xmla_2005_08_25:1.1.0.2
	sourceforge_sync:1.3;
locks; strict;
comment	@# @;


1.3
date	2006.11.09.13.24.06;	author avix;	state Exp;
branches;
next	1.2;

1.2
date	2005.09.14.08.22.46;	author avix;	state Exp;
branches;
next	1.1;

1.1
date	2005.07.05.14.04.31;	author avix;	state Exp;
branches;
next	;


desc
@@


1.3
log
@synchronized with tonbeller cvs
@
text
@package com.tonbeller.wcf.web;

import java.io.IOException;

import javax.xml.transform.TransformerException;

import org.jaxen.JaxenException;
import org.xml.sax.SAXException;

import com.meterware.httpunit.GetMethodWebRequest;
import com.meterware.httpunit.HttpUnitOptions;
import com.meterware.httpunit.WebForm;
import com.meterware.httpunit.WebLink;
import com.meterware.httpunit.WebResponse;

public class FormTest extends HttpUnitTestCase {

  public FormTest(String arg0) {
    super(arg0);
    HttpUnitOptions.setExceptionsThrownOnScriptError(false);
    HttpUnitOptions.setScriptingEnabled(false);
  }

  private void check(String name) throws JaxenException, IOException, SAXException, TransformerException {
    utils.check(name, "/com/tonbeller/wcf/web/form.xsl", "form01");
  }

  /**
   * BEA does not recognize the response charEncoding when including files,
   * so we tests &lt;c:import ../> here.
   */
  public void testCharEnc() throws Exception {
    wc.setHeaderField("accept-charset", "ISO-8859-1,utf-8;q=0.7,*;q=0.7");
    GetMethodWebRequest req = new GetMethodWebRequest(servletUrl + "/charencmain.jsp");
    wc.sendRequest(req);
    WebResponse wr = utils.submitButton("form01", "submit");
    check("form-charenc-01");

    // 2-ter test:
    // URL mit UTF-8 encodierten Zeichen, funktioniert im Browser (entgegen der Spec)
    // Funktioniert nicht mit httpunit. httpunit liefert unter Linux andere
    // Ergebnisse als unter Windows, das XML enthaelt non-utf-8 Zeichen.
    WebLink link = wr.getLinkWithID("a02");
    wr = link.click();
    // check("form-charenc-02");
  }

  public void testRequiredField() throws Exception {
    wc.sendRequest(new GetMethodWebRequest(servletUrl + "/multicolumn.jsp"));
    utils.submitButton("form01", "multicolumnForm.ok");
    check("form-required");
  }

  public void testMultiColumn() throws Exception {
    wc.sendRequest(new GetMethodWebRequest(servletUrl + "/multicolumn.jsp"));
    check("form-multicolumn");
  }
  /**
   * run form tests w/o faces servlet. This tests WCF EL and navigation
   */
  public void testWcfForm() throws Exception {
    wc.sendRequest(new GetMethodWebRequest(servletUrl + "/formdemo.jsp"));
    runTests();
  }

  /**
   * run form tests in faces context. This tests non-faces JSP thru faces servlet
   */
  public void testJsfForm() throws Exception {
    wc.sendRequest(new GetMethodWebRequest(servletUrl + "/formdemo.faces"));
    runTests();
  }

  private void runTests() throws Exception {
    check("form-01");
    WebForm wf = wc.getCurrentPage().getFormWithID("form01");
    String id = "formcomp"; 

    // ********* test valid input ****************
    wf.setParameter(id + ".string", "--ƒ÷‹ﬂ--");
    wf.setParameter(id + ".int", "12");
    wf.setParameter(id + ".double", "123.456");
    wf.setParameter(id + ".date", "12/31/2003");
    wf.setParameter(id + ".password", "x‰ˆ¸ƒ÷‹ﬂ");
    wf.setParameter(id + ".textarea", "some\nmulti\nline\ntext\n");
    wf.setParameter(id + ".checkbox1", "x");
    wf.setParameter(id + ".checkbox2", "x");
    wf.setParameter(id + ".list1", id + ".list1.1");
    wf.setParameter(id + ".listN", new String[]{ id + ".listN.1", id + ".listN.4"});
    wf.setParameter("group1", id + ".radio1");
    wf.submit(wf.getSubmitButtonWithID("formcomp.validate"));
    check("form-02");

    // ******** test invalid input *************
    wf = wc.getCurrentPage().getFormWithID("form01");
    wf.setParameter(id + ".int", "nan");
    wf.setParameter(id + ".double", "nan");
    wf.setParameter(id + ".date", "nad");
    wf.submit(wf.getSubmitButtonWithID("formcomp.ok"));
    check("form-03");
    wf.submit(wf.getSubmitButtonWithID("formcomp.revert"));
    check("form-04");
  }

}
@


1.2
log
@Fixed Test for JDK 1.5
Made Table Test Data time zone independent
@
text
@d11 1
d20 2
d77 1
d80 11
a90 11
    wf.setParameter("string", "--ƒ÷‹ﬂ--");
    wf.setParameter("int", "12");
    wf.setParameter("double", "123.456");
    wf.setParameter("date", "12/31/2003");
    wf.setParameter("password", "x‰ˆ¸ƒ÷‹ﬂ");
    wf.setParameter("textarea", "some\nmulti\nline\ntext\n");
    wf.setParameter("checkbox1", "x");
    wf.setParameter("checkbox2", "x");
    wf.setParameter("list1", "list1.1");
    wf.setParameter("listN", new String[]{ "listN.1", "listN.4"});
    wf.setParameter("group1", "radio1");
d96 3
a98 3
    wf.setParameter("int", "nan");
    wf.setParameter("double", "nan");
    wf.setParameter("date", "nad");
@


1.1
log
@initial version
@
text
@d47 1
a47 1
    utils.submitButton("form01", "ok");
@

