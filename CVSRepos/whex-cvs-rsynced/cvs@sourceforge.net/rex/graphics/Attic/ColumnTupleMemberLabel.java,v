head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2005.06.28.12.26.18;	author igorludi;	state dead;
branches;
next	1.1;

1.1
date	2005.06.28.11.35.03;	author igorludi;	state Exp;
branches;
next	;


desc
@@


1.2
log
@*** empty log message ***
@
text
@package rex.graphics;

import javax.swing.JLabel;
import rex.metadata.Query;
import java.awt.event.MouseEvent;
import java.awt.event.MouseListener;
import rex.metadata.resultelements.Tuple;
import rex.utils.AppColors;
import rex.utils.S;
import javax.swing.JPanel;
import rex.metadata.resultelements.Member;
import javax.swing.JOptionPane;

/**
 * <p>Title: WHEX</p>
 * <p>Description: </p>
 * <p>Copyright: Copyright (c) 2003</p>
 * <p>Company: </p>
 * @@author igor
 * @@version 1.0
 */


public class ColumnTupleMemberLabel extends TupleMemberLabel{
   Query query;
   Tuple tuple;
   int memberOrdinal;
   int columnNumber;
   Member thisMember;

   public ColumnTupleMemberLabel(String caption
                                 , Query _query
                                 , Tuple _tuple
                                 , int _memberOrdinal
                                 , int _columnNumber){
      super(caption, JLabel.CENTER);
      query = _query;
      tuple = _tuple;
      memberOrdinal = _memberOrdinal;
      thisMember = tuple.getMemberAt(memberOrdinal);
      columnNumber = _columnNumber;

      this.setBorder(AppColors.HIERARCHY_LABEL_BORDER);
      this.setForeground(AppColors.HIERARCHY_LABEL_FORECOLOR);

//      this.addMouseListener(this);
   }

   public int setHighlight(Tuple t, int mOrdinal){
//      S.out("setHighlight\nthis.tuple=" + tuple
//            + " \nthis.memberOrdinal=" + memberOrdinal
//            + "\ntuple = " + t
//            + "\nmOrdinal=" + mOrdinal);
      for(int i=0; (i <= memberOrdinal) && (i <= mOrdinal); i++){
         if (!(t.getMemberAt(i).getUniqueName().equals(tuple.getMemberAt(i).getUniqueName()))){
            this.setOpaque(false);
            return 0;
         }
      }
      this.setBackground(AppColors.HIERARCHY_LABEL_SELECTED_BACKGROUND);
      this.setOpaque(true);
      return 1;
   }

   public String[] getPopUpActionList(){
      if (thisMember.isMeasure()){
         return new String[] {
              TupleMemberLabelPopUpActions.REMOVE_MEMBER_FROM_QUERY
            , TupleMemberLabelPopUpActions.KEEP_THIS_MEMBER_ONLY
            , TupleMemberLabelPopUpActions.SORT_BY_THIS_BASCENDING
            , TupleMemberLabelPopUpActions.SORT_BY_THIS_BDESCENDING
            , TupleMemberLabelPopUpActions.SORT_BY_THIS_ASCENDING
            , TupleMemberLabelPopUpActions.SORT_BY_THIS_DESCENDING
         };
      }else{
         return new String[] {
           TupleMemberLabelPopUpActions.MOVE_DIMENSION_UP
         , TupleMemberLabelPopUpActions.MOVE_DIMENSION_FIRST
         , TupleMemberLabelPopUpActions.MOVE_DIMENSION_LAST
         , TupleMemberLabelPopUpActions.REMOVE_DIMENSION_FROM_QUERY
         , TupleMemberLabelPopUpActions.REMOVE_MEMBER_FROM_QUERY
         , TupleMemberLabelPopUpActions.KEEP_THIS_MEMBER_ONLY
         , TupleMemberLabelPopUpActions.SEND_MEMBER_TO_FILTER
         , TupleMemberLabelPopUpActions.SORT_BY_THIS_BASCENDING
         , TupleMemberLabelPopUpActions.SORT_BY_THIS_BDESCENDING
         , TupleMemberLabelPopUpActions.SORT_BY_THIS_ASCENDING
         , TupleMemberLabelPopUpActions.SORT_BY_THIS_DESCENDING
      };

      }
   }

   void highlightHierarchy(){
      JPanel parent = (JPanel)this.getParent();
      int levelsHighlighted = 0; // boost performance
      int i;
      for(i=0; i < parent.getComponentCount() && (levelsHighlighted <= memberOrdinal); i++){
         if (parent.getComponent(i) instanceof ColumnTupleMemberLabel) {
            levelsHighlighted += ((ColumnTupleMemberLabel)parent.getComponent(i)).setHighlight(tuple, memberOrdinal);
         }
      }
      if (i < parent.getComponentCount()){
         for(; i < parent.getComponentCount(); i++)
            ((JLabel)parent.getComponent(i)).setOpaque(false);
      }
      parent.revalidate();
      parent.repaint();

   }
   void toggleHierarchy(){
      query.toggleColumnsDrillState(thisMember);
   }
   void moveDimensionUp(){
      query.moveColumnDimensionUp(thisMember);
   }
   void moveDimensionFirst(){
      query.moveColumnDimensionFirst(thisMember);
   }
   void moveDimensionLast(){
      query.moveColumnDimensionLast(thisMember);
   }
   void removeDimensionFromQuery(){
      query.removeColumnDimensionFromQuery(thisMember);
   }
   void removeMemberFromQuery(){
      if (thisMember.isMeasure()){
         query.removeMeasureMemberFromQuery(thisMember);
      }else{
         query.removeColumnMemberFromQuery(thisMember);
      }
   }
   void sortByMeasureAscending(){
//      if (thisMember.isMeasure()){
         query.sortByThisMember(thisMember, "ASC");
//      }else{
//         S.out("assert: fired sort on non-measure member!");
//      }
   }
   void sortByMeasureDescending(){
//      if (thisMember.isMeasure()){
         query.sortByThisMember(thisMember, "DESC");
//      }else{
//         S.out("assert: fired sort on non-measure member!");
//      }
   }

   void sortByMeasureBAscending(){
      query.sortByThisMember(thisMember, "BASC");
   }
   void sortByMeasureBDescending(){
      query.sortByThisMember(thisMember, "BDESC");
   }

   void keepThisMemberOnly(){
      if (thisMember.isMeasure()){
         query.keepThisMemberOnlyOnMeasures(thisMember);
      }else{
         query.keepThisMemberOnlyOnColumns(thisMember);
      }
   }

   void sendMemberToFilter(){
      if (thisMember.isMeasure()){
         JOptionPane.showConfirmDialog(
                    null
                  , "You cannot add measures to filter."
                  , "Send member to filter."
                  , JOptionPane.YES_OPTION);

      }else{
         query.addColumnMemberToFilter(thisMember);
      }
   }


//   MOUSE LISTENER STUFF:
//   public void mouseClicked(MouseEvent e){}
//
//   public void mouseEntered(MouseEvent e){}
//
//   public void mouseExited(MouseEvent e){}
//
//   public void mousePressed(MouseEvent e){
//      if(e.getClickCount() == 1){
//         // highlight the hierarchy
//         JPanel parent = (JPanel)this.getParent();
//         int levelsHighlighted = 0; // boost performance
//         int i;
//         for(i=0; i < parent.getComponentCount() && (levelsHighlighted <= memberOrdinal); i++){
//            if (parent.getComponent(i) instanceof ColumnTupleMemberLabel) {
//               levelsHighlighted += ((ColumnTupleMemberLabel)parent.getComponent(i)).setHighlight(tuple, memberOrdinal);
//            }
//         }
//         if (i < parent.getComponentCount()){
//            for(; i < parent.getComponentCount(); i++)
//               ((JLabel)parent.getComponent(i)).setOpaque(false);
//         }
//         parent.revalidate();
//         parent.repaint();
//         // S.out("done at i=" + i);
//
//      }else if(e.getClickCount() == 2){
//         // toggle drill state
//         query.toggleColumnsDrillState(thisMember);
//      }
//   }
//
//   public void mouseReleased(MouseEvent e){}


}@


1.1
log
@first time commit
@
text
@@

