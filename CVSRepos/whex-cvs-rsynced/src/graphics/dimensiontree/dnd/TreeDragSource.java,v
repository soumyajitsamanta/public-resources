head	1.2;
access;
symbols;
locks; strict;
comment	@# @;


1.2
date	2007.07.11.09.09.51;	author pyadav;	state Exp;
branches;
next	1.1;

1.1
date	2006.01.13.12.30.55;	author igorludi;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Modified file's for Rex 0.7.
@
text
@package rex.graphics.dimensiontree.dnd;

import rex.utils.S;
/**
 * <p>Title: WHEX</p>
 * <p>Description: </p>
 * <p>Copyright: Copyright (c) 2003</p>
 * <p>Company: </p>
 * @@author igor
 * @@version 1.0
 */

// TreeDragSource.java
// A drag source wrapper for a JTree.  This class can be used to make
// a rearrangeable DnD tree with the TransferableTreeNode class as the
// transfer data type.
//

import java.awt.*;
import java.awt.dnd.*;
import java.awt.datatransfer.*;
import java.awt.event.*;
import java.io.*;
import java.util.*;
import javax.swing.*;
import javax.swing.tree.*;
import rex.graphics.dimensiontree.elements.DimensionTreeElement;
import rex.graphics.TreeElement;
import rex.metadata.QueryElement;
import rex.graphics.filtertree.*;
import rex.graphics.mdxeditor.mdxbuilder.dnd.DragElement;

public class TreeDragSource extends JComponent implements DragSourceListener, DragGestureListener, DragSourceMotionListener {

  DragSource source;
  DragGestureRecognizer recognizer;
  TransferableTreeNode transferable;
  TreeElement oldNode;
  JTree sourceTree;

//By Prakash.
  String uniqueName;
  private int ITEM_WIDTH = 9;
  private int ITEM_HEIGHT = 25;   
  Point p;
  
  public TreeDragSource(JTree tree, int actions) {
    sourceTree = tree;
    source = new DragSource();
    recognizer = source.createDefaultDragGestureRecognizer(
                 sourceTree, actions, this);
    source.addDragSourceMotionListener(this);   // By Prakash.  
  }

  //	Image image = (Image) ((JList)c).getSelectedValue();
  //	return new ImageTransferable(image);

//By Prakash
  public int getItemWidth() {
    return ITEM_WIDTH * uniqueName.length();
  }
  //By Prakash
  public int getItemHeight() {
    return ITEM_HEIGHT;
  }
  
  /*
   * Drag Gesture Handler
   */
  public void dragGestureRecognized(DragGestureEvent dge) {
    TreePath path = sourceTree.getSelectionPath();
    if ((path == null)
        || (path.getPathCount() <= 1)
        || !(((DimensionTreeElement)(((TreeElement)path.getLastPathComponent()).getUserObject())).isEnabled())
        || !((((TreeElement)path.getLastPathComponent()).getUserObject()) instanceof QueryElement )) {
      // We can't move the root node
      // or an empty selection
      // or disabled nodes - the ones that already been dragged, i.e. they are already included in the query
      // or nodes that aren't QueryElements
      return;
    }
    oldNode = (TreeElement)path.getLastPathComponent();
    transferable = new TransferableTreeNode(sourceTree.getRowForPath(path));

    uniqueName=((DimensionTreeElement) oldNode.getUserObject()).getUniqueName();//By Prakash
    
    source.startDrag(dge
                     , DragSource.DefaultCopyDrop
                     , ((DimensionTreeElement)oldNode.getUserObject()).getIcon().getImage()
                     , new Point(10, 10)
                     , transferable
                     , this);
    
    //By Prakash
    DragElement glassPane = (DragElement) SwingUtilities.getRootPane(sourceTree).getGlassPane();
    glassPane.setVisible(true);
    Point point = (Point) dge.getDragOrigin().clone();
    SwingUtilities.convertPointToScreen(point, this);
    SwingUtilities.convertPointFromScreen(point, glassPane);
    glassPane.setPoint(point);
    glassPane.setImage(uniqueName,getItemHeight(),getItemWidth());
    glassPane.showString(true);
    glassPane.repaint();
    //End
  }

  
  /*
   * Drag Event Handlers
   */
//By Prakash.
  public void dragMouseMoved(DragSourceDragEvent dsde) {
  	try
  	{
          DragElement glassPane = (DragElement) SwingUtilities.getRootPane(sourceTree).getGlassPane();
          p = (Point) dsde.getLocation().clone();
          SwingUtilities.convertPointFromScreen(p, glassPane);
          glassPane.setPoint(p);
          glassPane.showString(true);
          glassPane.repaint();
  	}
  	catch(ClassCastException cce)
  	{
  		S.out(cce.getMessage());
  	}
  }
//  End
  public void dragEnter(DragSourceDragEvent dsde) { }
  public void dragExit(DragSourceEvent dse) { }
  public void dragOver(DragSourceDragEvent dsde) { }
  public void dropActionChanged(DragSourceDragEvent dsde) { }
  public void dragDropEnd(DragSourceDropEvent dsde) {
    /*
     * to support move or copy, we have to check which occurred:
     */
//    System.out.println("Drop Action: " + dsde.getDropAction()
//                       + "    dsde.getDropSuccess()=" +     dsde.getDropSuccess());
    if (dsde.getDropSuccess() &&
        (dsde.getDropAction() == DnDConstants.ACTION_MOVE)) {
      // ((DefaultTreeModel)sourceTree.getModel()).removeNodeFromParent(oldNode);
      // I SHOULD DISABLE THIS ELEMENT HERE!
    }


    /*
     * to support move only...
    if (dsde.getDropSuccess()) {
      ((DefaultTreeModel)sourceTree.getModel()).removeNodeFromParent(oldNode);
    }
    */
  	//By Prakash
    DragElement glassPane = (DragElement) SwingUtilities.getRootPane(sourceTree).getGlassPane();
    glassPane.setVisible(true);
    //System.out.println("BBB");
    Point point = (Point) dsde.getLocation().clone();
    SwingUtilities.convertPointToScreen(point, this);
    SwingUtilities.convertPointFromScreen(point, glassPane);
    //System.out.println("CCC");
    glassPane.setPoint(point);
    glassPane.showString(false);
    glassPane.repaint();
    //End
  }
}

@


1.1
log
@*** empty log message ***
@
text
@d31 1
d33 1
a33 1
public class TreeDragSource implements DragSourceListener, DragGestureListener {
d41 6
d52 1
d55 12
d85 2
d93 12
a104 5
//    S.out("dragGestureRecognized-> path = " + path);

    // If you support dropping the node anywhere, you should probably
    // start with a valid move cursor:
    //source.startDrag(dge, DragSource.DefaultMoveDrop, transferable, this);
d107 1
d111 17
d131 1
a131 5
  public void dropActionChanged(DragSourceDragEvent dsde) {
    System.out.println("Action: " + dsde.getDropAction());
    System.out.println("Target Action: " + dsde.getTargetActions());
    System.out.println("User Action: " + dsde.getUserAction());
  }
d151 12
@

