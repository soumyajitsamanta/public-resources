head	1.6;
access;
symbols;
locks; strict;
comment	@# @;


1.6
date	2003.10.29.18.49.18;	author numberone;	state Exp;
branches;
next	1.5;

1.5
date	2003.10.29.11.09.57;	author numberone;	state Exp;
branches;
next	1.4;

1.4
date	2003.10.29.10.52.23;	author numberone;	state Exp;
branches;
next	1.3;

1.3
date	2003.10.27.15.27.48;	author numberone;	state Exp;
branches;
next	1.2;

1.2
date	2003.10.27.14.54.18;	author numberone;	state Exp;
branches;
next	1.1;

1.1
date	2003.06.03.13.15.39;	author numberone;	state Exp;
branches;
next	;


desc
@@


1.6
log
@windoze fails..
@
text
@# Before `make install' is performed this script should be runnable with
# `make test'. After `make install' it should work as `perl test.pl'

#########################

# change 'tests => 1' to 'tests => last_test_to_print';

use Test;
BEGIN { plan tests => 4 };
require Net;
ok(1); # If we made it this far, we're ok.

#########################

# Insert your test code below, the Test module is use()ed here so read
# its man page ( perldoc Test ) for help writing this test script.

#print &Net::foo(1, 2, "0.0") == 7 ? "ok 3\n" : "not ok 3\n";
#print abs(&Net::foo(0, 0, "-3.4") - 0.6) <= 0.01 ? "ok 4\n" : "not ok 4\n";  

use Devel::Peek;
use Data::Dumper;


# SSL
print "SSL: \n";
if(exists $ENV{SSL}) {
	my $PORT = 2055;
	if($ENV{SSL}) {
		Net->init("./root.pem","./server.pem","bee");
		my $server = Net->server("SSL",$PORT);
		print "listening on ".$server->peer."\n";
		my $net = $server->accept(1);
		print "client: ".$net->peer." (".$net->auth.")\n";

		print "sleeping...\n";
		sleep 3;
		print "writing...\n";
		$net->write("Hello OpenSSL");
		sleep 2;

	} else {
		Net->init("./root.pem","./client.pem","bee");
		my $net = Net->connect("SSL","localhost",$PORT);
		print "server: ".$net->peer." (".$net->auth.")\n";
	
		until($net->peek) { }
		print "read: '".$net->read."'\n";
	}
} else {
	print "use: 'SSL=1 make test' ";
	print  "and 'SSL=0 make test' to try client-server\n";
}
ok(2);

# INET
print "INET: ";
if(exists $ENV{INET}) {
	unless($ENV{INET}) {
		my $server = Net->server("INET");
		print "server listenning on ".$server->port."\n";
		my $client = $server->accept(1);
		print "client ".$client->peer." connected\n";
		$client->write("hello from windoze");
		until($client->peek) { }
		print "read: '",$client->read,"'\n";
	} else {
		my $net = Net->connect('INET',"localhost",$ENV{INET});
		print "client connected to server ".$net->peer."\n";
		sleep 1;
		until($net->peek) {  }
		print "read: '",$net->read,"'\n";
		$net->write("data\n");
	}
} else {
#	print "use: 'INET=1 make test' ";
#	print  "and 'INET=0 make test' to try client-server\n";
}
ok(3);


# UNIX
print "UNIX: ";
if(exists $ENV{UNIX}) {
	my($a,$b) = Net->socketpair;
	die "nefunguje" unless($a);

	print "UNIX: socketpair [ ".$a->peer." <-> ".$b->peer." ] created\n";
	my $i = 0;
#	until($b->peek) {  
	while(1) {
		$a->write("ahojky") if($i++ == 100);
		print ". $i\n";
		last if($a->select($b));
#		last if($b->peek);
	}
	print "write -> read: ".$b->read."\n";
}
ok(4);

@


1.5
log
@working dynamic port allocation
working dynamic port allocation
@
text
@a100 2


@


1.4
log
@automatic port allocation, net->listen returns port number
@
text
@d59 3
a61 4
	my $PORT = 2052;
	if($ENV{INET}) {
		my $server = Net->server("INET");#,$PORT);
		print "server listenning on ".$server->peer."\n";
d68 1
a68 1
		my $net = Net->connect('INET',"localhost",$PORT);
@


1.3
log
@still broken Net package..
@
text
@d61 1
a61 1
		my $server = Net->server("INET",$PORT);
@


1.2
log
@Data under windows
@
text
@d18 86
@


1.1
log
@bee-0.9.1 -- version merge
@
text
@a17 86
#print &Net::foo(1, 2, "0.0") == 7 ? "ok 3\n" : "not ok 3\n";
#print abs(&Net::foo(0, 0, "-3.4") - 0.6) <= 0.01 ? "ok 4\n" : "not ok 4\n";  

use Devel::Peek;
use Data::Dumper;


# SSL
print "SSL: \n";
if(exists $ENV{SSL}) {
	my $PORT = 2055;
	if($ENV{SSL}) {
		Net->init("./root.pem","./server.pem","bee");
		my $server = Net->server("SSL",$PORT);
		print "listening on ".$server->peer."\n";
		my $net = $server->accept(1);
		print "client: ".$net->peer." (".$net->auth.")\n";

		print "sleeping...\n";
		sleep 3;
		print "writing...\n";
		$net->write("Hello OpenSSL");
		sleep 2;

	} else {
		Net->init("./root.pem","./client.pem","bee");
		my $net = Net->connect("SSL","localhost",$PORT);
		print "server: ".$net->peer." (".$net->auth.")\n";
	
		until($net->peek) { }
		print "read: '".$net->read."'\n";
	}
} else {
	print "use: 'SSL=1 make test' ";
	print  "and 'SSL=0 make test' to try client-server\n";
}
ok(2);

# INET
print "INET: ";
if(exists $ENV{INET}) {
	my $PORT = 2052;
	if($ENV{INET}) {
		my $server = Net->server("INET",$PORT);
		print "server listenning on ".$server->peer."\n";
		my $client = $server->accept(1);
		print "client ".$client->peer." connected\n";
		$client->write("hello from windoze");
		until($client->peek) { }
		print "read: '",$client->read,"'\n";
	} else {
		my $net = Net->connect('INET',"localhost",$PORT);
		print "client connected to server ".$net->peer."\n";
		sleep 1;
		until($net->peek) {  }
		print "read: '",$net->read,"'\n";
		$net->write("data\n");
	}
} else {
#	print "use: 'INET=1 make test' ";
#	print  "and 'INET=0 make test' to try client-server\n";
}
ok(3);


# UNIX
print "UNIX: ";
if(exists $ENV{UNIX}) {
	my($a,$b) = Net->socketpair;
	die "nefunguje" unless($a);

	print "UNIX: socketpair [ ".$a->peer." <-> ".$b->peer." ] created\n";
	my $i = 0;
#	until($b->peek) {  
	while(1) {
		$a->write("ahojky") if($i++ == 100);
		print ". $i\n";
		last if($a->select($b));
#		last if($b->peek);
	}
	print "write -> read: ".$b->read."\n";
}
ok(4);



@

