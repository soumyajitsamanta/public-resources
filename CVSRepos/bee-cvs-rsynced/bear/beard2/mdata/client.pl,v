head	1.1;
access;
symbols;
locks; strict;
comment	@# @;


1.1
date	2004.03.01.16.16.49;	author numberone;	state Exp;
branches;
next	;


desc
@@


1.1
log
@
Added beard2 -- new bear daemon source tree.

mdata subsystem works, some docs, some tests, etc.

cached in progress
@
text
@#!/usr/bin/perl -w

use IO::Handle;
use Socket;
use Data::Dumper;
use Storable qw(freeze thaw nstore_fd retrieve_fd);

my $rw = shift;
my $socket;
$socket = "../tmp/mdata-ro.sock" if($rw and ($rw eq 'read'));
$socket = "../tmp/mdata-rw.sock" if($rw and ($rw eq 'write'));

unless($socket) {
	print "\nusage: $0 [read|write] method [args..]\n\n";
	print "example: $0 write set hello 'Hello world!'\n";
	print "example: $0 read echo hello\n";
	print "example: $0 [read|write] debug\n\n";
	exit(1);
}

socket(SOCK,PF_UNIX,SOCK_STREAM,0) or die $!;
connect(SOCK,sockaddr_un($socket)) or die $!;
binmode(SOCK,":unix");

nstore_fd \@@ARGV, \*SOCK;
#IO::Handle::flush(SOCK); # important!

my $thaw = retrieve_fd(\*SOCK);
print Dumper($thaw);

@
