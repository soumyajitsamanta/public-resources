head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2004.02.24.10.21.34;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2004.02.16.14.55.19;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2004.02.05.08.53.47;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2004.01.29.13.20.34;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2004.01.20.13.06.01;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.5
log
@prefer access and rights logic changed
@
text
@#!/usr/bin/perl
# $Id: collect.cgi,v 1.4 2004/02/16 14:55:19 jiri_schmid Exp $

use strict;
#turned off, due binary handling of params leading in two times utf8 output decoding
#my $run_mod_perl = defined(&Apache::RequestRec::BINMODE);	# are we running under mod_perl?
#if ($run_mod_perl) { Apache::RequestRec::BINMODE(':utf8') } else { binmode STDOUT,':utf8' }

use CGI qw( :standard );
use CGI::Pretty;
require "const/Const.pm";
require "local/Local.pm";

my $q = new CGI;

# --- determine user and his preferences ---
#-------------------------------------------
my $User = $q->remote_user() ? $q->remote_user() : 'anonymous';
my $use_lang = ($q->param('Lang')) ? $q->param('Lang') : $Const::defaultLanguage;
my $project = ($q->param('Proj')) ? $q->param('Proj') : '';
my $use_enc = $Const::languages->{$use_lang}->{enc};
my $width = $q->param('Width');
my $dropWidth = 100-$width;
my $reports = $q->param('Tabs');

my $all_params = "Lang=".$q->param('Lang')."&Cook=".$q->param('Cook')."&Open=".$q->param('Open')."&Proj=".$q->param('Proj')."&Width=".$q->param('Width')."&Skin=".$q->param('Skin');

# --- determine skin ---
#-----------------------
my $skinPath;
my $wb = $q->user_agent()=~/MSIE/ ? 'msie' : 'mozilla';
if ($q->param('Skin')) {	# takes it as param from index.cgi
	$skinPath = "skins/".$q->param('Skin');
} elsif ($q->param('skin')) {	# I've received parameter from myself after Save
	$skinPath = "$Const::wb_const->{$wb}{skinDir}/".$q->param('skin');
} else {
	$skinPath = "$Const::wb_const->{$wb}{skinDir}/default";	#let use default
}

# --- print out html form ---
#----------------------------
print $q->header(-charset=>$use_enc);

print $q->start_html(
	-title=>"Collect",
  	-lang=>$Const::languages->{$use_lang}->{lang},	#return language specification in format: language-country (it differs from param Lang)
	-encoding=>$use_enc,
	-head=>meta({ -http_equiv => 'Content-Type', -content => "text/html; charset=$use_enc" }),
);

my $destiny = $q->param('item_id') ? "run.cgi?$all_params&item_id=".$q->param('item_id') : "collected.cgi?$all_params&Content=1";
print <<END;
<input type="hidden" value="$width" id="width" />
  <IFRAME frameborder="0" style="position: absolute; top:0px; left:0px; width:$width%; height: 100%;" name="report_list" id="report_list" src="collected.cgi?$all_params&Reports=$reports" ></IFRAME>
  <IFRAME frameborder="0" style="position: absolute; top:0px; left:$width%; width:$dropWidth%; height: 100%;" name="report_view" id="report_view" src="$destiny" ></IFRAME>
END

print $q->end_html;

#---------------------------------------------------

1
@


1.4
log
@security improvment for tabs
@
text
@d2 1
a2 1
# $Id: collect.cgi,v 1.3 2004/02/05 08:53:47 jiri_schmid Exp $
d26 1
a26 1
my $all_params = "Lang=".$q->param('Lang')."&Cook=".$q->param('Cook')."&Open=".$q->param('Open')."&Proj=".$q->param('Proj')."&sqlA=".$q->param('sqlA')."&Width=".$q->param('Width')."&Skin=".$q->param('Skin');
@


1.3
log
@derivated reports redesigned
@
text
@d2 1
a2 1
# $Id: collect.cgi,v 1.2 2004/01/29 13:20:34 jiri_schmid Exp $
a13 12
# ---- init SOAP ---------
#-------------------------
my $load = 0;
if (!$load) {	# ensure require will be performed only once in case of mod_perl execution
	eval "use SOAP::Lite +autodispatch => 
		uri => 'Bear', 
		proxy => ['http://$Const::bearHost:$Const::bearPort/',
		options => {compress_threshold => $Const::compressThreshold}];
		1"
	or ( &Local::ErrorDie("ERROR in eval of \"use SOAP::Lite ...\".") );
	$load++;
}
a15 7
# --- test SOAP connection ---
#-----------------------------
my $serverVerbName="SOAP Server http://$Const::bearHost:$Const::bearPort/";
if (! eval "SOAP::Lite->self->fault") {
	&Local::ErrorDie('ERROR: '.$serverVerbName.' not responding<br><form><input type="submit" name="Refresh" value="Refresh" /></form>');
}

@


1.2
log
@collected tab implemented
@
text
@d2 1
a2 1
# $Id: collect.cgi,v 1.1 2004/01/20 13:06:01 jiri_schmid Exp $
d41 1
a41 1
my $width = 15;
@


1.1
log
@collected reports tab implementation started
@
text
@d2 1
a2 1
# $Id: collect.cgi,v 1.4 2003/11/12 12:44:21 jiri_schmid Exp $
d5 3
a7 1
use utf8;
d41 1
a41 2
my $width = $q->param('Width');
$width = 25 if ($width<10 || $width>50);
d64 1
a64 1
	-title=>"Cellect",
d70 1
d72 3
a74 2
  <IFRAME frameborder="0" style="position: absolute; top:0px; left:0px; width:$width%; height: 100%" name="report_list" id="report_list" src="collected.cgi?$all_params&Reports=$reports" ></IFRAME>
  <IFRAME frameborder="0" style="position: absolute; top:0px; left:$width%; width:$dropWidth%; height: 100%" name="report_view" id="report_view" src="collected.cgi?$all_params&Content=1" ></IFRAME>
@

