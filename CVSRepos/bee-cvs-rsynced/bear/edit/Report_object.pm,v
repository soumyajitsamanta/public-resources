head	1.3;
access;
symbols;
locks; strict;
comment	@# @;


1.3
date	2003.11.18.14.38.40;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.07.13.40.49;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.31.12.47.57;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.3
log
@auto save when changing tabs implemented
@
text
@#-----------------------------------------------------
#  Report Editation - grid/graph3d
#-----------------------------------------------------
# $Id: Report_object.pm,v 1.2 2003/11/07 13:40:49 jiri_schmid Exp $

package Report_object;

use strict;
require "local/Generate.pm";
use Data::Dumper;

#-----------------------------------------------------

sub generateContent {
my($variables, $lang, $obj, $q, $fullObj) = (shift, shift, shift, shift, shift);
my $copy = $$variables->{contentVars} if exists $$variables->{contentVars};
my $hlp = {};
$hlp->{report_type} = $$obj->{report_type};
my $saved = $$variables->{saved} if exists $$variables->{saved};
if ($copy) {
	if ($copy eq '1') {
		&Local::loadMetadata($$obj->{var_def},$fullObj,$obj);
		$hlp->{var_def} = $$obj;
	} else {
		$hlp->{var_def}->{empty} = "";
	};
$$obj = $hlp;
};
#use Data::Dumper;
#print "<pre>".Dumper($$obj)."</pre>";
if ($q->param('Type')) {
$$obj->{report_type} = $q->param('Type');
delete $$obj->{var_def};
$$obj->{var_def}->{orig_id} = undef;
}
if ($$obj->{report_type} eq 'graph3d') {
	if (ref($$obj->{var_def})) {
print <<END;
<br>
<table class="page_skeleton">
<tr class="page_skeleton"><td class="page_skeleton_ex" align="center">
END
&Generate::generateGraph3DEdit($lang,$$variables->{skinPath},$$variables->{imgType});
print "</td><td>";
&Generate::generateGraph3DEditFields($obj);
print <<END;
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral_100">
	<tr><td align="center">
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input id='SAVE' type="submit" name="Action" value="$$lang->{'Save'}" onclick="fill_selects()" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}" onclick="fill_selects();" /></td>
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Graph3d'}" onclick="fill_selects(); return readName();"/>
						<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="fill_tables()" /></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td><td>
</table>
<script type="text/javascript" src="js/graph3d.js"></script>	
<script type="text/javascript">
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Graph3d Save'}$$lang->{'New Save Part2'}";
	fill_tables();
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Graph3d'}";
	reloadTree($saved);
</script>
END
} else {
print "<p><b>&nbsp;$$lang->{'Report graph3d'}</b>$$lang->{'Report No Graph3d'}<ul>";
if ($$obj->{var_def}) {
	print "<li><a href=\"javascript: editOriginal('$$obj->{var_def}');\">$$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('object','1');\">$$lang->{'Report Local Edit'}</a></li>";
};
print "<li><a href=\"javascript: editDefined('object','graph3d');\">$$lang->{'Report New Local'}</a></li></ul></p>";
print "<script type='text/javascript'>reloadTree($saved)</script>";
}
} elsif ($$obj->{report_type} eq 'grid') {
if (ref($$obj->{var_def})) {

print <<END ;
<script src='js/report.js' type='text/javascript'></script>
<br>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton_ex" align="center">
END
&Generate::generateGridEdit($lang,$$variables->{skinPath},$$variables->{imgType});
print "</td><td>";
&Generate::generateGridEditFields($obj);
print <<END ;
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral_100">
	<tr><td align="center">
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input id='SAVE' type="submit" name="Action" value="$$lang->{'Save'}" onclick="fill_selects()" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}" onclick="fill_selects()" /></td>
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Grid'}" onclick="fill_selects(); return readName();"/>
						<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="fill_tables()" /></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td><td>
</table>
<script type="text/javascript" src="js/grid.js"></script>
<script type="text/javascript">
<!--
	var mg_img="$Const::MetricsIdent->{img}";
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Grid Save'}$$lang->{'New Save Part2'}";
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Grid'}";
	fill_tables();
	$$variables->{saveRun}
	reloadTree($saved);
-->
</script>
END

} else {
print "<p><b>&nbsp;$$lang->{'Report grid'}</b>$$lang->{'Report No Grid'}<ul>";
if ($$obj->{var_def}) {
	print "<li><a href=\"javascript: editOriginal('$$obj->{var_def}');\">$$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('object','1');\">$$lang->{'Report Local Edit'}</a></li>";
};
print "<li><a href=\"javascript: editDefined('object','grid');\">$$lang->{'Report New Local'}</a></li></ul></p>";
print "<script type='text/javascript'>reloadTree($saved)</script>";
}
} else {
print "<p><b>&nbsp;$$lang->{'Report object'}</b><ul>";
print "<li><a href=\"javascript: editDefined('object','grid');\">$$lang->{'Report New Local'}: $$lang->{'Report grid'}</a></li>";
print "<li><a href=\"javascript: editDefined('object','graph3d');\">$$lang->{'Report New Local'}: $$lang->{'Report graph3d'}</a></li></ul></p>";
}
}



#---------------------------------------------------

sub set_next_param {
my ($o,$q) = (shift,shift);
my $hlp;

my $type = $$q->param('objectType');

$hlp->{orig_id} = (ref($$o->{var_def})) ? $$o->{var_def}->{orig_id} : $$o->{var_def};
if ($type eq 'graph3d') {
	foreach ('pages','y','x','z','transparency','diameter','shape','color') {
		$hlp->{$_}{items} = [$$q->param($_)];
		my $qKey = "${_}Q";
		$hlp->{$_}{quantity} =  $$q->param($qKey) ? 'on' : 'off';
	}
} elsif ($type eq 'grid') {
	$hlp->{row} = [$$q->param('RowObj')];
	$hlp->{col} = [$$q->param('ColObj')];
	$hlp->{page} = [$$q->param('PageObj')];
	$hlp->{metric} = [$$q->param('Metrics')];
}
$$o->{var_def} = $hlp;
$$o->{report_type} = $type;
}
1
@


1.2
log
@tested a fixed saving of all objects
@
text
@d4 1
a4 1
# $Id: Report_object.pm,v 1.1 2003/10/31 12:47:57 jiri_schmid Exp $
d53 1
a53 1
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" onclick="fill_selects()" /></td>
d101 1
a101 1
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" onclick="fill_selects()" /></td>
@


1.1
log
@mod perl rocks!
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.7 2003/10/16 15:29:18 jiri_schmid Exp $
d51 1
a51 1
	<tr><td align="right">
@

