head	1.11;
access;
symbols;
locks; strict;
comment	@# @;


1.11
date	2004.01.16.16.13.44;	author jiri_schmid;	state Exp;
branches;
next	1.10;

1.10
date	2004.01.16.11.56.31;	author jiri_schmid;	state Exp;
branches;
next	1.9;

1.9
date	2004.01.14.15.32.51;	author jiri_schmid;	state Exp;
branches;
next	1.8;

1.8
date	2003.12.18.16.36.48;	author jiri_schmid;	state Exp;
branches;
next	1.7;

1.7
date	2003.12.18.12.59.54;	author jiri_schmid;	state Exp;
branches;
next	1.6;

1.6
date	2003.12.12.16.48.12;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.12.04.10.44.36;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2003.11.18.14.38.40;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.13.16.27.50;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.04.15.19.00;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.31.12.47.57;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.11
log
@bug fixies
@
text
@#-----------------------------------------------------
#  Dynami params Editation
#-----------------------------------------------------
# $Id: Param.pm,v 1.10 2004/01/16 11:56:31 jiri_schmid Exp $

package Param;

use strict;

#-----------------------------------------------------
# print_form is called from edit.cgi

sub generateContent {
my($variables, $lang, $obj) = (shift, shift, shift);

my $outObjects;
my $saved = $$variables->{saved} if exists $$variables->{saved};

print <<END ;   # openNodes ... list of nodes which are currently open
<br />	
<table class="page_skeleton_ex">
<tr class="page_skeleton">
<td class="page_skeleton_ex" style='padding: 10px'>
	<table>
		<tr><td class='neutral_bold'>$$lang->{'Param Type'}:</td></tr>
		<tr><td><hr /></td></tr>
END
	foreach ('object','element','common','date') {
		my $name = "Param $_";
		my $checked = ($$obj->{type} eq $_) ? " checked='checked'" : "";
		print "<tr><td class='nowrap'><span onclick='setThis(this)' class='cursor'><input onclick='showThis(this)' type='radio' name='type' value='$_'$checked /> $$lang->{$name}</span></td></tr>";
	}
print <<END;
	</table>
</td>
<td class='page_skeleton_ex' style='padding: 10px;' rowspan='2'>
<table>
	<tr><td class='neutral_bold'>$$lang->{'Param Item'}:</td></tr>
	<tr><td><hr /</td></tr>
	<tr><td>
END
	$outObjects = &generateInput($variables, $lang, $obj);
print <<END;
	</td></tr>
</table>
</td>
<td class='page_skeleton_ex' style='padding: 10px; width:100%' rowspan='2'>
	<table>
		<tr><td class='neutral_bold'>$$lang->{'Param 1use'}:</td></tr>
		<tr><td><hr /></td></tr>
END
		$$obj->{def}{prop} = 'default' if !exists $$obj->{def}{prop};
		foreach ('lock','default','reset') {
		my $name = "Param $_";
		my $checked = ($$obj->{def}{prop} eq $_) ? " checked='checked'" : "";
		print "<tr><td class='nowrap'><span onclick='setThis(this)' class='cursor'><input type='radio' name='prop' value='$_'$checked /> $$lang->{$name}</span></td></tr>";
		}
		my $selected = $$obj->{def}{share} ? " checked='checked'" : "";
print <<END;
		<tr><td><hr size='1'/></td></tr>
		<tr><td class='nowrap'><input type='checkbox' name='share' value='1'$selected /> $$lang->{'Param Share'}</td></tr>
	</table>
<td>
</tr>
<tr class="page_skeleton">
<td class="page_skeleton_ex" style='padding: 10px'>
	<table>
		<tr><td colspan='2' class='neutral_bold'>$$lang->{'Param Items'}:</td></tr>
		<tr><td colspan='2'><hr /></td></tr>
END
	foreach ('min','max') {
		my $name = "Param $_";
		my $value = (defined $$obj->{def}{$_}) ? $$obj->{def}{$_} : 1;
		print "<tr><td>$$lang->{$name}:</td><td><input type='input' name='$_' size='5' value='$value' style='text-align:right' onchange='object_changed()' /></td></tr>"
	}
print <<END;
	</table>
</td>
</tr>
<tr class="page_skeleton">
<td class="page_skeleton" colspan='3'>
	<table class="neutral_100">
	<tr><td align="center">
	<table class="buttons" cellpading="0" cellspacing="0">
	<tr>	<td class="buttons"><input id='SAVE' type="submit" name="Action" value="$$lang->{'Save'}" onclick='doSaveJob()' /></td>
		<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As'}" onclick="return readName('param');"/>
					<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
<!--		<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="doReLoadJob()" /></td> -->
	</tr>
	</table>
	</td></tr>
	</table>
</td></tr></table>
END
print <<END ;
<script type="text/javascript" src="js/param.js"></script>
<script type="text/javascript">
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Param Save'}$$lang->{'New Save Part2'}";
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Param'}";
	var show = "$$obj->{type}";
	var objects = new Array ($outObjects);
	reloadTree($saved);
	doLoadJob();
</script>
END
}


#---------------------------------------------------

sub generateInput {
my($variables, $lang, $obj) = (shift, shift, shift);

my $imgType = \$$variables->{imgType};
my $skinPath = \$$variables->{skinPath};

my $type = $$obj->{type};
my $hide = ($type eq 'object') ? "" : " style='display:none'" ;
my $size = 5;
my @@objects;
if ($type eq 'object') {
	foreach (@@{$$obj->{def}{alternatives}}) {
		push(@@objects,"'$_'")
	}
}
my $outObjects = join(",",@@objects);
print <<END;
	<div id='DIVobject'$hide>
		<table>
			<tr>
				<td colspan='3'>
					$$lang->{'Param object'}:
				</td>
			</tr>
			<tr>
				<td style='vertical-align:top; text-align:center' rowspan='3'>
					<img src="$${skinPath}img/metric.$$imgType" vspace="5" />
					<img src="$${skinPath}img/attr.$$imgType" /><br />
					<img src="$${skinPath}img/fact.$$imgType" vspace="5" /><br />
					<img src="$${skinPath}img/attr_form.$$imgType" />
				</td>
				<td rowspan='3'>
					<select onclick='dropSelect(this)' id="paramObjects" name="paramObjects" maxlength="100" size="10" style="width:200px" multiple='multiple'>
					</select>
				</td>
				<td>
					<img class="cursor" src="$${skinPath}img/upArr.$$imgType" title="$$lang->{Up}" onclick="moveUp('paramObjects')" />
				</td>
				<tr><td style='height:40%'>
					<img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="emptySelect('paramObjects')" />
				</td></tr>
				<tr><td>
					<img class="cursor" src="$${skinPath}img/downArr.$$imgType" title="$$lang->{Down}" onclick="moveDown('paramObjects')" />						
				</td></tr>
			</tr>
		</table>
	</div>
END
$hide = ($type eq 'element') ? "" : " style='display:none'";
my $attr = (exists $$obj->{def}{attr}) ? $$obj->{def}{attr} : "";
print <<END;
	<div id='DIVelement'$hide>
		<table>
			<tr>
				<td colspan='2'>
					<img src="$${skinPath}img/attr.$$imgType" />
					$$lang->{'Param Attr'} 
					(<img src="$${skinPath}img/attr_form.$$imgType" /> $$lang->{'Param Form'})
				</td>
			</tr>
			<tr>				
				<td>
					<input type='input' readonly='readonly' value='' onclick="drop_input(this)" id="paramAttr" style='width:100%'/>
					<input type='hidden' value='$attr' name='attr' id="paramAttr_id"/>
				</td>
				<td style='text-align:right'>
					<img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="clearItem('paramAttr')"></td>
				</td>
			</tr>
			<tr><td colspan='2'><hr size='1' noshade='noshade' /></td></tr>
			<tr>
				<td colspan='2'>
					<img src="$${skinPath}img/single_attr.$$imgType" />
					$$lang->{'Param Element'}
				</td>
			</tr>
			<tr>				
				<td>
				<select onclick='dropSelect(this)' id="paramElements" name="paramElements" maxlength="100" readonly size="$size" style="width:200px" multiple>
END
				if ($type eq 'element') {
					foreach (@@{$$obj->{def}{alternatives}}) {
						print "<option value='$_'>$_</option>"
					}
				}
print <<END;
				</select>
				</td>
				<td style='vertical-align:bottom'>
					<img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="emptySelect('paramElements')"></td>
				</td>
			</tr>			
		</table>
	</div>
END
my $value;
if ($type eq 'common') {
	undef $hide;
	$value = $value = ($$obj->{def}{type} eq 'constrain') ? $$obj->{def}{alternatives}[0] : undef;
} else { 
	$hide = "style='display:none'";
	undef $value;
}
my @@checked = ($$obj->{def}{type} eq 'list') ? ('',' checked="checked"','') : (' checked="checked"','',' disabled="disabled"');
print <<END;
	<div id='DIVcommon'$hide>
	<table><tr><td style='vertical-align:top'>
		<table>
			<tr>	<td colspan='3'>
					<span onclick='setThis(this)' class='cursor'><input type='radio' onclick="set('paramCommons','disabled',true)" name='commonType' value='constrain'$checked[0] /> $$lang->{'Param Def'}</span>
				</td>
			</tr>
			<tr>	<td colspan='2'><hr size='1' noshade='noshade'/></td><td></td></tr>
			<tr>	
				<td colspan='2'><input type='input' name='common' id='paramCommon' value='$value' /></td>
				<td class='nowrap'>
					&nbsp;
					<img onclick='select2Input("paramCommons","paramCommon","remove")' class='cursor' src="$${skinPath}img/leftArr.$$imgType" />
					&nbsp;
					<img onclick='input2Select("paramCommon","paramCommons","unique")' class='cursor' src="$${skinPath}img/rightArr.$$imgType" />
				</td>
			</tr>
			<tr>	<td colspan='2'><hr size='1' noshade='noshade'/></td><td></td></tr>
			<tr>
				<td>
				<table class='resolution'>
					<tr><td>$$lang->{'Constrain'}:</td></tr>
					<tr><td>$$lang->{'Param Regular'}</td></tr>
				</table>
				</td>
			</tr>
		</table>
	</td>
	<td style='vertical-align:top'>
		<table>
				<tr>
					<td>
						<span onclick='setThis(this)' class='cursor'><input type='radio' onclick="set('paramCommons','disabled',false)" name='commonType' value='list'$checked[1] /> $$lang->{'Param List'}<span>
					</td>
					<td>
						<img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="emptySelect('paramCommons')">
					</td>
				</tr>
				<tr>	<td colspan='2'><hr size='1' noshade='noshade'/></td>	</tr>
				<tr>	<td colspan='2'>
		<select onclick='' id="paramCommons" name="paramCommons" maxlength="100" readonly size="$size" style="width:200px" multiple="multiple"$checked[2] >
END
				if ($type eq 'common' && $$obj->{def}{type} eq 'list') {
					foreach (@@{$$obj->{def}{alternatives}}) {
						print "<option value='$_'>$_</option>"
					}
				}
print <<END;
		</select>
					</td>
				</tr>
		</table>
	</td></tr>
	</table>
	</div>
END
if ($type eq 'date') {
	undef $hide;
	$value = ($$obj->{def}{type} eq 'constrain') ? $$obj->{def}{alternatives}[0] : undef;
} else { 
	$hide = "style='display:none'";
	undef $value;
}
@@checked = ($$obj->{def}{type} eq 'list') ? ('',' checked="checked"','') : (' checked="checked"','',' disabled="disabled"');
print <<END;
	<div id='DIVdate'$hide>
	<table><tr><td style='vertical-align:top'>
		<table>
			<tr>	<td colspan='3'>
					<span onclick='setThis(this)' class='cursor'><input type='radio' onclick="set('paramDates','disabled',true)" name='dateType' value='constrain'$checked[0] /> $$lang->{'Param Def'}</span>
				</td>
			</tr>
			<tr>	<td colspan='2'><hr size='1' noshade='noshade'/></td><td></td></tr>
			<tr>	
				<td colspan='2'><input type='input' name='date' id='paramDate' value='$value' /></td>
				<td class='nowrap'>
					&nbsp;
					<img onclick='select2Input("paramDates","paramDate","remove")' class='cursor' src="$${skinPath}img/leftArr.$$imgType" />
					&nbsp;
					<img onclick='input2Select("paramDate","paramDates","unique")' class='cursor' src="$${skinPath}img/rightArr.$$imgType" />
				</td>
			</tr>
			<tr>	<td colspan='2'><hr size='1' noshade='noshade'/></td><td></td></tr>
			<tr>
				<td>
				<table class='resolution'>
END
	foreach ('Constrain','Day','Month','Year','Separator') {
		my $name= "Short $_";
		print "<tr><td>$$lang->{$_}:</td><td>$$lang->{$name}</td><td></td></tr>";
	}
print <<END;
				</table>
				</td>
			</tr>
		</table>
	</td>
	<td style='vertical-align:top'>
		<table>
				<tr>
					<td>
						<span onclick='setThis(this)' class='cursor'><input type='radio' onclick="set('paramDates','disabled',false)" name='dateType' value='list'$checked[1] /> $$lang->{'Param List'}<span>
					</td>
					<td>
						<img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="emptySelect('paramDates')">
					</td>
				</tr>
				<tr>	<td colspan='2'><hr size='1' noshade='noshade'/></td>	</tr>
				<tr>	<td colspan='2'>
		<select onclick='' id="paramDates" name="paramDates" maxlength="100" readonly size="$size" style="width:200px" multiple="multiple"$checked[2] >
END
				if ($type eq 'date' && $$obj->{def}{type} eq 'list') {
					foreach (@@{$$obj->{def}{alternatives}}) {
						print "<option value='$_'>$_</option>"
					}
				}
print <<END;
		</select>
					</td>
				</tr>
		</table>
	</td></tr>
	</table>
	</div>
END
return $outObjects
}
#-----------------------------------------------
sub set_next_param {
	my ($o,$q) = (shift,shift);
	my $type = $$q->param('type');
	$$o->{type} = $type;
	delete $$o->{def};
	$$o->{def}{max} = $$q->param('max');
	$$o->{def}{min} = $$q->param('min');
	$$o->{def}{share} = $$q->param('share'); 
	$$o->{def}{prop} = $$q->param('prop'); 
	
	if ($type eq "object") {
		$$o->{def}{alternatives} = [$$q->param('paramObjects')];
	} elsif ($type eq "element") {
		$$o->{def}{attr} = $$q->param('attr');
		$$o->{def}{alternatives} = [$$q->param("paramElements")];
	} elsif ($type eq "common") {
		$$o->{def}{type} = $$q->param('commonType');
		if ($$q->param('commonType') eq 'list') {
			$$o->{def}{alternatives} = [$$q->param("paramCommons")]
		} else {
			$$o->{def}{alternatives} = [$$q->param('common')];
			$$o->{def}{max} = 1;
			$$o->{def}{min} = 1;
		}
	} elsif ($type eq "date") {
		$$o->{def}{type} = $$q->param('dateType');
		if ($$q->param('dateType') eq 'list') {
			$$o->{def}{alternatives} = [$$q->param("paramDates")];
		} else {
			$$o->{def}{alternatives} = [$$q->param('date')];
			$$o->{def}{max} = 1;
			$$o->{def}{min} = 1;
		}
	}
}

1
@


1.10
log
@dp page imrpovment, dp rules code fixies
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.9 2004/01/14 15:32:51 jiri_schmid Exp $
d58 1
a58 1
		my $selected = $$obj->{share} ? " selected='selected'" : "";
@


1.9
log
@DP rules fixies
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.8 2003/12/18 16:36:48 jiri_schmid Exp $
d136 1
a136 1
				<td style='vertical-align:top; text-align:center' >
d142 1
a142 1
				<td>
d146 2
a147 2
				<td style='vertical-align:bottom'>
					<img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="emptySelect('paramObjects')">
d149 6
@


1.8
log
@minor IE fixies
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.7 2003/12/18 12:59:54 jiri_schmid Exp $
d355 7
a361 1
		$$o->{def}{alternatives} = ($$q->param('commonType') eq 'list') ? [$$q->param("paramCommons")] : [$$q->param('common')];
d363 8
a370 3
		my $subType = $$q->param('dateType');
		$$o->{def}{type} = $subType;
		$$o->{def}{alternatives} = ($$q->param('dateType') eq 'list') ? [$$q->param("paramDates")] : [$$q->param('date')];
@


1.7
log
@defining of dynamic params within use rules implemented
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.6 2003/12/12 16:48:12 jiri_schmid Exp $
d131 2
a132 3
				<td style='vertical-align:top' colspan='2'>
					<img src="$${skinPath}img/gear.$$imgType" />
					$$lang->{'Param object'}
d135 7
d143 1
a143 1
					<select onclick='dropSelect(this)' id="paramObjects" name="paramObjects" maxlength="100" readonly size="$size" style="width:200px" multiple>
@


1.6
log
@continuing in implementation of dynamic params
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.5 2003/12/04 10:44:36 jiri_schmid Exp $
d36 1
a36 1
<td class='page_skeleton_ex' style='padding: 10px; width:100%' rowspan='2'>
d47 17
d81 1
a81 1
<td class="page_skeleton" colspan='2'>
d119 1
a119 1
my $size = (defined $$obj->{max}) ? $$obj->{max} : "5";
d339 3
@


1.5
log
@visaul changes and improvments
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.4 2003/11/18 14:38:40 jiri_schmid Exp $
d57 1
a57 1
		print "<tr><td>$$lang->{$name}:</td><td><input type='input' name='$_' size='5' value='$value' style='text-align:right' /></td></tr>"
@


1.4
log
@auto save when changing tabs implemented
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.3 2003/11/13 16:27:50 jiri_schmid Exp $
d139 1
a139 1
					(<img src="$${skinPath}img/tree/attr_form.$$imgType" /> $$lang->{'Param Form'})
@


1.3
log
@fixed bugs and dynamicparam finder implemeted
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.2 2003/11/04 15:19:00 jiri_schmid Exp $
d68 1
a68 1
	<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" onclick='doSaveJob()' /></td>
@


1.2
log
@save as - modperl fixies, code improvments
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.1 2003/10/31 12:47:57 jiri_schmid Exp $
d104 5
a108 1
foreach (@@{$$obj->{def}{objects}}) { push(@@objects,"'$_'") }
d162 4
a165 2
				foreach (@@{$$obj->{def}{elements}}) {
					print "<option value='$_'>$_</option>";
d177 8
a184 1
$hide = ($type eq 'common') ? "" : " style='display:none'";
d196 1
a196 1
				<td colspan='2'><input type='input' name='common' id='paramCommon' value='$$obj->{def}{common}' /></td>
d229 4
a232 2
				foreach (@@{$$obj->{def}{commons}}) {
					print "<option value='$_'>$_</option>";
d243 7
a249 1
$hide = ($type eq 'date') ? "" : " style='display:none'";
d261 1
a261 1
				<td colspan='2'><input type='input' name='date' id='paramDate' value='$$obj->{def}{date}' /></td>
d298 4
a301 2
				foreach (@@{$$obj->{def}{dates}}) {
					print "<option value='$_'>$_</option>";
d323 1
a323 1
		$$o->{def}{objects} = [$$q->param('paramObjects')];
d326 1
a326 1
		$$o->{def}{elements} = [$$q->param("paramElements")];
d328 2
a329 4
		my $subType = $$q->param('commonType');
		$$o->{def}{common} = $$q->param('common') if $subType eq 'constrain';; 
		$$o->{def}{type} = $subType;
		$$o->{def}{commons} = [$$q->param("paramCommons")] if $subType eq 'list';
a331 1
		$$o->{def}{date} = $$q->param('date') if $subType eq 'constrain';; 
d333 1
a333 1
		$$o->{def}{dates} = [$$q->param("paramDates")] if $subType eq 'list';
@


1.1
log
@mod perl rocks!
@
text
@d4 1
a4 1
# $Id: Param.pm,v 1.8 2003/10/16 15:29:17 jiri_schmid Exp $
d69 1
a69 1
		<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As'}" onclick="return readName();"/>
d71 1
a71 1
<!--		<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick='doReLoadJob()' /></td> -->
@

