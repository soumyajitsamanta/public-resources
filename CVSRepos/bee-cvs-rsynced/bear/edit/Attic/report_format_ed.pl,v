head	1.20;
access;
symbols;
locks; strict;
comment	@# @;


1.20
date	2003.10.31.12.47.57;	author jiri_schmid;	state dead;
branches;
next	1.19;

1.19
date	2003.10.17.11.36.16;	author jiri_schmid;	state Exp;
branches;
next	1.18;

1.18
date	2003.10.16.14.08.53;	author jiri_schmid;	state Exp;
branches;
next	1.17;

1.17
date	2003.09.29.09.21.58;	author jiri_schmid;	state Exp;
branches;
next	1.16;

1.16
date	2003.09.26.08.33.00;	author jiri_schmid;	state Exp;
branches;
next	1.15;

1.15
date	2003.09.24.14.59.18;	author jiri_schmid;	state Exp;
branches;
next	1.14;

1.14
date	2003.09.17.11.41.25;	author jiri_schmid;	state Exp;
branches;
next	1.13;

1.13
date	2003.08.13.14.22.03;	author jiri_schmid;	state Exp;
branches;
next	1.12;

1.12
date	2003.07.21.10.51.42;	author jiri_schmid;	state Exp;
branches;
next	1.11;

1.11
date	2003.07.18.10.51.02;	author jiri_schmid;	state Exp;
branches;
next	1.10;

1.10
date	2003.07.03.12.17.57;	author jiri_schmid;	state Exp;
branches;
next	1.9;

1.9
date	2003.07.02.13.44.34;	author jiri_schmid;	state Exp;
branches;
next	1.8;

1.8
date	2003.06.19.14.59.45;	author jiri_schmid;	state Exp;
branches;
next	1.7;

1.7
date	2003.06.17.08.45.49;	author jiri_schmid;	state Exp;
branches;
next	1.6;

1.6
date	2003.05.19.14.32.32;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.05.19.14.18.35;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.16.11.28.26;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.14.14.28.21;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.13.15.19.00;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.08.15.35.51;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.20
log
@mod perl rocks!
@
text
@#-----------------------------------------------------
#  Report Editation
#-----------------------------------------------------
# $Id	$

use strict;

#-----------------------------------------------------

sub generateContent {
my($variables, $lang, $obj) = (shift, shift, shift);
my $saved = $$variables->{saved} if exists $$variables->{saved};
my $saveRun = $$variables->{saveRun} if exists $$variables->{saveRun};
my $copy = $$variables->{contentVars} if exists $$variables->{contentVars};

if ($copy == 1) {
	loadMetadata($$obj->{format_def});	#$$obj reused for loaded object
	my $hlp;
	$hlp->{format_def} = $$obj;
	$$obj = $hlp;
}
my ($Type, $Form, $Header);
if (ref($$obj->{format_def}) =~ /HASH/ || $copy > 1) {
	$Type = $$obj->{format_def}->{type} if exists $$obj->{format_def}->{type};
	$Form = $$obj->{format_def}->{form} if exists $$obj->{format_def}->{form};
	$Header = $$obj->{format_def}->{header} if exists $$obj->{format_def}->{header};
	print "<script src='js/report.js' type='text/javascript'></script>";
	print "<script src='js/format.js' type='text/javascript'></script>";
print <<END;
<br />
<table class="page_skeleton" style="width:100%">
<tr class="page_skeleton">
<td class="page_skeleton_ex">
	<IFRAME class="formatIframe" id="formatIframe" name="format" src="format.cgi?Lang=$$variables->{useLang}&Type=$Type&Form=$Form&Header=$Header" width="100%" height="265px" scrolling="auto" frameborder="0"></IFRAME>
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton" style="border: 2px">
	<table class="neutral_100">
	<tr><td align='center'>
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}"/></td>
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Format'}" onclick="return readName();"/>
						<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="self.frames['format'].location.reload(true)"/></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td></tr>
</table>
<input type="hidden" value="$Form" name="form" id="form"/>\
<input type="hidden" value="$Type" name="type" id="type"/>
<input type="hidden" value="$Header" name="header" id="header"/>
<script type="text/javascript" src="js/format.js"></script>
<script type="text/javascript">
<!--
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Format Save'}$$lang->{'New Save Part2'}";
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Format'}";
	$saveRun
	reloadTree($saved);
	reSetIframe();
-->
</script>
END
} else {
if ($$obj->{format_def}) {
	print "<p><b>&nbsp;$$lang->{'Report format'}</b>$$lang->{'Report No Format'}<ul>";
	print "<li><a href=\"javascript: editOriginal('$$obj->{format_def}','Fo');\">$$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('format',1);\">$$lang->{'Report Local Edit'}</a></li>";
} else {
	print "<p><b>&nbsp;$$lang->{'Report format'}</b><br></p>";
	print "<ul>$$lang->{'Report Unspec Format'}</ul>";
	print "<script type='text/javascript'>reloadTree($saved)</script>";
}
}}

#---------------------------------------------------
sub set_next_param {
	my $o=shift;
my $hlp;
	$hlp->{orig_id} = (ref($o->{format_def})) ? $o->{format_def}->{orig_id} : $o->{format_def};	
	$hlp->{type} = param('type');
	$hlp->{form} = param('form');
	$hlp->{header} = param('header') if param('header');
	$o->{format_def} = $hlp;
}
1
@


1.19
log
@last changes-fixies coresponding mod-perl stage 1
@
text
@@


1.18
log
@mod-perl implementation stage 1, rebuilding global vars in .pl to global pointers
@
text
@d39 1
a39 1
	<tr><td>
@


1.17
log
@code improvments a fixies
@
text
@d4 1
a4 1
# $Id
a6 7
use CGI qw( :standard );
use CGI::Pretty;

require "const.def";
require "local_lib.pl";

use vars qw($ID $Obj $ObjT $ObjPref $descr_w $descr_r $name_w $use_lang $lang $saved $saveRun);
d11 5
a15 3
my $copy = shift;
my $Type = $Obj->{report_type};
my ($Form, $Header);
d17 1
a17 1
	loadMetadata($Obj->{format_def});	#$Obj reused for loaded object
d19 2
a20 2
	$hlp->{format_def} = $Obj;
	$Obj = $hlp;
d22 9
a30 8
if (ref($Obj->{format_def}) =~ /HASH/ || $copy > 1) {
$Type = $Obj->{format_def}->{type} if exists $Obj->{format_def}->{type};
$Form = $Obj->{format_def}->{form} if exists $Obj->{format_def}->{form};
$Header = $Obj->{format_def}->{header} if exists $Obj->{format_def}->{header};
print "<script src='js/report.js' type='text/javascript'></script>";
print "<script src='js/format.js' type='text/javascript'></script>";
print <<END ;
<br>
d34 1
a34 1
	<IFRAME class="formatIframe" id="formatIframe" name="format" src="format.cgi?Lang=$use_lang&Type=$Type&Form=$Form&Header=$Header" width="100%" height="265px" scrolling="auto" frameborder="0"></IFRAME>
a35 2
END
print <<END;
d41 3
a43 3
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save and Run'}"/></td>
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As Format'}" onclick="return readName();"/>
d45 1
a45 1
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" onclick="self.frames['format'].location.reload(true)"/></td>
d58 2
a59 2
	var msg="$lang->{'New Save Part1'}$lang->{'New Format Save'}$lang->{'New Save Part2'}";
	var saveAsMsg = "$lang->{SaveAsMsg}$lang->{'New Format'}";
a65 6
} else
{
if ($Obj->{format_def}) {
	print "<p><b>&nbsp;$lang->{'Report format'}</b>$lang->{'Report No Format'}<ul>";
	print "<li><a href=\"javascript: editOriginal('$Obj->{format_def}','Fo');\">$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('format',1);\">$lang->{'Report Local Edit'}</a></li>";
d67 7
a73 2
	print "<p><b>&nbsp;$lang->{'Report format'}</b><br></p>";
	print "<ul>$lang->{'Report Unspec Format'}</ul>";
@


1.16
log
@formta2d layout final stage of implementation
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.15 2003/09/24 14:59:18 jiri_schmid Exp $
a40 23
if ($Type eq 'graph2d') {
	my ($row, $col);
	if ($Obj->{format_def}{sets} eq 'cols') {
		$row = '';
		$col = ' checked="checked"';
	} else {
		$col = '';
		$row = ' checked="checked"';
	}
	print <<END;
	<tr class="page_skeleton" >
	<td class="page_skeleton">
	<table class='neutral_100'>
		<tr><td>
			<span>$lang->{'Format2d Sets'}:</span>
			<span class='cursor' onclick='setThisRadio(this)'><input type='radio' name='dataset' value='rows'$row />$lang->{'Format2d Row'}</span>
			<span class='cursor' onclick='setThisRadio(this)'><input type='radio' name='dataset'value='cols'$col />$lang->{'Format2d Col'}</span>
		</td></tr>
	</table>
	</td>
	</tr>
END
}
a92 1
	$hlp->{sets} = param('dataset') if param('dataset');
a93 4


#use Data::Dumper;
#print "<pre>".Dumper($o)."</pre>";
@


1.15
log
@graph2d improvments
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.14 2003/09/17 11:41:25 jiri_schmid Exp $
d37 1
a37 1
<td class="page_skeleton">
@


1.14
log
@bug fixies
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.13 2003/08/13 14:22:03 jiri_schmid Exp $
d38 27
a64 1
	<IFRAME class="formatIframe" name="format" src="format.cgi?Lang=$use_lang&Type=$Type&Form=$Form&Header=$Header" width="100%" height="265px" scrolling="auto" frameborder="0"></IFRAME></td></tr>
d91 1
d116 1
@


1.13
log
@code clearing and improvment
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.12 2003/07/21 10:51:42 jiri_schmid Exp $
d46 1
a46 1
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As'}" onclick="return readName();"/>
@


1.12
log
@report and format scripts fixies, GUI improvment
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.11 2003/07/18 10:51:02 jiri_schmid Exp $
a82 1
	my($cgi) = shift;
@


1.11
log
@format3d implemented, format changed all dependencies fixed
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.10 2003/07/03 12:17:57 jiri_schmid Exp $
a25 2
} elsif ($copy == 2) {
	undef $Obj->{format_def};
a69 2

print "<p><b>&nbsp;$lang->{'Report format'}</b>$lang->{'Report No Format'}<ul>";
d71 1
d74 5
a78 3
};
print "<li><a href=\"javascript: editLocal('format',2);\">$lang->{'Report New Local'}</a></li></ul>";
print "<script type='text/javascript'>reloadTree($saved)</script>";
@


1.10
log
@bug fixies
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.9 2003/07/02 13:44:34 jiri_schmid Exp $
d13 1
a13 1
use vars qw($ID $Obj $ObjT $ObjPref $descr_w $descr_r $name_w $use_lang $lang $saved);
d19 4
a22 2

if ($copy eq "1") {
d24 9
a32 7
	loadMetadata($Obj->{format_def});	#$Obj reused for loaded object
	$hlp->{format_def} = $Obj;		#create proper structure for &generateFormatEdit()
	$Obj = $hlp;				#refill object used by &generateFormatEdit()
};

if (ref($Obj->{format_def}) =~ /HASH/) {

d37 1
a37 1
<table class="page_skeleton" style="width:100%; border: 2px solid #424242">
d40 1
a40 4
END
&generateFormatEdit();
print <<END ; 
</td></tr>
d42 2
a43 2
<td class="page_skeleton">
	<table class="format_100">
d47 1
d50 1
a50 1
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" /></td>
d57 4
d65 1
d73 1
a73 1
print "<p><b>&nbsp;$lang->{'Report Lformat'}</b>$lang->{'Report No Format'}<ul>";
d76 1
a76 1
	print "<li><a href=\"javascript: editLocal('format','1');\">$lang->{'Report Local Edit'}</a></li>";
d78 2
a79 1
print "<li><a href=\"javascript: editLocal('format');\">$lang->{'Report New Local'}</a></li></ul>";
d88 1
a88 1
	$hlp->{type} = param('typ');
d90 1
a90 1
	$hlp->{header} = param('header');
@


1.9
log
@header descriptions finally implemented
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.8 2003/06/19 14:59:45 jiri_schmid Exp $
d30 1
@


1.8
log
@huge improvment on format page
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.7 2003/06/17 08:45:49 jiri_schmid Exp $
d81 1
@


1.7
log
@changed structure of format object
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.6 2003/05/19 14:32:32 jiri_schmid Exp $
d32 1
a32 1
<table class="page_skeleton">
d41 2
a42 2
	<table class="neutral_100">
	<tr><td align="right">
@


1.6
log
@save-as bug when canceling saving fixed
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.5 2003/05/19 14:18:35 jiri_schmid Exp $
d20 5
a24 9
if ($copy) {
my $hlp;
	if ($copy eq '1') {
		loadMetadata($Obj->{format_def});
		$hlp->{format_def} = $Obj;
	} else {
		$hlp->{format_def}->{css}->{type} = "default";
	};
$Obj = $hlp;
d27 1
a27 1
if (ref($Obj->{format_def})) {
d79 2
a80 3
	my($form)=$cgi->param('form');
	if ($form eq 'css') {$hlp->{css}->{type} = param('type_css')};
	if ($form eq 'graph') {$hlp->{graph}->{type}= param('type_graph')};
@


1.5
log
@very minor fixies and code improvmetns
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.4 2003/05/16 11:28:26 jiri_schmid Exp $
d49 1
a49 1
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As'}" onclick="readName()"/>
@


1.4
log
@report page - save as functionality implemented
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.3 2003/05/14 14:28:21 jiri_schmid Exp $
d71 1
a71 1
	print "<li><a href=\"javascript: editOriginal('$Obj->{format}','Fo');\">$lang->{'Report Global Edit'}</a></li>";
@


1.3
log
@next report improvment
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.2 2003/05/13 15:19:00 jiri_schmid Exp $
d13 1
a13 1
use vars qw($ID $Obj $ObjT $ObjPref $descr_w $descr_r $name_w $use_lang $lang);
d49 2
d61 2
@


1.2
log
@new report page seems to be fullfunctional, javascript code huge improvment
@
text
@d4 1
a4 1
# $Id: report_format_ed.pl,v 1.1 2003/05/08 15:35:51 jiri_schmid Exp $
d18 1
a19 1
my $copy = shift;
d22 3
a24 4
if ($copy eq '1') {
	loadMetadata($Obj->{format});
	if ($Obj->{'css'}) {
		$hlp->{'css'} = $Obj->{css};
d26 3
a28 4
		$hlp->{'graph'} = $Obj->{graph};
	}
}
$Obj->{format} = $hlp;
d31 1
a31 1
if (ref($Obj->{format})) {
a55 1

d57 1
d59 1
d64 3
a66 3
print "<ul><b>$lang->{'Report Lformat'}</b>";
if ($Obj->{format}) {
	print "$lang->{'Report No Format'}";
d77 2
a78 3
	# !!! parametry ColObj, ... budou nahrazeny parametry nesoucimi ID objektu nastavovanym JavaScripten onUnload
	my $hlp;
	$hlp->{'orig_format'} = (ref($o->{format})) ? $o->{format}->{'orig_format'} : $o->{format};	
d82 1
a82 1
	$o->{format} = $hlp;
@


1.1
log
@report huge improvment
@
text
@d4 1
a4 1
# $Id: report_ed.pl,v 1.40 2003/05/08 07:42:46 michald Exp $
d19 15
a33 1
loadMetadata($Obj->{format});
a35 12
my $Form = (exists($Obj->{'graph'})) ? "graph" : "css";
my $checked_graph = "";
my $checked_css = ""; 
my $Type = "";
if ($Form eq "graph") 
	{$Type = $Obj->{graph}->{type};
	 $checked_graph = "checked=\"true\"";}
else
	{$Type = $Obj->{css}->{type};
	$checked_css = "checked=\"true\"";}


d41 14
a54 12
	<table class="neutral">
	<tr>	<td>	<input type="radio" id="in_css" name="style" value="CSS" $checked_css onclick="change_style('format.cgi?Lang=$use_lang&Form=css&Type=$Obj->{css}->{type}');return true;"/>
			<span class="cursor" onclick="document.getElementById('in_css').onclick()">$lang->{'Format radio_btn css'}</span>
			<input type="radio" id="in_graph" name="style" value="Graph" $checked_graph onclick="change_style('format.cgi?Lang=$use_lang&Form=graph&Type=$Obj->{graph}->{type}');return true;"/>
			<span class="cursor" onclick="document.getElementById('in_graph').onclick()">$lang->{'Format radio_btn graph'}</span>
			<input id="forma" value="" type="hidden" name="form"/>
			<input id="typ_css" value="$Obj->{css}->{type}" type="hidden" name="type_css"/>
			<input id="typ_graph" value="$Obj->{graph}->{type}" type="hidden" name="type_graph"/>
			</td>
	</tr>
	<tr>	<td align="center"><IFRAME id="css_graph" src="format.cgi?Lang=$use_lang&Form=$Form&Type=$Type" width="275" height="375" scrolling="auto" frameborder="0"></IFRAME>         	      
	</tr>
d56 4
a59 2
</td></tr></table>
<script language="JAVASCRIPT" type="text/javascript">
d63 10
a72 1
}
d75 10
d86 4
@

