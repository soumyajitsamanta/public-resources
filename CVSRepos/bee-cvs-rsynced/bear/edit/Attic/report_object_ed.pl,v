head	1.8;
access;
symbols;
locks; strict;
comment	@# @;


1.8
date	2003.10.31.12.47.57;	author jiri_schmid;	state dead;
branches;
next	1.7;

1.7
date	2003.10.16.15.29.18;	author jiri_schmid;	state Exp;
branches;
next	1.6;

1.6
date	2003.10.16.14.08.53;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.09.29.15.37.51;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.17.11.41.25;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.13.14.22.03;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.07.21.10.51.42;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.07.18.10.52.48;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.8
log
@mod perl rocks!
@
text
@#-----------------------------------------------------
#  Report Editation - grid/graph3d
#-----------------------------------------------------
# $Id: report_object_ed.pl,v 1.7 2003/10/16 15:29:18 jiri_schmid Exp $

use strict;
use CGI qw( :standard );
use CGI::Pretty;

require "const.def";
require "local/generate.pl";

our($ObjectAttr,$MetricsIdent,$saved,$saveRun);

#-----------------------------------------------------

sub generateContent {
my($variables, $lang, $obj) = (shift, shift, shift);
my $copy = $$variables->{contentVars} if exists $$variables->{contentVars};
my $hlp;
$hlp->{report_type} = $$obj->{report_type};
if ($copy) {
	if ($copy eq '1') {
		loadMetadata($$obj->{var_def});
		$hlp->{var_def} = $$obj;
	} else {
		$hlp->{var_def}->{empty} = "";
	};
$$obj = $hlp;
};
#use Data::Dumper;
#print "<pre>".Dumper($$obj)."</pre>";
if (param('Type')) {
$$obj->{report_type} = param('Type');
delete $$obj->{var_def};
$$obj->{var_def}->{orig_id} = undef;
}
if ($$obj->{report_type} eq 'graph3d') {
	if (ref($$obj->{var_def})) {
print <<END;
<br>
<table class="page_skeleton">
<tr class="page_skeleton"><td class="page_skeleton_ex" align="center">
END
&generateGraph3DEdit($lang,$$variables->{skinPath},$$variables->{imgType});
print "</td><td>";
&generateGraph3DEditFields($obj);
print <<END;
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral_100">
	<tr><td align="right">
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" onclick="fill_selects()" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}" onclick="fill_selects();" /></td>
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Graph3d'}" onclick="fill_selects(); return readName();"/>
						<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="fill_tables()" /></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td><td>
</table>
<script type="text/javascript" src="js/graph3d.js"></script>	
<script type="text/javascript">
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Graph3d Save'}$$lang->{'New Save Part2'}";
	fill_tables();
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Graph3d'}";
	reloadTree($saved);
</script>
END
} else {
print "<p><b>&nbsp;$$lang->{'Report graph3d'}</b>$$lang->{'Report No Graph3d'}<ul>";
if ($$obj->{var_def}) {
	print "<li><a href=\"javascript: editOriginal('$$obj->{var_def}');\">$$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('object','1');\">$$lang->{'Report Local Edit'}</a></li>";
};
print "<li><a href=\"javascript: editDefined('object','graph3d');\">$$lang->{'Report New Local'}</a></li></ul></p>";
print "<script type='text/javascript'>reloadTree($saved)</script>";
}
} elsif ($$obj->{report_type} eq 'grid') {
if (ref($$obj->{var_def})) {

print <<END ;
<script src='js/report.js' type='text/javascript'></script>
<br>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton_ex" align="center">
END
&generateGridEdit($lang,$$variables->{skinPath},$$variables->{imgType});
print "</td><td>";
&generateGridEditFields($obj);
print <<END ;
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral_100">
	<tr><td align="center">
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" onclick="fill_selects()" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}" onclick="fill_selects()" /></td>
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Grid'}" onclick="fill_selects(); return readName();"/>
						<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="fill_tables()" /></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td><td>
</table>
<script type="text/javascript" src="js/grid.js"></script>
<script type="text/javascript">
<!--
	var mg_img="$ObjectAttr->{$MetricsIdent}->{img}";
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Grid Save'}$$lang->{'New Save Part2'}";
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Grid'}";
	fill_tables();
	$saveRun
	reloadTree($saved);
-->
</script>
END

} else {
print "<p><b>&nbsp;$$lang->{'Report grid'}</b>$$lang->{'Report No Grid'}<ul>";
if ($$obj->{var_def}) {
	print "<li><a href=\"javascript: editOriginal('$$obj->{var_def}');\">$$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('object','1');\">$$lang->{'Report Local Edit'}</a></li>";
};
print "<li><a href=\"javascript: editDefined('object','grid');\">$$lang->{'Report New Local'}</a></li></ul></p>";
print "<script type='text/javascript'>reloadTree($saved)</script>";
}
} else {
print "<p><b>&nbsp;$$lang->{'Report object'}</b><ul>";
print "<li><a href=\"javascript: editDefined('object','grid');\">$$lang->{'Report New Local'}: $$lang->{'Report grid'}</a></li>";
print "<li><a href=\"javascript: editDefined('object','graph3d');\">$$lang->{'Report New Local'}: $$lang->{'Report graph3d'}</a></li></ul></p>";
}
}



#---------------------------------------------------

sub set_next_param {
	my $o=shift;
	my $hlp;
	my $type = param('objectType');

$hlp->{orig_id} = (ref($o->{var_def})) ? $o->{var_def}->{orig_id} : $o->{var_def};
if ($type eq 'graph3d') {
	foreach ('pages','y','x','z','transparency','diameter','shape','color') {
		$hlp->{$_}{items} = [param($_)];
		my $qKey = "${_}Q";
		$hlp->{$_}{quantity} =  param($qKey) ? 'on' : 'off';
	}
} elsif ($type eq 'grid') {
	$hlp->{row} = [param('RowObj')];
	$hlp->{col} = [param('ColObj')];
	$hlp->{page} = [param('PageObj')];
	$hlp->{metric} = [param('Metrics')];
}
$o->{var_def} = $hlp;
$o->{report_type} = $type;
}
1
@


1.7
log
@some fixies due to mod-perl changes
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.6 2003/10/16 14:08:53 jiri_schmid Exp $
@


1.6
log
@mod-perl implementation stage 1, rebuilding global vars in .pl to global pointers
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.5 2003/09/29 15:37:51 jiri_schmid Exp $
d57 1
a57 1
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Graph'}" onclick="fill_selects(); return readName();"/>
@


1.5
log
@report result parameters handling changed, minor code improvments
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.4 2003/09/17 11:41:25 jiri_schmid Exp $
d11 1
a11 1
require "local_lib.pl";
d13 1
a13 1
use vars qw($ID $Obj $ObjT $ObjPref $descr_w $descr_r $name_w $use_lang $open $sqlCols $sqlRows $lang $ObjectAttr $MetricsIdent $saved $saveRun);
d18 2
a19 1
my $copy = shift;
d21 1
a21 1
$hlp->{report_type} = $Obj->{report_type};
d24 2
a25 2
		loadMetadata($Obj->{var_def});
		$hlp->{var_def} = $Obj;
d29 1
a29 1
$Obj = $hlp;
d32 1
a32 1
#print "<pre>".Dumper($Obj)."</pre>";
d34 3
a36 3
$Obj->{report_type} = param('Type');
delete $Obj->{var_def};
$Obj->{var_def}->{orig_id} = undef;
d38 2
a39 2
if ($Obj->{report_type} eq 'graph3d') {
	if (ref($Obj->{var_def})) {
d45 1
a45 1
&generateGraph3DEdit();
d47 1
a47 1
&generateGraph3DEditFields();
d55 3
a57 3
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" onclick="fill_selects()" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save and Run'}" onclick="fill_selects();" /></td>
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As Graph'}" onclick="fill_selects(); return readName();"/>
d59 1
a59 1
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" onclick="fill_tables()" /></td>
d68 1
a68 1
	var msg="$lang->{'New Save Part1'}$lang->{'New Graph3d Save'}$lang->{'New Save Part2'}";
d70 1
a70 1
	var saveAsMsg = "$lang->{SaveAsMsg}$lang->{'New Graph3d'}";
d75 4
a78 4
print "<p><b>&nbsp;$lang->{'Report graph3d'}</b>$lang->{'Report No Graph3d'}<ul>";
if ($Obj->{var_def}) {
	print "<li><a href=\"javascript: editOriginal('$Obj->{var_def}');\">$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('object','1');\">$lang->{'Report Local Edit'}</a></li>";
d80 1
a80 1
print "<li><a href=\"javascript: editDefined('object','graph3d');\">$lang->{'Report New Local'}</a></li></ul></p>";
d83 2
a84 2
} elsif ($Obj->{report_type} eq 'grid') {
if (ref($Obj->{var_def})) {
d93 1
a93 1
&generateGridEdit();
d95 1
a95 1
&generateGridEditFields();
d103 3
a105 3
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" onclick="fill_selects()" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save and Run'}" onclick="fill_selects()" /></td>
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As Grid'}" onclick="fill_selects(); return readName();"/>
d107 1
a107 1
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" onclick="fill_tables()" /></td>
d118 2
a119 2
	var msg="$lang->{'New Save Part1'}$lang->{'New Grid Save'}$lang->{'New Save Part2'}";
	var saveAsMsg = "$lang->{SaveAsMsg}$lang->{'New Grid'}";
d128 4
a131 4
print "<p><b>&nbsp;$lang->{'Report grid'}</b>$lang->{'Report No Grid'}<ul>";
if ($Obj->{var_def}) {
	print "<li><a href=\"javascript: editOriginal('$Obj->{var_def}');\">$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('object','1');\">$lang->{'Report Local Edit'}</a></li>";
d133 1
a133 1
print "<li><a href=\"javascript: editDefined('object','grid');\">$lang->{'Report New Local'}</a></li></ul></p>";
d137 3
a139 3
print "<p><b>&nbsp;$lang->{'Report object'}</b><ul>";
print "<li><a href=\"javascript: editDefined('object','grid');\">$lang->{'Report New Local'}: $lang->{'Report grid'}</a></li>";
print "<li><a href=\"javascript: editDefined('object','graph3d');\">$lang->{'Report New Local'}: $lang->{'Report graph3d'}</a></li></ul></p>";
@


1.4
log
@bug fixies
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.3 2003/08/13 14:22:03 jiri_schmid Exp $
d100 1
a100 1
	<tr><td align="right">
@


1.3
log
@code clearing and improvment
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.2 2003/07/21 10:51:42 jiri_schmid Exp $
d56 1
a56 1
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As'}" onclick="fill_selects(); return readName();"/>
d104 1
a104 1
			<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As'}" onclick="fill_selects(); return readName();"/>
@


1.2
log
@report and format scripts fixies, GUI improvment
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.1 2003/07/18 10:52:48 jiri_schmid Exp $
a146 1
	my($cgi) = shift;
@


1.1
log
@added new edit files
@
text
@d4 1
a4 1
# $Id: report_object_ed.pl,v 1.7 2003/05/19 14:32:32 jiri_schmid Exp $
d32 5
d79 1
a79 1
print "<li><a href=\"javascript: editLocal('object');\">$lang->{'Report New Local'}</a></li></ul>";
d82 1
a82 1
} else {
d132 1
a132 1
print "<li><a href=\"javascript: editLocal('object');\">$lang->{'Report New Local'}</a></li></ul>";
d135 4
d143 1
d150 1
d153 1
a153 1
if (param('objectType') eq 'graph3d') {
d159 1
a159 1
} else {
d166 1
@

