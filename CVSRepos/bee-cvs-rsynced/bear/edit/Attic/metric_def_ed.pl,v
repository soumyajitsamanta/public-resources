head	1.5;
access;
symbols;
locks; strict;
comment	@# @;


1.5
date	2003.10.31.12.47.57;	author jiri_schmid;	state dead;
branches;
next	1.4;

1.4
date	2003.10.16.14.08.53;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.09.26.08.33.00;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.09.19.10.23.50;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.09.18.14.10.50;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.5
log
@mod perl rocks!
@
text
@#-----------------------------------------------------
#  Metric Editation
#-----------------------------------------------------
# $Id: metric_def_ed.pl,v 1.4 2003/10/16 14:08:53 jiri_schmid Exp $

use strict;

our($descr_w,$descr_r,$itemWidth);

#-----------------------------------------------------
# print_form is called from edit.cgi

sub generateContent {
my($variables, $lang, $obj) = (shift, shift, shift);

my $saved = $$variables->{saved} if exists $$variables->{saved};
my $imgType = \$$variables->{imgType};
my $skinPath = \$$variables->{skinPath};

	(my $allParams = $ENV{QUERY_STRING}) =~ s/item[^&]*//;
	print <<END;
<input type="hidden" value="$$obj->{filter_def}" id="ITEMS"/><br />
<table class="page_skeleton_ex">
<tr class="page_skeleton">
<td class="page_skeleton" rowspan='2'>
	<table class="neutral">
	<tr>	<td class="neutral_bold" colspan="3">$$lang->{'Metric expresion'}</td></tr>
	<tr>	<td valign="top"><img src="$${skinPath}img/tree/metric.$$imgType" vspace="5"><br><img src="$${skinPath}img/tree/attr.$$imgType"><br><img src="$${skinPath}img/tree/fact.$$imgType" vspace="5"><br><img src='$${skinPath}img/tree/attr_form.$$imgType'></td>
		<td align="center">
			<textarea id="object_metric" onclick="drop_textarea(this)" onchange="object_changed()" name="expr" cols="$descr_w" rows="$descr_r" maxlength="100"></textarea>
			<input type="hidden" name="expr_id" id="object_metric_id" value="$$obj->{expr}"/>
		</td>
		<td valign="bottom" align="center"><img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick='clearById("object_metric");return true;'></td></tr>
	<tr>	<td align="center" colspan="3">
		<table>
		<tr>	<td class="visual_down">
			<table class="visual_up" cellpading="0" cellspacing="0">
			<tr>	<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","(");'><a name="lb" class="cursor">(</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric",")");'><a name="rb" class="cursor">)</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","+");'><a name="pl" class="cursor">+</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","-");'><a name="mi" class="cursor">-</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","*");'><a name="ti" class="cursor">*</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","/");'><a name="di" class="cursor">/</a></td></tr>
			</table>
		</tr>
		<tr>	<td class="visual_down">
			<table class="visual_up" cellpading="0" cellspacing="0">
			<tr>	<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","SUM()");'><a name="sum" class="cursor">SUM</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","AVG()");'><a name="avg" class="cursor">AVG</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","COUNT()");'><a name="count" class="cursor">COUNT</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","MAX()");'><a name="max" class="cursorr">MAX</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr("object_metric","MIN()");'><a name="min" class="cursor">MIN</a></td></tr>
			</table>
		</tr>
		</table>
	</td></tr>
	<tr><td></td><td style="text-align:right">$$lang->{'Metric Output'}: <input onclick="drop_input(this)" value="$$obj->{output}" name="output" type="text" size="20"/></td><td></td></tr>
	</table>
</td>
<td class='page_skeleton' style='height:100%'>
	<table class="neutral_100" style='height:100%'>
	<tr>	<td colspan="3" class="neutral_bold">
		$$lang->{'Metric Filter'}
	</td></tr>
	<tr><td><img src="$${skinPath}img/filter.$$imgType"</td>
		<td align="center">
			<input onclick="drop_input(this)" id="metric_filter" value="" name="filter" type="text" size="$itemWidth" maxlength="100" readonly/>
			<input type="hidden" id="metric_filter_id" name="filter_id" value="$$obj->{filter_def}"/>
		</td>
		<td><img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="clearItem('metric_filter')"></td></tr>
	<tr><td colspan="3" style="text-align:right">
		<span class="rule">$$lang->{'Metric Intersect'}</span>
END
my $checked;
my $viewName;
my $viewTitle;
$$obj->{filter_intersect} = 'all' if !$$obj->{filter_intersect};
foreach ('all','non_rel','na') {
	$checked = ($$obj->{filter_intersect} eq $_) ? " checked='true'" : '';
	$viewName = "Metric $_";
	$viewTitle = "Metric $_ Title";
	print "<span class='rule' title='$$lang->{$viewTitle}' onclick='next(this)'><input type='radio' value='$_' name='intersect'$checked>$$lang->{$viewName}</span>";
}
print <<END;
	</td></tr>
	</table>
</td>
</tr>
<tr class='page_skeleton'>
<td class='page_skeleton' style='height:100%'>
	<table class="neutral_100" style='height:100%'>
	<tr>	<td colspan="3" class="neutral_bold">
		$$lang->{'Agregation level'}
	</td></tr>
	<tr>	<td><img src="$${skinPath}img/attr.$$imgType"></td>
		<td align="center" style="width:100%">
			<select onclick="drop_select(this)" id="metric_attributes" name="agreg" maxlength="100" readonly size="4" style="width:100%" multiple>
				<option value=""></option>
			</select>
END
my $hlp;
foreach (@@{$$obj->{aggr_def}}) {
		$hlp .= "$_|";
	}
print <<END;
			<input type="hidden" id="metric_attributes_id" value="$hlp" />
		</td>
		<td><img class="cursor" src="$${skinPath}img/delete.$$imgType" title="$$lang->{Delete}" onclick="emptySelect('metric_attributes')"></td></tr>
	<tr><td colspan="3" style="text-align:right">
		<span class="rule">$$lang->{'Metric Rule'}</span>
END
$$obj->{aggr_type} = 'specific' if !$$obj->{aggr_type};
foreach ('specific','report','none') {
	$checked = ($$obj->{aggr_type} eq $_) ? " checked='true'" : '';
	$viewName = "Metric $_";
	$viewTitle = "Metric $_ Title";
	print "<span class='rule' onclick='next(this)' title='$$lang->{$viewTitle}'><input type='radio' value='$_' name='aggr_rule'$checked>$$lang->{$viewName}</span>";
}
print <<END;
	</td></tr>
	</table>
</td></tr>
<tr class='page_skeleton'>
<td class='page_skeleton' colspan='2'>
	<table class='neutral_100'>
	<tr><td align='center'>
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" onclick="multiple(); return metric_checker()"/></td>
				<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As'}" onclick="multiple(); return readName();"/>
							<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="subst_ID_expr('object_metric');subst_ID('metric_filter');fillSelect('metric_attributes');"/></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td></tr></table>
<script type="text/javascript">
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Metric Save'}$$lang->{'New Save Part2'}";
	subst_ID('metric_filter');
	subst_ID_expr('object_metric');
	fillSelect('metric_attributes');
	var params = "$allParams";
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Metric'}";
	reloadTree($saved);
</script>
END
}

#---------------------------------------------------

sub set_next_param {
	my $o=shift;
	$o->{expr} = param('expr_id');
	$o->{filter_def} = param('filter_id');	# filter_name should be replaced to filter in form as well
	$o->{filter_intersect} = param('intersect');
	$o->{aggr_def} = [param('agreg')];	# format_name should be replaced to format in form as well
	$o->{aggr_type} = param('aggr_rule');
	$o->{output} = (param('output')) ? param('output') : "%.2f";
}

1
@


1.4
log
@mod-perl implementation stage 1, rebuilding global vars in .pl to global pointers
@
text
@d4 1
a4 1
# $Id: metric_def_ed.pl,v 1.3 2003/09/26 08:33:00 jiri_schmid Exp $
@


1.3
log
@formta2d layout final stage of implementation
@
text
@d4 1
a4 1
# $Id: metric_def_ed.pl,v 1.2 2003/09/19 10:23:50 jiri_schmid Exp $
a6 2
use CGI qw( :standard );
use CGI::Pretty;
d8 1
a8 4
require "const.def";
require "local_lib.pl";

use vars qw($ID $Obj $ObjT $descr_w $descr_r $name_w $use_lang $lang $saved @@Languages $itemWidth $DefaultLanguage $all_params $skin $skinPath $imgType);
d14 6
a20 1
	my $name = LocalizedObj($Obj->{name}, "Object #$ID", lc($use_lang), $DefaultLanguage);	
d22 1
a22 1
<input type="hidden" value="$Obj->{filter_def}" id="ITEMS"/><br />
d27 2
a28 2
	<tr>	<td class="neutral_bold" colspan="3">$lang->{'Metric expresion'}</td></tr>
	<tr>	<td valign="top"><img src="${skinPath}img/tree/metric.$imgType" vspace="5"><br><img src="${skinPath}img/tree/attr.$imgType"><br><img src="${skinPath}img/tree/fact.$imgType" vspace="5"><br><img src='${skinPath}img/tree/attr_form.$imgType'></td>
d31 1
a31 1
			<input type="hidden" name="expr_id" id="object_metric_id" value="$Obj->{expr}"/>
d33 1
a33 1
		<td valign="bottom" align="center"><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{Delete}" onclick='clear_name(document.metric.expr);return true;'></td></tr>
d38 6
a43 6
			<tr>	<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"(");'><a name="lb" class="cursor">(</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,")");'><a name="rb" class="cursor">)</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"+");'><a name="pl" class="cursor">+</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"-");'><a name="mi" class="cursor">-</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"*");'><a name="ti" class="cursor">*</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"/");'><a name="di" class="cursor">/</a></td></tr>
d48 5
a52 5
			<tr>	<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"SUM()");'><a name="sum" class="cursor">SUM</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"AVG()");'><a name="avg" class="cursor">AVG</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"COUNT()");'><a name="count" class="cursor">COUNT</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"MAX()");'><a name="max" class="cursorr">MAX</a></td>
				<td class="visual_up_button" onmouseover='active(this)' onmouseout='passive(this)' onclick='exprr(document.metric.expr,"MIN()");'><a name="min" class="cursor">MIN</a></td></tr>
d57 1
a57 1
	<tr><td></td><td style="text-align:right">$lang->{'Metric Output'}: <input onclick="drop_input(this)" value="$Obj->{output}" name="output" type="text" size="20"/></td><td></td></tr>
d63 1
a63 1
		$lang->{'Metric Filter'}
d65 1
a65 1
	<tr><td><img src="${skinPath}img/filter.$imgType"</td>
d68 1
a68 1
			<input type="hidden" id="metric_filter_id" name="filter_id" value="$Obj->{filter_def}"/>
d70 1
a70 1
		<td><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{Delete}" onclick="clearItem('metric_filter')"></td></tr>
d72 1
a72 1
		<span class="rule">$lang->{'Metric Intersect'}</span>
d77 1
a77 1
$Obj->{filter_intersect} = 'all' if !$Obj->{filter_intersect};
d79 1
a79 1
	$checked = ($Obj->{filter_intersect} eq $_) ? " checked='true'" : '';
d82 1
a82 1
	print "<span class='rule' title='$lang->{$viewTitle}' onclick='next(this)'><input type='radio' value='$_' name='intersect'$checked>$lang->{$viewName}</span>";
d93 1
a93 1
		$lang->{'Agregation level'}
d95 1
a95 1
	<tr>	<td><img src="${skinPath}img/attr.$imgType"></td>
d102 1
a102 1
foreach (@@{$Obj->{aggr_def}}) {
d108 1
a108 1
		<td><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{Delete}" onclick="emptySelect('metric_attributes')"></td></tr>
d110 1
a110 1
		<span class="rule">$lang->{'Metric Rule'}</span>
d112 1
a112 1
$Obj->{aggr_type} = 'specific' if !$Obj->{aggr_type};
d114 1
a114 1
	$checked = ($Obj->{aggr_type} eq $_) ? " checked='true'" : '';
d117 1
a117 1
	print "<span class='rule' onclick='next(this)' title='$lang->{$viewTitle}'><input type='radio' value='$_' name='aggr_rule'$checked>$lang->{$viewName}</span>";
d126 1
a126 1
	<tr><td align='right'>
d128 2
a129 2
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" onclick="multiple(); return metric_checker()"/></td>
				<td class="buttons">	<input type="submit" name="Action" value="$lang->{'Save As'}" onclick="multiple(); return readName();"/>
d131 1
a131 1
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" onclick="subst_ID_expr('object_metric');subst_ID('metric_filter');fillSelect('metric_attributes');"/></td>
d138 1
a138 1
	var msg="$lang->{'New Save Part1'}$lang->{'New Metric Save'}$lang->{'New Save Part2'}";
d143 1
a143 1
	var saveAsMsg = "$lang->{SaveAsMsg}$lang->{'New Metric'}";
@


1.2
log
@fixies
@
text
@d4 1
a4 1
# $Id: metric_def_ed.pl,v 1.1 2003/09/18 14:10:50 jiri_schmid Exp $
d23 1
a23 1
<table class="page_skeleton" cellspacing="0">
d25 1
a25 1
<td class="page_skeleton">
d61 1
a61 1
	<table class="neutral" style='height:100%'>
d86 6
a91 1
	<tr><td colspan="3"><hr></td></tr>
d96 2
a97 2
		<td align="center">
			<select onclick="drop_select(this)" id="metric_attributes" name="agreg" maxlength="100" readonly size="2" style="width:100%; z-index:0" multiple>
@


1.1
log
@tabs imlemented almost everywhere
@
text
@d4 1
a4 1
# $Id: metric_ed.pl,v 1.62 2003/09/09 09:41:30 jiri_schmid Exp $
d21 3
a23 3
	print <<END ;
<br />
<table class="page_skeleton">
d130 2
a131 3
</td></tr>
</table>
<input type="hidden" value="$Obj->{filter_def}" id="ITEMS"/>
@

