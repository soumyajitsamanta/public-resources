head	1.18;
access;
symbols;
locks; strict;
comment	@# @;


1.18
date	2003.10.31.12.47.57;	author jiri_schmid;	state dead;
branches;
next	1.17;

1.17
date	2003.10.17.11.36.16;	author jiri_schmid;	state Exp;
branches;
next	1.16;

1.16
date	2003.10.16.14.08.53;	author jiri_schmid;	state Exp;
branches;
next	1.15;

1.15
date	2003.09.19.10.23.50;	author jiri_schmid;	state Exp;
branches;
next	1.14;

1.14
date	2003.09.01.12.40.08;	author jiri_schmid;	state Exp;
branches;
next	1.13;

1.13
date	2003.08.13.14.22.03;	author jiri_schmid;	state Exp;
branches;
next	1.12;

1.12
date	2003.07.18.10.51.02;	author jiri_schmid;	state Exp;
branches;
next	1.11;

1.11
date	2003.07.09.15.30.18;	author jiri_schmid;	state Exp;
branches;
next	1.10;

1.10
date	2003.07.08.10.39.05;	author jiri_schmid;	state Exp;
branches;
next	1.9;

1.9
date	2003.07.08.08.24.46;	author jiri_schmid;	state Exp;
branches;
next	1.8;

1.8
date	2003.07.08.07.12.06;	author jiri_schmid;	state Exp;
branches;
next	1.7;

1.7
date	2003.07.07.14.17.14;	author jiri_schmid;	state Exp;
branches;
next	1.6;

1.6
date	2003.06.04.11.22.37;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.05.21.08.05.06;	author michald;	state Exp;
branches;
next	1.4;

1.4
date	2003.05.15.12.01.34;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.05.15.11.36.11;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.05.13.15.19.00;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.05.08.15.35.51;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.18
log
@mod perl rocks!
@
text
@#-----------------------------------------------------
#  Report Editation
#-----------------------------------------------------
# $Id: report_sql_ed.pl,v 1.17 2003/10/17 11:36:16 jiri_schmid Exp $

use strict;
require "local/local_lib.pl";

our($sqlCols,$sqlRows);

#-----------------------------------------------------
sub generateContent {
my($variables, $lang, $obj) = (shift, shift, shift);

my $saveRun = $$variables->{saveRun} if exists $$variables->{saveRun};
my $imgType = \$$variables->{imgType};
my $skinPath = \$$variables->{skinPath};

print "<script src='js/report.js' type='text/javascript'></script>";

my $sqlAccess=param('sqlA');
return if ($sqlAccess eq 'none');	# user has no access to SQL

my $sql='nejakej SELECT';	# here should be access to SQL Generator --> generateSql();
my $origCustomSql = $$obj->{sql_def};

$sql =~ s/\\n/\n/g;	# substitute <BR> as \n
print <<END ;

<br />
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral">
	<tr><td class="neutral_title">$$lang->{'Report SQL'}</td></tr>
	<tr><td class="neutral">
END
	if ($$variables->{allParams} =~ /sqlA=edit/ ) {	# user has access to SQL editation
		my %ch;
		my $view;
		my $readOnly;
		if ($origCustomSql) {
			$ch{edited}='checked';
			($view = $origCustomSql) =~ s/\\n/\n/g;
			$readOnly = "";
		} else {
			$origCustomSql = $view = $sql;
			$ch{default}='checked'; 
			$readOnly = "readonly";
		}
		
print <<END ;
		<INPUT TYPE="RADIO" NAME="sql_use" id="generatedSql" onclick="defaultSql()" VALUE="default"$ch{default} />
		<span class="cursor" onclick="switchSql('generatedSql')">$$lang->{'Report Default SQL'}</span>&nbsp;
		<img class="cursor" src="$${skinPath}img/rightArr.$$imgType" onclick="copySql()" title="$$lang->{Copy}">&nbsp;
		<INPUT TYPE="RADIO" NAME="sql_use" id="customSql" onclick="editSql()" VALUE="edited"$ch{edited} />
		<span class="cursor" onclick="switchSql('customSql')">$$lang->{'Report Edited SQL'}</span>
		<img class="cursor" src="$${skinPath}img/delete.$$imgType" onclick="clearSql()" title="$$lang->{Delete}">
	</td></tr>
	<tr><td><TEXTAREA NAME="expr" id="expr" ROWS="$sqlRows" COLS="$sqlCols" WRAP="SOFT" onchange="object_changed()" $readOnly>$view</TEXTAREA>
	<input type="hidden" value="$sql" name="expr_id" id="expr_id" />
	</td></tr>
	</table>
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral_100">
	<tr><td align="center">
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" id="SQLSAVE" onclick="saveSql()"/></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}" onclick="saveSql()" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" id="SQLRELOAD" onclick="reloadSql()"/></td>
		</tr>
		</table>
	</td></tr>
	</table>


END
	} elsif ($sqlAccess eq 'view') {	# user has view access to SQL only
		print SQL2HTML($sql)
	}
print "</td><td></table><script type='text/javascript' src='js/report_sql.js'></script><script type='text/javascript'>";
print "var customSql = '$origCustomSql';";
print "var originalCustomSql = '$origCustomSql';$saveRun</script>";
END
}

#---------------------------------------------------
sub set_next_param {
	my $o=shift;

if (param('expr_id') eq "") {
		delete($o->{sql_def});
	} else {
		(my $hlp = param('expr_id')) =~ s/\r//g;
		($o->{sql_def} = $hlp) =~ s/\n/\\n/g;
	}
}


1
@


1.17
log
@last changes-fixies coresponding mod-perl stage 1
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.16 2003/10/16 14:08:53 jiri_schmid Exp $
@


1.16
log
@mod-perl implementation stage 1, rebuilding global vars in .pl to global pointers
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.15 2003/09/19 10:23:50 jiri_schmid Exp $
d68 1
a68 1
	<tr><td align="right">
@


1.15
log
@fixies
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.14 2003/09/01 12:40:08 jiri_schmid Exp $
d7 1
a7 7
use CGI qw( :standard );
use CGI::Pretty;
use Encode;
require "const.def";
require "local_lib.pl";

use vars qw($ID $Obj $ObjT $descr_w $descr_r $name_w $use_lang $open $sqlCols $sqlRows $User $all_params $saveRun $skinPath $imgType);
d9 1
d12 2
d15 3
a17 4

sub generateContent {
#use Data::Dumper;
#print "<pre>".Dumper($ObjPref)."</pre>";
d25 1
a25 1
my $origCustomSql = $Obj->{sql_def};
d35 1
a35 1
	<tr><td class="neutral_title">$lang->{'Report SQL'}</td></tr>
d38 1
a38 1
	if ($all_params =~ /sqlA=edit/ ) {	# user has access to SQL editation
d54 2
a55 2
		<span class="cursor" onclick="switchSql('generatedSql')">$lang->{'Report Default SQL'}</span>&nbsp;
		<img class="cursor" src="${skinPath}img/rightArr.$imgType" onclick="copySql()" title="$lang->{Copy}">&nbsp;
d57 2
a58 2
		<span class="cursor" onclick="switchSql('customSql')">$lang->{'Report Edited SQL'}</span>
		<img class="cursor" src="${skinPath}img/delete.$imgType" onclick="clearSql()" title="$lang->{Delete}">
d70 3
a72 3
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" id="SQLSAVE" onclick="saveSql()"/></td>
			<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save and Run'}" onclick="saveSql()" /></td>
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" id="SQLRELOAD" onclick="reloadSql()"/></td>
@


1.14
log
@skins implemented. mozilla skin - temporarily copy msie content
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.13 2003/08/13 14:22:03 jiri_schmid Exp $
d62 1
a62 1
		<img class="cursor" src="${skinPath}img/delete.$imgType.$imgType" onclick="clearSql()" title="$lang->{Delete}">
@


1.13
log
@code clearing and improvment
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.12 2003/07/18 10:51:02 jiri_schmid Exp $
d13 1
a13 1
use vars qw($ID $Obj $ObjT $descr_w $descr_r $name_w $use_lang $open $sqlCols $sqlRows $User $all_params $saveRun);
d59 1
a59 1
		<img class="cursor" src="img/rightArr.gif" onclick="copySql()" title="$lang->{Copy}">&nbsp;
d62 1
a62 1
		<img class="cursor" src="img/delete.gif" onclick="clearSql()" title="$lang->{Delete}">
@


1.12
log
@format3d implemented, format changed all dependencies fixed
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.11 2003/07/09 15:30:18 jiri_schmid Exp $
a94 1
	my($cgi) = shift;
@


1.11
log
@minor bug fixies, 3dgraph interface changes
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.10 2003/07/08 10:39:05 jiri_schmid Exp $
d13 1
a13 1
use vars qw($ID $Obj $ObjT $descr_w $descr_r $name_w $use_lang $open $sqlCols $sqlRows $User $all_params);
d75 1
d89 1
a89 1
print "var originalCustomSql = '$origCustomSql';</script>";
@


1.10
log
@minor utf8 final changes
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.9 2003/07/08 08:24:46 jiri_schmid Exp $
d9 1
a9 1

d29 1
a29 1
my $customSql = $Obj->{sql_def};
d46 1
a46 1
		if ($customSql) {
d48 1
a48 1
			$view = $customSql;
d51 1
a51 1
			$customSql = $view = $sql;
d55 1
d86 3
a88 11
	
print <<END ;
</td><td>
</table>
<script type="text/javascript" src="js/report_sql.js"></script>
<script type="text/javascript">
<!--
	var customSql = "$customSql";
	var originalCustomSql = "$customSql";
-->
</script>
d100 2
a101 1
		$o->{sql_def} = param('expr_id');
@


1.9
log
@binmode for STDIN changes
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.8 2003/07/08 07:12:06 jiri_schmid Exp $
d103 2
a104 1
	if (param('expr_id') eq "") {
a107 1
		
@


1.8
log
@utf8 implementation in last stage
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.7 2003/07/07 14:17:14 jiri_schmid Exp $
a102 2
#use Data::Dumper;
#print "<pre>".Dumper($o)."</pre>";
d107 1
@


1.7
log
@utf8 may work properly
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.6 2003/06/04 11:22:37 jiri_schmid Exp $
d48 1
a48 1
			$view = encode_utf8($customSql);
@


1.6
log
@bug fixies
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.5 2003/05/21 08:05:06 michald Exp $
d48 1
a48 1
			$view = $customSql;
@


1.5
log
@minor improovement in debug list page
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.4 2003/05/15 12:01:34 jiri_schmid Exp $
d13 1
a13 1
use vars qw($ID $Obj $ObjT $descr_w $descr_r $name_w $use_lang $open $sqlCols $sqlRows $User);
d42 1
a42 1
	if ($sqlAccess eq 'edit') {	# user has access to SQL editation
@


1.4
log
@code improvment
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.3 2003/05/15 11:36:11 jiri_schmid Exp $
d29 1
a29 1
my $customSql = $Obj->{sql_def}->{expr};
d105 5
a109 7
if (param('expr_id') eq "") {
	delete($o->{sql_def});
} else {
	my $hlp;
	$hlp->{'expr'} = param('expr_id');
	$o->{sql_def} = $hlp;
}
@


1.3
log
@report - sql tab implemented
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.2 2003/05/13 15:19:00 jiri_schmid Exp $
a19 2
our $ObjPref = SOAP->LoadUserPref($User);

d25 1
a25 1
my $sqlAccess=$ObjPref->{'Beard'}->{'sql-access'};
d28 1
a28 1
my $sql='Default SQL';	# here should be access to SQL Generator --> generateSql();
a64 6
END
	} elsif ($sqlAccess eq 'view') {	# user has view access to SQL only
		print SQL2HTML($sql)
	}
	
print <<END ;
d79 8
@


1.2
log
@new report page seems to be fullfunctional, javascript code huge improvment
@
text
@d4 1
a4 1
# $Id: report_sql_ed.pl,v 1.1 2003/05/08 15:35:51 jiri_schmid Exp $
d22 3
a25 7
	if ($Obj->{sql}) {	# customized SQL was set in MD
		printsql($ObjPref->{'Beard'}->{'sql-access'}, $Obj->{sql}, 1);
	} else {	# let use default SQL
		printsql($ObjPref->{'Beard'}->{'sql-access'}, 'Default SQL');	# here should be access to SQL Generator
	}
	
}
d27 8
a34 1
#---------------------------------------------------
d36 1
a36 8
sub printsql {
	my $sqlac=shift;
	my $sql=shift;
	my $custsql=shift;
	return if ($sqlac eq 'none');	# user has no access to SQL
	$sql =~ s/\\n/\n/g;	# substitute <BR> as \n
	print <<END ;
<br>
a37 1
<tr><td class="neutral_title">$lang->{'Report SQL'}</td></tr>
d41 1
d44 1
a44 2

	if ($sqlac eq 'edit') {	# user has access to SQL editation
d46 3
a48 1
		if ($custsql) {
d50 2
d53 11
a63 5
			$ch{default}='checked';
		}		
		print <<END ;
$lang->{'Use'} <INPUT TYPE=RADIO NAME="sql_use" VALUE="default"$ch{default}>$lang->{'Default SQL'}
 <INPUT TYPE=RADIO NAME="sql_use" VALUE="edited"$ch{edited}>$lang->{'Edited SQL'}
d65 2
a66 1
	<tr><td><TEXTAREA NAME="sql" ROWS="$sqlRows" COLS="$sqlCols" WRAP=SOFT>$sql</TEXTAREA>
d68 1
a68 1
	} elsif ($sqlac eq 'view') {	# user has view access to SQL only
d72 1
a72 1
	print <<END ;
d76 12
d89 7
d100 14
@


1.1
log
@report huge improvment
@
text
@d4 1
a4 1
# $Id: report_ed.pl,v 1.40 2003/05/08 07:42:46 michald Exp $
d40 1
@

