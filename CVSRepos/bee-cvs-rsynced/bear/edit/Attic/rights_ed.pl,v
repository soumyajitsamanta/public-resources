head	1.15;
access;
symbols;
locks; strict;
comment	@# @;


1.15
date	2003.10.13.14.43.23;	author jiri_schmid;	state dead;
branches;
next	1.14;

1.14
date	2003.09.29.09.21.58;	author jiri_schmid;	state Exp;
branches;
next	1.13;

1.13
date	2003.09.16.14.37.52;	author jiri_schmid;	state Exp;
branches;
next	1.12;

1.12
date	2003.09.15.13.04.08;	author jiri_schmid;	state Exp;
branches;
next	1.11;

1.11
date	2003.09.15.10.46.12;	author jiri_schmid;	state Exp;
branches;
next	1.10;

1.10
date	2003.09.10.09.08.58;	author jiri_schmid;	state Exp;
branches;
next	1.9;

1.9
date	2003.09.01.12.40.08;	author jiri_schmid;	state Exp;
branches;
next	1.8;

1.8
date	2003.08.28.09.26.16;	author jiri_schmid;	state Exp;
branches;
next	1.7;

1.7
date	2003.08.26.15.35.45;	author jiri_schmid;	state Exp;
branches;
next	1.6;

1.6
date	2003.08.25.15.09.20;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.08.22.16.01.03;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2003.08.20.14.23.45;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.13.14.45.28;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.08.13.14.22.03;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.08.13.13.16.29;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.15
log
@description tab defined under two files, bug fixies
@
text
@#-----------------------------------------------------
# Access rigths definition
#-----------------------------------------------------
# $Id: rights_ed.pl,v 1.14 2003/09/29 09:21:58 jiri_schmid Exp $

use strict;
use CGI qw( :standard );
use CGI::Pretty;

require "const.def";
use vars qw($ID $Obj $lang $descr_w $descr_r $itemWidth $use_lang $all_params $skin $skinPath $imgType);

#-----------------------------------------------------

sub print_form {
print startform(-action=>'', -name=>'rights');
print hidden('all_params',$all_params);
my $name = LocalizedObj($Obj->{name},"name ? $ID",$use_lang,'en');
print <<END ;
<input type='hidden' value='$use_lang' id='activeLang' name='active_lang' />
<input type="hidden" name="item_id" id="ITEM_ID" value="$ID" />
<input type="hidden" name="prava" id="prava" value="1" />
<input type="hidden" name="skin" id="skin"  value="$skin" />
<input type="hidden" name="imgType" id="imgType"  value="$imgType" />
<table><tr><td width="20"><img src="${skinPath}img/role.$imgType"></td><td class='neutral_bold'>$lang->{'Rights'}</td></tr></table>
<br/>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class='neutral_rights'>
		<tr><td colspan="2" class="neutral_bold">$lang->{'Name'}</td></tr>
		<tr><td colspan="2" class="neutral_center">
			<input value="$name" type="text" id="NAME" disabled='disabled' style='width:100%'>
		</td></tr>
		<tr><td colspan="2"><hr/></td></tr>
END
foreach my $char ('A','D') {	
	my $cnt = 1;
	my $type = ($char eq 'A') ? "allow" : "deny";
	my $name = ($char eq 'A') ? "Rights Allow" : "Rights Deny";
print <<END;
		<tr><td colspan="2" class="neutral_bold">$lang->{$name}:</td></tr>
		<tr><td colspan="2">
		<table class='visual_grid_rights' style='border-collapse:collapse; width:100%' onclick="dropRights(this,'$char')">
		<tr><td></td><td></td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td><td style='text-align:center'>$lang->{'Duplicate'}</td></tr>
END
	my @@ids = ($Obj->{acl} eq 'all') ? delete $Obj->{acl} : keys %{$Obj->{acl}{$type}};
	my $rights = SOAP->GetLocalizedRights($use_lang,undef,$ID,@@ids);

	foreach my $role (sort (keys %{$rights})) {
		next if ($role =~ /root$/);
		$rights->{$role}{rights} = $Obj->{acl}{$type}{$role} if  exists $Obj->{acl}{$type}{$role};
		my $style = ($cnt%2 == 1) ? 'class="even"' : '';
		my $checked;
print <<END;
		<tr $style>
			<td class='cursor' onclick='selfRemove(this)'>
				<img src="${skinPath}img/drop.$imgType"/>
			</td>
			<td title='$rights->{$role}{description}'>
				$rights->{$role}{name}
				<input type='hidden' name="$char$role" value='$rights->{$role}{rights}'/>
			</td>
END
			foreach ('R','W','E','D') {
				$name = "$char$role$_";
				$checked = ($rights->{$role}{rights} =~ /$_/) ? "checked='checked'" : "";
				print "<td style='text-align:center'><input type='checkbox' onclick='checkCouple(this)' name='$name' $checked/></td>";
			}
			print "</tr>";
			$cnt++;
		}
	print "</table></td></tr>";
}
print <<END;
		<tr><td colspan="2"><hr/></td></tr>
		<tr><td colspan="2" align="center">
			<table class="buttons">
			<tr>
				<td class="buttons"><input type="submit" name="return" value="$lang->{'Return'}" onclick='return setPreviusPage()'/></td>
				<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" id='save' onclick='object_cleared()' /></td>
			</tr>
			</table>
		</td></tr>
	</table>
</td></tr></table>
<script type='text/javascript' src='js/rights.js'></script>
END
print &endform;
}

#---------------------------------------------------
sub set_next_param {
my $ACLhlp;
if (param('Remove')) {
	my $what = param('Remove');
	delete $Obj->{acl}{$what};
	return
} else {
	foreach my $role (sort(SOAP->GetRolesList(undef,$ID))) {
		next if $role =~ /root$/;
		foreach my $typ ('A','D') {
			if (param("$typ$role")) {
				my $rwe = '';
				foreach ('R','W','E','D') {
					$rwe .= (param("$typ$role$_")) ? $_ : '-';
				}
				if ($typ eq 'A') {
					$ACLhlp->{allow}{$role} = $rwe;
				} else {
					$ACLhlp->{deny}{$role} = $rwe;
				}
			}
		}
	}
}
delete $Obj->{acl} if exists $Obj->{acl};
$Obj->{acl} = $ACLhlp if $ACLhlp;
}

#---------------------------------------------------
@


1.14
log
@code improvments a fixies
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.13 2003/09/16 14:37:52 jiri_schmid Exp $
@


1.13
log
@rights page user improvments, unbelieveble IE bug fixed
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.12 2003/09/15 13:04:08 jiri_schmid Exp $
d51 1
a51 1
		next if ($role eq 'root');
d101 1
a101 1
		next if $role eq 'root';
@


1.12
log
@code changes and improvments
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.11 2003/09/15 10:46:12 jiri_schmid Exp $
d20 3
a22 3
<input type='hidden' value='$use_lang' id='activeLang' name='active_lang'/>
<input type="hidden" name="item_id" id="ITEM_ID" value="$ID"/>
<input type="hidden" name="Rights" id="Rights"  value="1" />
d42 1
a42 3
		<tr>	<td class="neutral_bold">$lang->{$name}:</td>
			<td style='text-align:right'><input type='hidden' name='Remove' id='Remove' /><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{'Rights Remove Title'}" onclick="removeRights('$type')"></td>
		</tr>
d68 1
a68 1
				print "<td style='text-align:center'><input type='checkbox' name='$name' id='$name' $checked/></td>";
d81 1
a81 1
				<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" id='save' /></td>
@


1.11
log
@acl changes implemented
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.10 2003/09/10 09:08:58 jiri_schmid Exp $
d49 2
a50 1
	my $rights = ($type eq 'deny') ? SOAP->GetLocalizedRights($use_lang,undef,$ID,keys %{$Obj->{acl}{$type}}) : (exists ($Obj->{acl}{allow})) ?  SOAP->GetLocalizedRights($use_lang,undef,$ID,keys %{$Obj->{acl}{$type}}) : SOAP->GetLocalizedRights($use_lang,undef,$ID,keys %{$Obj->{acl}{$type}},'all');
a83 1
				<td class="buttons"><input type="reset" value="$lang->{'Reset'}" /></td>
@


1.10
log
@ACl changes, report outup visual improvments
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.9 2003/09/01 12:40:08 jiri_schmid Exp $
a17 1
print hidden('skin',$skin);
d23 2
d36 8
a43 2
		<tr>	<td class="neutral_bold">$lang->{'Right'}:</td>
			<td style='text-align:right'><input type='hidden' name='Remove' id='Remove' /><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{'Rights Remove Title'}" onclick="removeRights()"></td>
d46 2
a47 2
		<table class='visual_grid_rights' style='border-collapse:collapse' onclick='dropRights(this)'>
		<tr><td class='cursor' onclick='setAll("include")' title="$lang->{'Rights Include Title'}">$lang->{'Rights Include'}</td><td></td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td><td style='text-align:center'>$lang->{'Duplicate'}</td></tr>
d49 2
a50 6
	my $cnt = 1;
	my $lock = delete $Obj->{acl}{lock}{enable};
	my $rights = SOAP->GetAllLocalizedRights($use_lang,undef,$ID);
	my @@roles;
	$lock = ($lock) ? "checked='checked'" : '';
	my (@@activeRoles, @@allRoles);
d53 1
a54 1
		push (@@allRoles,"$role:'$rights->{$role}{rights}'");
a55 7
		if (exists $Obj->{acl}{allow}{$role}) {
			$checked = "checked='checked'";
			$rights->{$role}{rights} = $Obj->{acl}{allow}{$role};			
		} else {
			next if ($lock);
			$checked = '';
		}
d58 2
a59 2
			<td style='text-align:center' title="$lang->{'Rights Include Title'}">
				<input type='checkbox' id='include$role' name='include$role' $checked/>
d63 1
a63 1
				<input type='hidden' name='$role' value='$rights->{$role}{rights}'/>
d67 1
a67 1
				my $name = "$role$_";
a72 1
			push(@@activeRoles,"'$role'");
d74 2
a75 2
	my $activeroles = join(",",@@activeRoles);
	my $allRoles = join(",",@@allRoles);
a76 2
			</table>
		</td></tr>
a77 1
		<tr><td colspan="2" title="$lang->{'Rights Lock Title'}"><input type='checkbox' name='Lock' $lock />&nbsp;$lang->{'Rights Lock'}</td></tr>
a89 4
<script type='text/javascript'>
	var roles = new Array($activeroles);
	var allRoles = {$allRoles};
</script>
a96 1
my $lock = delete $Obj->{acl}{lock}{enable};
d98 2
a99 1
	delete $Obj->{acl};
d104 11
a114 10
		if (param($role)) {
			my $rwe = '';
			foreach ('R','W','E','D') {
				my $paramName = "$role$_";
				$rwe .= (param($paramName)) ? $_ : '-';
			}
			my $include = "include$role";
			my $save = (param($include)) ? 1 : ($rwe eq param($role)) ? 0 : 1;
			if ($save) {
				$ACLhlp->{allow}{$role} = $rwe;
a118 1
$ACLhlp->{lock}{enable} = param('Lock') if ($lock || param('Lock'));
@


1.9
log
@skins implemented. mozilla skin - temporarily copy msie content
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.8 2003/08/28 09:26:16 jiri_schmid Exp $
d43 1
a43 1
	my $lock = delete $Obj->{acl}{lock};
d53 1
a53 1
		if (exists $Obj->{acl}{$role}) {
d55 1
a55 1
			$rights->{$role}{rights} = $Obj->{acl}{$role};			
d109 1
a109 1
my $lock = delete $Obj->{acl}{lock};
d125 1
a125 1
				$ACLhlp->{$role} = $rwe;
d130 1
a130 1
$ACLhlp->{lock} = param('Lock') if ($lock || param('Lock'));
@


1.8
log
@tabs.cgi speed improvmnet, visual improvment on trees, rights and some other minor improvments
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.7 2003/08/26 15:35:45 jiri_schmid Exp $
d11 1
a11 1
use vars qw($ID $Obj $lang $descr_w $descr_r $itemWidth $use_lang $all_params);
d17 2
a22 1
<input type="hidden" name="all_params" value="$all_params" />
d24 1
a24 1
<table><tr><td width="20"><img src="img/role.gif"></td><td class='neutral_bold'>$lang->{'Rights'}</td></tr></table>
d36 1
a36 1
			<td style='text-align:right'><input type='hidden' name='Remove' id='Remove' /><img class="cursor" src="img/delete.gif" title="$lang->{'Rights Remove Title'}" onclick="removeRights()"></td>
d90 1
a90 1
				<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" /></td>
@


1.7
log
@rights improvment, create delete duplicate rule implemented
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.6 2003/08/25 15:09:20 jiri_schmid Exp $
d38 1
a38 1
		<table class='visual_grid_rights' style='border-collapse:collapse' onclick='dropRights()'>
d43 5
a47 4
	my $rights = ($lock) ? SOAP->GetLocalizedRights($use_lang,undef,$ID,keys (%{$Obj->{acl}})) : SOAP->GetAllLocalizedRights($use_lang,undef,$ID);
	$lock = ($lock) ? "checked='checked'" : "";
	my @@activeRoles;
	foreach my $role (sort (keys %{$rights} )) {
d50 27
a76 7
		my $checked = (exists $Obj->{acl}{$role} ) ? "checked='checked'" : "";
		$rights->{$role}{rights} = $Obj->{acl}{$role} if defined $Obj->{acl}{$role};
		print "<tr $style><td style='text-align:center' title=\"$lang->{'Rights Include Title'}\"><input type='checkbox' id='include$role' name='include$role' $checked/></td><td title='$rights->{$role}{description}'>$rights->{$role}{name}<input type='hidden' name='$role' value='$rights->{$role}{rights}'/></td>";
		foreach ('R','W','E','D') {
			my $name = "$role$_";
			$checked = ($rights->{$role}{rights} =~ /$_/) ? "checked='checked'" : "";
			print "<td style='text-align:center'><input type='checkbox' name='$name' id='$name' $checked/></td>";
a77 4
		print "</tr>";
		$cnt++;
		push(@@activeRoles,"'$role'");
	}
d79 1
d88 2
a89 2
				<td class="buttons"><input type="submit" name="return" value="$lang->{'Return'}" onclick='setPreviusPage()'/></td>
				<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" id='save'/></td>
d97 4
a100 1
<script type='text/javascript'>var roles = new Array($activeroles)</script>
a108 1
my @@roles = ($lock) ? keys %{$Obj->{acl}} : SOAP->GetRolesList(undef,$ID);
d113 1
a113 1
	foreach my $role (@@roles) {
d115 11
a125 9
		my $rwe = '';
		foreach ('R','W','E','D') {
			my $paramName = "$role$_";
			$rwe .= (param($paramName)) ? $_ : '-';
		}
		my $include = "include$role";
		my $save = (param($include)) ? 1 : ($rwe eq param($role)) ? 0 : 1;
		if ($save) {
			$ACLhlp->{$role} = $rwe;
@


1.6
log
@object acl, owner, modifier, datetime creation and modification implemented
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.5 2003/08/22 16:01:03 jiri_schmid Exp $
d38 2
a39 2
		<table class='visual_grid_rights' style='border-collapse:collapse'>
		<tr><td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td></tr>
d42 4
a45 1
	my $rights = SOAP->GetLocalizedRights($use_lang,undef,$ID);
d49 1
a49 1
		print "<tr $style><td title='$rights->{$role}{description}'>$rights->{$role}{name}<input type='hidden' name='$role' value='$rights->{$role}{rights}'/></td>";
d51 2
a52 1
		foreach ('R','W','E') {
d54 1
a54 1
			my $checked = ($rights->{$role}{rights} =~ /$_/) ? "checked='checked'" : "";
d59 1
d61 1
d66 1
a66 1
		<tr><td colspan="2" title="$lang->{'Rights Force Title'}"><input type='checkbox' name='Force' />&nbsp;$lang->{'Rights Force'}</td></tr>
d70 1
a70 1
				<td class="buttons"><input type="submit" name="return" value="$lang->{'Return'}" onclick='back()'/></td>
d78 2
a81 4
print <<END;
<script type='text/javascript'> function back() { document.getElementById('Rights').value = 0; } </script>
END
	
d87 2
a88 2
my $force = param('Force');
my @@roles = SOAP->GetRolesList(undef,$ID);
d90 2
a91 1
	delete $Obj->{acl} if exists $Obj->{acl};
d93 12
a104 6
foreach my $role (@@roles) {
	next if $role eq 'root';
	my $rwe = '';
	foreach ('R','W','E') {
		my $paramName = "$role$_";
		$rwe .= (param($paramName)) ? $_ : '-';
a105 4
	my $save = ($force) ? 1 : (exists $Obj->{ACL}{$role}) ? 1 : ($rwe eq param($role)) ? 0 : 1;
	if ($save) {
		$ACLhlp->{$role} = $rwe;
		}
d107 1
d111 2
a112 1
}
@


1.5
log
@access - rules changing implemented
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.4 2003/08/20 14:23:45 jiri_schmid Exp $
d16 3
a18 2
	print startform(-action=>'', -name=>'rights');
	print <<END ;
d22 1
d28 12
a39 5
	<table class='neutral'>
		<tr><td class="neutral_bold">$lang->{'Right'}:</td></tr>
		<tr><td>
			<table class='visual_grid' style='border-collapse:collapse'>
		<tr><td></td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td></tr>
d42 3
a44 2
	my @@role = SOAP->GetRolesList($ID,$use_lang);
	foreach (sort (@@role)) {
d46 8
a53 1
		print "<tr $style><td class='nowrap'>$_</td><td style='text-align:center'><input type='checkbox' name='${_}R' id='${_}R' /></td><td style='text-align:center'><input type='checkbox' name='${_}E' id='${_}E' /></td><td style='text-align:center'><input type='checkbox' name='${_}W' id='${_}W' /></td></tr>";
d59 3
a61 2
		<tr><td><hr/></td></tr>
		<tr><td align="center">
d64 2
a65 2
				<td class="buttons"><input type="submit" name="return" value="$lang->{'Return'}"/></td>
				<td class="buttons"><input type="submit" name="Save" value="$lang->{'Save'}"/></td>
d71 1
a71 1
</td>
d75 1
a75 15
<td>&nbsp;</td>
<td class="page_skeleton">
<table class="neutral">
  <tr><td class="neutral_bold">&nbsp;$lang->{'Name'}</td></tr>
  <tr><td class="neutral_center">
  	<input value="$Obj->{name}" type="text" name="fact_name" id="NAME" size="$itemWidth" maxlength="100" readonly='readonly'>
  </td></tr>
  <tr><td><hr></td></tr>
  <tr><td class="neutral_bold">&nbsp;$lang->{'Description'}</td></tr>
  <tr><td><textarea cols="$descr_w" rows="$descr_r" name="desc" id="DESC" readonly='readonly'></textarea></td></tr>
</table>
</td></tr></table>
<script type="text/javascript">
	subst_item_id();
</script>
d81 23
@


1.4
log
@access object implemented
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.3 2003/08/13 14:45:28 jiri_schmid Exp $
d62 1
a62 1
  	<input value="$Obj->{name}" type="text" name="fact_name" id="NAME" size="$itemWidth" maxlength="100" readonly>
d66 1
a66 1
  <tr><td><textarea cols="$descr_w" rows="$descr_r" name="desc" id="DESC" readonly></textarea></td></tr>
@


1.3
log
@bug fix
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.2 2003/08/13 14:22:03 jiri_schmid Exp $
a14 7
my $role;
$role = {
	1=>'Admin',
	2=>'User',
	3=>'Root',
	4=>'Superman',
};
d33 2
a34 1
	foreach (sort (values %{$role})) {
@


1.2
log
@code clearing and improvment
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.1 2003/08/13 13:16:29 jiri_schmid Exp $
d23 1
a23 1
	print startform(-action=>'' -name=>'rights');
@


1.1
log
@setting up rights inetrface for each object implemnted
@
text
@d4 1
a4 1
# $Id: $
d11 1
a11 1
use vars qw($ID $Obj $lang $descr_w $descr_r $itemWidth $use_lang);
d23 1
a23 1
	print startform(-name=>'rights');
d27 1
@

