head	1.7;
access;
symbols;
locks; strict;
comment	@# @;


1.7
date	2003.10.31.12.47.57;	author jiri_schmid;	state dead;
branches;
next	1.6;

1.6
date	2003.10.16.14.08.53;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.10.09.13.53.24;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2003.09.29.09.21.58;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.09.19.10.23.50;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.09.17.15.40.59;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.09.17.14.51.14;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.7
log
@mod perl rocks!
@
text
@#-----------------------------------------------------
# Access rigths definition
#-----------------------------------------------------
# $Id: rights2_ed.pl,v 1.6 2003/10/16 14:08:53 jiri_schmid Exp $

use strict;

#-----------------------------------------------------
sub generateContent {
my($variables, $lang, $obj) = (shift, shift, shift);

#my $name = LocalizedObj($$obj->{name},"unknown name",$$variables->{useLang},$$variables->{dafaultLang});
print <<END ;
<br/><script type='text/javascript' src='js/rights.js'></script>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class='neutral_rights'>
END
foreach my $char ('A','D') {	
	my $cnt = 1;
	my $type = ($char eq 'A') ? "allow" : "deny";
	my $name = ($char eq 'A') ? "Rights Allow" : "Rights Deny";
print <<END;
		<tr><td colspan="2" class="neutral_bold">$$lang->{$name}:</td></tr>
		<tr><td colspan="2">
		<table class='visual_grid_rights' style='border-collapse:collapse; width:100%' onclick="dropRights(this,'$char')">
		<tr><td></td><td></td><td style='text-align:center'>&nbsp;$$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$$lang->{'Write'}&nbsp;</td><td style='text-align:center'>$$lang->{'Duplicate'}</td></tr>
END
	my @@ids = ($$obj->{acl} =~ /_all$/) ? delete $$obj->{acl} : keys %{$$obj->{acl}{$type}};
	my $rights = SOAP->GetLocalizedRights($$variables->{useLang},undef,$$variables->{id},@@ids);

	foreach my $role (sort (keys %{$rights})) {
		next if ($role =~ /root$/);
		$rights->{$role}{rights} = $$obj->{acl}{$type}{$role} if  exists $$obj->{acl}{$type}{$role};
		my $style = ($cnt%2 == 1) ? 'class="even"' : '';
		my $checked;
print <<END;
		<tr $style>
			<td class='cursor' onclick='selfRemove(this)'>
				<img src="$$variables->{skinPath}img/drop.$$variables->{imgType}"/>
			</td>
			<td title='$rights->{$role}{description}'>
				$rights->{$role}{name}
				<input type='hidden' name="$char$role" value='$rights->{$role}{rights}'/>
			</td>
END
			foreach ('R','W','E','D') {
				my $name = "$char$role$_";
				$checked = ($rights->{$role}{rights} =~ /$_/) ? "checked='checked'" : "";
				print "<td style='text-align:center'><input type='checkbox' onclick='checkCouple(this)' name='$name' $checked/></td>";
			}
			print "</tr>";
			$cnt++;
		}
	print "</table></td></tr>";
}
print <<END;
		<tr><td colspan="2" align="right">
			<table class="buttons">
			<tr>
				<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" id='save' onclick='object_cleared()' /></td>
			</tr>
			</table>
		</td></tr>
	</table>
</td></tr></table>
END
}

#---------------------------------------------------
sub set_next_param {
my ($o, $variables) = (shift, shift);
my $ACLhlp;
$ACLhlp->{allow} = {};
$ACLhlp->{deny} = {};
foreach my $role (sort(SOAP->GetRolesList(undef,$$variables->{id}))) {
	next if $role =~ /root$/;
	foreach my $typ ('A','D') {
		if (param("$typ$role")) {
			my $rwe = '';
			foreach ('R','W','E','D') {
				$rwe .= (param("$typ$role$_")) ? $_ : '-';
			}
			if ($typ eq 'A') {
				$ACLhlp->{allow}{$role} = $rwe;
			} else {
				$ACLhlp->{deny}{$role} = $rwe;
			}
		}
	}
}
delete $o->{acl} if exists $o->{acl};
$o->{acl} = $ACLhlp if $ACLhlp;
}

#---------------------------------------------------
1
@


1.6
log
@mod-perl implementation stage 1, rebuilding global vars in .pl to global pointers
@
text
@d4 1
a4 1
# $Id: rights2_ed.pl,v 1.5 2003/10/09 13:53:24 jiri_schmid Exp $
@


1.5
log
@many EN language fixies
@
text
@d4 1
a4 1
# $Id: rights2_ed.pl,v 1.4 2003/09/29 09:21:58 jiri_schmid Exp $
a6 5
use CGI qw( :standard );
use CGI::Pretty;

require "const.def";
use vars qw($ID $Obj $lang $descr_w $descr_r $itemWidth $use_lang $all_params $skin $skinPath $imgType);
a8 1

d10 1
d12 1
a12 1
my $name = LocalizedObj($Obj->{name},"name ? $ID",$use_lang,'en');
d25 1
a25 1
		<tr><td colspan="2" class="neutral_bold">$lang->{$name}:</td></tr>
d28 1
a28 1
		<tr><td></td><td></td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td><td style='text-align:center'>$lang->{'Duplicate'}</td></tr>
d30 2
a31 2
	my @@ids = ($Obj->{acl} =~ /_all$/) ? delete $Obj->{acl} : keys %{$Obj->{acl}{$type}};
	my $rights = SOAP->GetLocalizedRights($use_lang,undef,$ID,@@ids);
d35 1
a35 1
		$rights->{$role}{rights} = $Obj->{acl}{$type}{$role} if  exists $Obj->{acl}{$type}{$role};
d41 1
a41 1
				<img src="${skinPath}img/drop.$imgType"/>
d49 1
a49 1
				$name = "$char$role$_";
d62 1
a62 1
				<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" id='save' onclick='object_cleared()' /></td>
d73 1
d75 14
a88 18
if (param('Remove')) {
	my $what = param('Remove');
	delete $Obj->{acl}{$what};
	return
} else {
	foreach my $role (sort(SOAP->GetRolesList(undef,$ID))) {
		next if $role =~ /root$/;
		foreach my $typ ('A','D') {
			if (param("$typ$role")) {
				my $rwe = '';
				foreach ('R','W','E','D') {
					$rwe .= (param("$typ$role$_")) ? $_ : '-';
				}
				if ($typ eq 'A') {
					$ACLhlp->{allow}{$role} = $rwe;
				} else {
					$ACLhlp->{deny}{$role} = $rwe;
				}
d93 2
a94 2
delete $Obj->{acl} if exists $Obj->{acl};
$Obj->{acl} = $ACLhlp if $ACLhlp;
d98 1
@


1.4
log
@code improvments a fixies
@
text
@d4 1
a4 1
# $Id: rights2_ed.pl,v 1.3 2003/09/19 10:23:50 jiri_schmid Exp $
d35 1
a35 1
	my @@ids = ($Obj->{acl} eq 'all') ? delete $Obj->{acl} : keys %{$Obj->{acl}{$type}};
@


1.3
log
@fixies
@
text
@d4 1
a4 1
# $Id: rights2_ed.pl,v 1.2 2003/09/17 15:40:59 jiri_schmid Exp $
d39 1
a39 1
		next if ($role eq 'root');
d85 1
a85 1
		next if $role eq 'root';
@


1.2
log
@report tab changes
@
text
@d4 1
a4 1
# $Id: rights2_ed.pl,v 1.1 2003/09/17 14:51:14 jiri_schmid Exp $
d19 1
a19 1
<br/>
a72 1
<script type='text/javascript' src='js/rights.js'></script>
a73 1
print &endform;
@


1.1
log
@tabed rights on graph3d and report
@
text
@d4 1
a4 1
# $Id: rights_ed.pl,v 1.13 2003/09/16 14:37:52 jiri_schmid Exp $
a23 5
		<tr><td colspan="2" class="neutral_bold">$lang->{'Name'}</td></tr>
		<tr><td colspan="2" class="neutral_center">
			<input value="$name" type="text" id="NAME" disabled='disabled' style='width:100%'>
		</td></tr>
		<tr><td colspan="2"><hr/></td></tr>
d64 1
a64 2
		<tr><td colspan="2"><hr/></td></tr>
		<tr><td colspan="2" align="center">
@

