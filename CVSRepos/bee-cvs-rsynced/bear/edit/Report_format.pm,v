head	1.4;
access;
symbols;
locks; strict;
comment	@# @;


1.4
date	2004.02.11.16.06.05;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.11.18.14.38.40;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.11.04.15.19.00;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.10.31.12.47.57;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.4
log
@local format improvment and started implementation of tabs selection
@
text
@#-----------------------------------------------------
#  Report Editation
#-----------------------------------------------------
# $Id	$

package Report_format;

use strict;

#-----------------------------------------------------

sub generateContent {
my($variables, $lang, $obj, $fullobj) = (shift, shift, shift, shift);
my $saved = $$variables->{saved} if exists $$variables->{saved};
my $saveRun = $$variables->{saveRun} if exists $$variables->{saveRun};
my $copy = $$variables->{contentVars} if exists $$variables->{contentVars};

if ($copy == 1) {
	&Local::loadMetadata($$obj->{format_def},$fullobj,$obj);	#$$obj reused for loaded object
	my $hlp;
	$hlp->{format_def} = $$obj;
	$$obj = $hlp;
} elsif ($copy == 2) {
	$$obj->{format_def} = {};
	$$obj->{format_def}->{type} = $$obj->{report_type};
} elsif ($copy == 3) {
	$$obj->{format_def} = {};
	$$obj->{format_def}->{type} = 'graph2d';
}
my ($Type, $Form, $Header);
if (ref($$obj->{format_def}) =~ /HASH/ || $copy > 1) {
	$Type = $$obj->{format_def}->{type} if exists $$obj->{format_def}->{type};
	$Form = $$obj->{format_def}->{form} if exists $$obj->{format_def}->{form};
	$Header = $$obj->{format_def}->{header} if exists $$obj->{format_def}->{header};
	print "<script src='js/report.js' type='text/javascript'></script>";
	print "<script src='js/format.js' type='text/javascript'></script>";
print <<END;
<br />
<table class="page_skeleton" style="width:100%">
<tr class="page_skeleton">
<td class="page_skeleton_ex">
	<IFRAME class="formatIframe" id="formatIframe" name="format" src="format.cgi?Lang=$$variables->{useLang}&Type=$Type&Form=$Form&Header=$Header" width="100%" height="265px" scrolling="auto" frameborder="0"></IFRAME>
</td></tr>
<tr class="page_skeleton">
<td class="page_skeleton" style="border: 2px">
	<table class="neutral_100">
	<tr><td align='center'>
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input id='SAVE' type="submit" name="Action" value="$$lang->{'Save'}" /></td>
			<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save and Run'}"/></td>
			<td class="buttons">	<input type="submit" name="Action" value="$$lang->{'Save As Format'}" onclick="return readName();"/>
						<input type="hidden" name="saveAsName" id="saveAsName" value="" /></td>
			<td class="buttons"><input type="button" name="reset" value="$$lang->{'Reset'}" onclick="self.frames['format'].location.reload(true)"/></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td></tr>
</table>
<input type="hidden" value="$Form" name="form" id="form"/>\
<input type="hidden" value="$Type" name="type" id="type"/>
<input type="hidden" value="$Header" name="header" id="header"/>
<script type="text/javascript" src="js/format.js"></script>
<script type="text/javascript">
<!--
	var msg="$$lang->{'New Save Part1'}$$lang->{'New Format Save'}$$lang->{'New Save Part2'}";
	var saveAsMsg = "$$lang->{SaveAsMsg}$$lang->{'New Format'}";
	$saveRun
	reloadTree($saved);
	reSetIframe();
-->
</script>
END
} else {
if ($$obj->{var_def} eq '') {
	print "<ul><p><b>$$lang->{'Report Unspec Grid'}</b></p></ul>";
} elsif ($$obj->{format_def}) {
	print "<p><b>&nbsp;$$lang->{'Report format'}</b>$$lang->{'Report No Format'}<ul>";
	print "<li><a href=\"javascript: editOriginal('$$obj->{format_def}','Fo');\">$$lang->{'Report Global Edit'}</a></li>";
	print "<li><a href=\"javascript: editLocal('format',1);\">$$lang->{'Report Local Edit'}</a></li></ul>";
} elsif ($$obj->{report_type} eq 'grid') {
	print "<p><b>&nbsp;$$lang->{'Report format'}</b><ul>";
	print "<li><a href=\"javascript: editLocal('format',2);\">$$lang->{'Report Create Grid'}</a></li>";
	print "<li><a href=\"javascript: editLocal('format',3);\">$$lang->{'Report Create G2D'}</a></li></ul>";
} elsif ($$obj->{report_type} eq 'graph3d') {
	print "<p><b>&nbsp;$$lang->{'Report format'}</b><ul>";
	print "<li><a href=\"javascript: editLocal('format',2);\">$$lang->{'Report Create G3D'}</a></li></ul>";
}
	
print "<script type='text/javascript'>reloadTree($saved)</script>";
}}

#---------------------------------------------------
sub set_next_param {
my ($o,$q) = (shift,shift);
my $hlp;
$hlp->{orig_id} = (ref($$o->{format_def})) ? $$o->{format_def}->{orig_id} : $$o->{format_def};	
$hlp->{type} = $$q->param('type');
$hlp->{form} = $$q->param('form');
$hlp->{header} = $$q->param('header') if $$q->param('header');
$$o->{format_def} = $hlp;
}
1
@


1.3
log
@auto save when changing tabs implemented
@
text
@d23 6
d75 3
a77 1
if ($$obj->{format_def}) {
d80 8
a87 4
	print "<li><a href=\"javascript: editLocal('format',1);\">$$lang->{'Report Local Edit'}</a></li>";
} else {
	print "<p><b>&nbsp;$$lang->{'Report format'}</b><br></p>";
	print "<ul>$$lang->{'Report Unspec Format'}</ul>";
d89 1
@


1.2
log
@save as - modperl fixies, code improvments
@
text
@d43 1
a43 1
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$$lang->{'Save'}" /></td>
@


1.1
log
@mod perl rocks!
@
text
@a75 1
	print "<script type='text/javascript'>reloadTree($saved)</script>";
d77 1
@

