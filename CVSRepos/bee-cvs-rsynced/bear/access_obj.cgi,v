head	1.30;
access;
symbols;
locks; strict;
comment	@# @;


1.30
date	2004.03.04.14.43.08;	author jiri_schmid;	state Exp;
branches;
next	1.29;

1.29
date	2004.02.24.10.21.34;	author jiri_schmid;	state Exp;
branches;
next	1.28;

1.28
date	2004.02.20.12.41.02;	author jiri_schmid;	state Exp;
branches;
next	1.27;

1.27
date	2004.02.19.13.25.46;	author jiri_schmid;	state Exp;
branches;
next	1.26;

1.26
date	2004.02.18.16.19.05;	author jiri_schmid;	state Exp;
branches;
next	1.25;

1.25
date	2004.02.16.14.55.18;	author jiri_schmid;	state Exp;
branches;
next	1.24;

1.24
date	2004.02.16.09.17.00;	author jiri_schmid;	state Exp;
branches;
next	1.23;

1.23
date	2004.02.13.17.09.33;	author jiri_schmid;	state Exp;
branches;
next	1.22;

1.22
date	2004.02.12.16.24.21;	author jiri_schmid;	state Exp;
branches;
next	1.21;

1.21
date	2004.02.11.16.05.46;	author jiri_schmid;	state Exp;
branches;
next	1.20;

1.20
date	2003.12.04.12.15.12;	author jiri_schmid;	state Exp;
branches;
next	1.19;

1.19
date	2003.11.07.16.50.50;	author jiri_schmid;	state Exp;
branches;
next	1.18;

1.18
date	2003.10.31.12.47.54;	author jiri_schmid;	state Exp;
branches;
next	1.17;

1.17
date	2003.10.16.14.08.51;	author jiri_schmid;	state Exp;
branches;
next	1.16;

1.16
date	2003.10.13.14.43.16;	author jiri_schmid;	state Exp;
branches;
next	1.15;

1.15
date	2003.09.29.09.21.54;	author jiri_schmid;	state Exp;
branches;
next	1.14;

1.14
date	2003.09.15.13.04.03;	author jiri_schmid;	state Exp;
branches;
next	1.13;

1.13
date	2003.09.09.09.41.30;	author jiri_schmid;	state Exp;
branches;
next	1.12;

1.12
date	2003.09.01.12.40.02;	author jiri_schmid;	state Exp;
branches;
next	1.11;

1.11
date	2003.08.26.15.35.41;	author jiri_schmid;	state Exp;
branches;
next	1.10;

1.10
date	2003.08.22.16.00.53;	author jiri_schmid;	state Exp;
branches;
next	1.9;

1.9
date	2003.08.21.14.23.28;	author jiri_schmid;	state Exp;
branches;
next	1.8;

1.8
date	2003.08.21.12.02.01;	author jiri_schmid;	state Exp;
branches;
next	1.7;

1.7
date	2003.08.19.13.05.55;	author jiri_schmid;	state Exp;
branches;
next	1.6;

1.6
date	2003.08.18.13.17.09;	author jiri_schmid;	state Exp;
branches;
next	1.5;

1.5
date	2003.08.14.12.43.47;	author jiri_schmid;	state Exp;
branches;
next	1.4;

1.4
date	2003.08.13.13.16.25;	author jiri_schmid;	state Exp;
branches;
next	1.3;

1.3
date	2003.08.12.11.09.26;	author jiri_schmid;	state Exp;
branches;
next	1.2;

1.2
date	2003.08.12.09.19.16;	author jiri_schmid;	state Exp;
branches;
next	1.1;

1.1
date	2003.08.11.13.51.26;	author jiri_schmid;	state Exp;
branches;
next	;


desc
@@


1.30
log
@fixing bugs and improving useability and performance
@
text
@#!/usr/bin/perl
#-----------------------------------------------------
#  Access Page
#-----------------------------------------------------
# $Id: access_obj.cgi,v 1.29 2004/02/24 10:21:34 jiri_schmid Exp $

use strict;
my $run_mod_perl = defined(&Apache::RequestRec::BINMODE);	# are we running under mod_perl?
if ($run_mod_perl) { Apache::RequestRec::BINMODE(':utf8') } else { binmode STDOUT,':utf8' }

use CGI qw( :standard );
use CGI::Pretty;
require "const/Const.pm";
require "const/Tabs.pm";
require "local/Local.pm";

# ---- init SOAP ---------
#-------------------------
our $load = 1;
if ($load) {	# ensure require will be performed only once in case of mod_perl execution
	eval "use SOAP::Lite +autodispatch => 
		uri => 'Bear', 
		proxy => ['http://$Const::bearHost:$Const::bearPort/', 
		options => {compress_threshold => $Const::compressThreshold}]; 
		1"
	or ( &Local::ErrorDie("ERROR in eval of \"use SOAP::Lite ...\".") );
	undef $load;
}
my $q = new CGI;

# --- test SOAP connection ---
#-----------------------------
my $serverVerbName="SOAP Server http://$Const::bearHost:$Const::bearPort/";
if (! eval "SOAP::Lite->self->fault") {
	&Local::ErrorDie('ERROR: '.$serverVerbName.' not responding<br><form><input type="submit" name="Refresh" value="Refresh" /></form>');
}
#*SOAP::Serializer::as_string = \&SOAP::Serializer::as_base64;	#reducing number of XML::Parser char() callbaks  for every single portion of processed stream (e.g. \n)

# --- determine user and his preferences ---
#-------------------------------------------
my $user=$q->remote_user();
my $variables={};
my $ID = $q->param('Item') ? $q->param('Item') : $q->param('Item_id') ;
$variables->{useLang} = ($q->param('Lang')) ? $q->param('Lang') : $q->param('active_lang'); #active lang defined in *_ed.pl
$variables->{skin} = ($q->param('Skin')) ? $q->param('Skin') : ($q->param('skin')) ? $q->param('skin') : "";
$variables->{skinPath} = ($variables->{skin}) ? "skins/$variables->{skin}/" : "";
$variables->{useCookie} = $q->param('Cook');
$variables->{imgType} = 'png';#&Local::getImageType("$Const::myPath$variables->{skinPath}img/");
$variables->{defaultLang} = $Const::defaultLanguage;
$variables->{id} = $ID;
$variables->{proj} = $q->param('Proj');;
$variables->{useEnc} = 'UTF-8';
$variables->{imgType} = &Local::getImageType("$Const::myPath$variables->{skinPath}img/");
$variables->{saved}= 'false';
$variables->{wb} = $q->user_agent()=~/MSIE/ ? 'msie' : 'mozilla';

my $type = ($q->param('Type')) ? $q->param('Type') : $q->param('type');

# --- load message dictionary ---
#---------------------------------
require "lang/$variables->{useLang}.utf";

print $q->header(-charset=>$variables->{useEnc});
if (SOAP->CheckAccess('A',$user,$q->param('Proj'))) {
print $q->start_html(
	-title=>"iframe",
	-lang=>$Const::languages->{ $variables->{useLang} }->{lang},
	-encoding=>$variables->{useEnc},
	-head=>meta({	-http_equiv => 'Content-Type', 
			-content => "text/html; charset=$variables->{useEnc}" }),
	-script=>[{-language=>'JAVASCRIPT', -src=>'js/access.js'}],
	-style=>{-src=>"$variables->{skinPath}css.css"},
	-onload=>"initVars(2);",
	-onclick=>"hideMe()"
);
print $q->startform(-action=>'', -name=>'AccessObject');
print $q->hidden('Proj',$variables->{proj});
print $q->hidden('skin',$variables->{skin});

my ($fullObj, $obj, $objType, $accessObject);
$fullObj = {};
$obj = {};
$accessObject = {};
$objType = &Local::loadMetadata($ID,\$fullObj,\$obj);

&doWork($fullObj,$obj,$q,$variables,$type,$user) if $q->param('Action') && $type eq 'role';

print <<END;
<input type="hidden" name="Item_id" id="ITEM_ID" value="$ID"/>

<input type="hidden" value="$variables->{useLang}" id="activeLang" name="active_lang">
<input type="hidden" value="$type" id="type" name="type">
<script type="text/javascript">var saved = $variables->{saved};</script>
END

if ($type eq 'user') { &generateUser($variables,$accessObject) }
elsif ($type eq 'group') { &generateGroup($variables,$accessObject) }
elsif ($type eq 'role') { &generateRole($variables,$fullObj,$obj) }

print "</td></tr></table>";
print $q->endform;
} else {
	print $q->start_html(-style=>{-src=>"$variables->{skinPath}css.css"});
	&Local::accessForbidden("$Const::lang->{$variables->{useLang}}{'Forbidden Tab'}");
}
print $q->end_html;

#---------------------------------------------------
sub doWork {
my ($fullObj,$obj,$q,$variables,$type,$user) = @@_;
my $lang = ($type eq 'role') ? $q->param('saveLang') : $variables->{useLang};
$obj->{name} = &Local::setLocalizedObj($obj->{name},&Local::param_utf8(\$q,'name'),$lang) if ($q->param('name'));
$obj->{description} = &Local::setLocalizedObj($obj->{description},&Local::param_utf8(\$q,'desc'),$lang) if ($q->param('desc'));
my $rwx = '';
my @@tabs;
if ($type eq 'role') {
	delete $obj->{rights};
	if ($variables->{id} eq $variables->{proj}."_root") {
		$obj->{rights}{allow} = 'RWEDC';
		$obj->{rights}{deny} = '';
		$obj->{change} = "on";
		$obj->{tabs} = "";
		$obj->{sql} = "edit";	
	} else {
		foreach my $rghts ('allow','deny') {
			my $rwx = '';
			foreach ('R','W','E','D') {
				my $paramName = "$rghts$_";
				$rwx .= $_ if ($q->param($paramName));
			}
			$obj->{rights}{$rghts} = $rwx;
		}
		$obj->{rights}{allow} .= $q->param('Change');
		foreach (@@Tabs::TabsCntrl) {	#store unselected values => forbidden tabs
			next if $q->param("tab$_");
			push(@@tabs,$_);
		}
		$obj->{tabs} = join("",sort @@tabs);
		$obj->{sql} = $q->param('sql');
	}
	$obj->{ugroup} = [$q->param('ugroup')];
	$obj->{uuser} = [$q->param('uuser')];
}
my $rtrnSave = SOAP->SaveMData($fullObj,1);
$variables->{saved} = 'true' if $rtrnSave;
#my $pr=	SOAP->GetProjectName($variables->{id}); #project name
#unlink(&Local::TreeFileName($Const::myPath,$pr,$user));
# !!! after changing of role's rights it is necessary to clean all html trees for each user
}

#---------------------------------------------------

sub generateUser {
my ($variables,$accessObject) = (shift,shift);
$accessObject = SOAP->GetUserDetail($variables->{id});
my $name = &Local::LocalizedObj($accessObject->{name},undef,$variables->{useLang},'en');
my $desc = &Local::LocalizedObj($accessObject->{description},undef,$variables->{useLang},'en');
print <<END;
<table><tr><td class='neutral_bold'><img src='$variables->{skinPath}img/single.$variables->{imgType}'/>&nbsp;$Const::lang->{ $variables->{useLang} }{'Access user'}</td></tr></table>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral">
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Name'}</td></tr>
	<tr><td><input value="$name" type="text" name="name" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Access login'}</td></tr>
	<tr><td><input value="$variables->{id}" type="text" name="login" id="NAME" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Access passwd'}</td></tr>
	<tr><td><input value="" type="PASSWORD" name="pass" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Description'}</td></tr>
	<tr><td style='text-align:center'><textarea cols="$Const::wb_const->{ $variables->{wb} }{itemWide}" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
	<tr><td><hr/></td></tr>
	<tr><td>$Const::lang->{ $variables->{useLang} }{'Access memberOFgroup'}</td></tr>
	<tr><td>
		<select multiple='multiple' style='width:100%'>
END
			print "<option>unknown at this moment</option>";
print <<END;
		</select>
	</td></tr>
	<tr><td><hr/></td></tr>
	<tr><td align='center'>
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>
			<td class="buttons"><input type="reset" name="reset" value="$Const::lang->{ $variables->{useLang} }{'Reset'}"/></td>
		</tr>
		</table>
	</td></tr>
	</table>
END
}

#---------------------------------------------------

sub generateGroup {
my ($variables,$accessObject) = (shift,shift);
$accessObject = SOAP->GetGroupDetail($variables->{id});
my $name = &Local::LocalizedObj($accessObject->{name},undef,$variables->{useLang},'en');
my $desc = &Local::LocalizedObj($accessObject->{description},undef,$variables->{useLang},'en');
print <<END;
<table><tr><td class='neutral_bold'><img src='$variables->{skinPath}img/group.$variables->{imgType}'/>&nbsp;$Const::lang->{ $variables->{useLang} }{'Access group'}</td></tr></table>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral">
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Name'}</td></tr>
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Description'}</td></tr>
	<tr><td style='text-align:center'><textarea cols="$Const::wb_const->{ $variables->{wb} }{itemWide}" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
	<tr><td><hr/></td></tr>
	<tr><td>$Const::lang->{ $variables->{useLang} }{'Access groupContain'}</td></tr>
	<tr><td>
		<select multiple='multiple' style='width:100%' onclick='dropItHere(this)' name='members' id='members'>
END
my $root = $variables->{proj}."_root";
my $UList = SOAP->GetLocalizedUsersList(@@{$accessObject->{members}});
	foreach (sort {$UList->{$a} cmp $UList->{$b}} keys %{$UList}) {
		next if $root eq $_;
		print "<option value='$_'>$UList->{$_}</option>";
	}
print <<END;
		</select>
	</td></tr>
	<tr><td><hr/></td></tr>
	<tr><td align='center'>
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	
			<td class="buttons"><input type="reset" name="reset" value="$Const::lang->{ $variables->{useLang} }{'Reset'}"/></td>
		</tr>
		</table>
	</td></tr>
	</table>
END
}

#---------------------------------------------------

sub generateRole {
my ($variables,$fullObj,$obj) = (shift,shift,shift);
#my $objType = &Local::loadMetadata($variables->{id},\$fullObj,\$obj);
my $name = &Local::LocalizedObj($obj->{name},undef,$variables->{useLang},'en');
my $desc = &Local::LocalizedObj($obj->{description},undef,$variables->{useLang},'en');
print <<END;
<table><tr><td class='neutral_bold'><img src='$variables->{skinPath}img/role.$variables->{imgType}'/>&nbsp;$Const::lang->{ $variables->{useLang} }{'Access role'}</td></tr></table>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
	<table class="neutral">
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{Project}</td></tr>
	<tr><td><input value="$variables->{proj}" type="text" id="PROJECT" disabled='disabled' style='width:100%' readonly='readonly'/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Name'}</td></tr>
	<tr><td>
		<span class='nowrap'>
		<input value="$name" type="text" name="name" id="NAME" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/>
		<input type='hidden' value="$variables->{useLang}" name='saveLang' id='saveLang' />
		<select name="langSpec" id="langSpec" onchange="tmpChangeLocal(this)">
END
my $selected;
my $localizations= {};
foreach (keys %{$Const::languages}) {
	$localizations->{$_}{name} = &Local::LocalizedObj($obj->{name}, "$Const::lang->{ $variables->{useLang} }{'Undef Local'}", $_, $variables->{defaultLang});
	$localizations->{$_}{desc} = &Local::ScriptStringView(&Local::LocalizedObj($obj->{description}, undef, $_, $variables->{defaultLang}));
	my $selected = ($variables->{useLang} eq $_) ? " selected='selected'" : '';
	print "<option value='$_'$selected>$_</option>";
}
print <<END;
		</select>
		</span>
	</td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $variables->{useLang} }{'Description'}</td></tr>
	<tr><td style='text-align:center'><textarea style='width:100%' rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
	<tr><td><hr/></td></tr>
	<tr><td>
		<table class='visual_grid' style='border-collapse:collapse; width:100%'>
			<tr><td colspan='5' class='neutral_bold'>$Const::lang->{ $variables->{useLang} }{'right'}:</td></tr>
			<tr><td></td><td style='text-align:center'>&nbsp;$Const::lang->{ $variables->{useLang} }{'Read'}&nbsp;</td><td style='text-align:center'>$Const::lang->{ $variables->{useLang} }{'Write'}</td><td style='text-align:center'>&nbsp;$Const::lang->{ $variables->{useLang} }{'Execute'}&nbsp;</td><td style='text-align:center'>$Const::lang->{ $variables->{useLang} }{'Duplicate'}</td></tr>
END
my $disable = ($variables->{id} =~ /_root$/) ? " disabled='disabled'" : "";
foreach my $type ('allow','deny') {
	my $localName = "Prefer $type";
	print "<tr><td>$Const::lang->{ $variables->{useLang} }{$localName}:</td>";
	foreach ('R','W','E','D') {
		$name = "$type$_";
		my $checked = ($obj->{rights}{$type} =~ /$_/) ? "checked='checked'" : "";
		print "<td style='text-align:center'><input$disable type='checkbox' onclick='checkCouple(this)' name='$name' id='$name' $checked value='$_'/></td>";
	}
	print "</tr>";
}
my $checked = ($obj->{rights}{allow} =~ /C/) ? "checked='checked'" : "";
print <<END;
		<tr><td colspan='5'><hr size='1' /></td></tr>
		<tr>
			<td colspan='4' title="$Const::lang->{ $variables->{useLang} }{'Rights Change Title'}">$Const::lang->{ $variables->{useLang} }{'Rights Change'}:</td>
			<td style='text-align:center'><input$disable type='checkbox' name='Change' $checked value='C' /></td>
		</tr>
		</table>
	</td></tr>
	<tr><td align="center">
		<table class='visual_grid' style='border-collapse:collapse; width:100%'>
		<tr>
			<td class='neutral_bold'>$Const::lang->{$variables->{useLang}}->{'Access Tabs'}:</td>
			<td style='text-align:center'>$Const::lang->{$variables->{useLang}}->{'Access View'}</td>
		</tr>
END
		foreach (sort {$Const::lang->{$variables->{useLang}}->{ $Tabs::Tabs->{$a}->{name} } cmp $Const::lang->{$variables->{useLang}}->{ $Tabs::Tabs->{$b}->{name} }} @@Tabs::TabsCntrl) {
			print "<tr><td>$Const::lang->{$variables->{useLang}}->{ $Tabs::Tabs->{$_}->{name} }</td>";
			my $checked = ($obj->{'tabs'} =~ /$_/) ? "" : "checked='checked' "; #forbidden tabs stored in $obj->{'tabs'}
			print "<td style='text-align:center'><input$disable type='checkbox' value='$_' name='tab$_' $checked/></td></tr>";
		}
print <<END;
		<tr><td colspan='2'><hr size='1' /></td></tr>
		<tr><td colspan='2'>$Const::lang->{$variables->{useLang}}->{ $Tabs::Tabs->{P}->{name} }:</td></tr>
		<tr><td class='italic'>$Const::lang->{$variables->{useLang}}->{'Prefer SQL Access'}</td>
		<td>
	<select name="sql" style='width:100%' $disable>
END
foreach ('none','view','edit') {
	my $choosed = ($_ eq $obj->{'sql'}) ? ' selected' : '';
	print "<option value='$_'$choosed>$Const::lang->{$variables->{useLang}}->{\"Prefer SQL Access $_\"}</option>";
}
print <<END;
	</select>
		</td>
		</tr>
		</table>
	</td></tr>
	<tr><td><hr/></td></tr>
	<tr><td align="center">
		<table class="buttons" cellpading="0" cellspacing="0">
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$Const::lang->{ $variables->{useLang} }{'Save'}" onclick='selectSelect("ugroup","uuser")'/></td>
			<td class="buttons"><input type="reset" name="reset" value="$Const::lang->{ $variables->{useLang} }{'Reset'}" /></td>
		</tr>
		</table>
	</td></tr>
	</table>
</td>
<td>&nbsp;</td>
<td class="page_skeleton">
	<table class="neutral">	
	<tr>
		<td>$Const::lang->{ $variables->{useLang} }{'Access Contain Group'}</td>
		<td style='text-align:right'><img class="cursor" src="$variables->{skinPath}img/delete.$variables->{imgType}" title="$Const::lang->{ $variables->{useLang} }{Delete}" onclick="emptySelect('ugroup')"></td>
	</tr>
	<tr><td colspan='2'>
		<select size='5' style='width:250px' multiple='multiple' onclick='dropItHere(this)' name='ugroup' id='ugroup'>
END
my $GList = SOAP->GetLocalizedGroupsList($variables->{useLang},@@{$obj->{ugroup}});
	foreach (sort {$GList->{$a} cmp $GList->{$b}} keys %{$GList}) {
			print "<option value='$_'>$GList->{$_}</option>";
	}
print <<END;
	</select>
	</td></tr>
	<tr><td colspan='2'><hr /></td></tr>
	<tr>
		<td>$Const::lang->{ $variables->{useLang} }{'Access Contain User'}</td>
		<td style='text-align:right'><img class="cursor" src="$variables->{skinPath}img/delete.$variables->{imgType}" title="$Const::lang->{ $variables->{useLang} }{Delete}" onclick="emptySelect('uuser')"></td>
	</tr>
	<tr><td colspan='2'><select size='5' style='width:100%' multiple='multiple' onclick='dropItHere(this)' name='uuser' id='uuser'>
END
my $root = $variables->{proj}."_root";
my $UList = SOAP->GetLocalizedUsersList(@@{$obj->{uuser}});
	foreach (sort {$UList->{$a} cmp $UList->{$b}} keys %{$UList}) {
		next if $root eq $_;
		print "<option value='$_'>$UList->{$_}</option>";
	}
print <<END;
		</select>
	</td></tr>
	</table>
END
print "<script type='text/javascript'>";
	foreach my $langVar (keys %{$localizations}) {
		my @@langVar = ();
		foreach (keys %{$localizations->{$langVar}}) {
			push (@@langVar,"$_:\"$localizations->{$langVar}{$_}\"");
		}
		print "	var $langVar = {".join(",",@@langVar)."};\n";
	}

print "</script>";
}

#---------------------------------------------------

sub do_out {
my $rtrn = "\n";
foreach (keys(%ENV)) { 
	if ($_ eq "SERVER_SIGNATURE")  
		{my $x = $ENV{$_};
		 $x =~ s/<[^A-Z]*//g; 
		 $rtrn .= "$_: ".$x."\n";}
	else {$rtrn .= "$_: ".$ENV{$_}."\n";}
	}
return $rtrn;
}

#---------------------------------------------------

1
@


1.29
log
@prefer access and rights logic changed
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.28 2004/02/20 12:41:02 jiri_schmid Exp $
d259 1
d261 4
a264 3
	my $langName = &Local::LocalizedObj($obj->{name}, "? $variables->{id}",$_, $Const::defaultLanguage);
	$selected = ($variables->{useLang} eq $_) ? " selected='selected'" : "";
	print "<option value='$langName'$selected>$_</option>";
d372 10
@


1.28
log
@rights for edit page finished
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.27 2004/02/19 13:25:46 jiri_schmid Exp $
d122 2
a123 1
		$obj->{tabs} = "";	
a137 1
		delete $obj->{change};
d139 1
d309 14
@


1.27
log
@edit page rights fixies and improvments
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.26 2004/02/18 16:19:05 jiri_schmid Exp $
d119 1
a119 1
		$obj->{rights}{allow} = 'RWED';
d128 1
a128 1
				$rwx .= ($q->param($paramName)) ? $_ : '-';
d132 1
d137 1
a137 1
		$obj->{change} = $q->param('Change');
d286 1
a286 1
my $checked = ($obj->{change}) ? "checked='checked'" : "";
d291 1
a291 1
			<td style='text-align:center'><input$disable type='checkbox' name='Change' $checked /></td>
@


1.26
log
@rights implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.25 2004/02/16 14:55:18 jiri_schmid Exp $
d329 1
a329 1
my $GList = GetLocalizedGroupsList($variables->{useLang});
d334 1
a334 1
		</select>
@


1.25
log
@security improvment for tabs
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.24 2004/02/16 09:17:00 jiri_schmid Exp $
d104 1
a104 1
	&Local::accessForbidden('Admin',$user);
d116 22
a137 8
if ($variables->{id} =~ /_root$/) {
	$rwx = 'RWED';
	$obj->{change} = "on";
	$obj->{tabs} = "";	
} else {
	foreach ('R','W','E','D') {
		my $paramName = "rights$_";
		$rwx .= ($q->param($paramName)) ? $_ : '-';
d139 2
a140 6
	foreach (@@Tabs::TabsCntrl) {	#store unselected values => forbidden tabs
		next if $q->param("tab$_");
		push(@@tabs,$_);
	}
	$obj->{change} = $q->param('Change');
	$obj->{tabs} = join("",sort @@tabs);
a141 3
$obj->{rights} = $rwx if $type eq 'role';
$obj->{ugroup} = [$q->param('ugroup')] if $type eq 'role';
$obj->{uuser} = [$q->param('uuser')] if $type eq 'role';
d271 2
a272 3
			<tr><td colspan='4' class='neutral_bold'>$Const::lang->{ $variables->{useLang} }{'right'}:</td></tr>
			<tr><td style='text-align:center'>&nbsp;$Const::lang->{ $variables->{useLang} }{'Read'}&nbsp;</td><td style='text-align:center'>$Const::lang->{ $variables->{useLang} }{'Execute'}</td><td style='text-align:center'>&nbsp;$Const::lang->{ $variables->{useLang} }{'Write'}&nbsp;</td><td style='text-align:center'>$Const::lang->{ $variables->{useLang} }{'Duplicate'}</td></tr>
			<tr>
d274 4
a277 1
	my $disable = ($variables->{id} =~ /_root$/) ? " disabled='disabled'" : "";
d279 3
a281 4
		$name = "rights$_";
		my $checked = ($obj->{rights} =~ /$_/) ? "checked='checked'" : "";

		print "<td style='text-align:center'><input$disable type='checkbox' name='$name' id='$name' $checked value='$_'/></td>";
d283 3
a285 1
		my $checked = ($obj->{change}) ? "checked='checked'" : "";
d287 1
a287 2
			</tr>
		<tr><td colspan='4'><hr size='1' /></td></tr>
d289 1
a290 1
			<td colspan='3' style='text-align:center' title="$Const::lang->{ $variables->{useLang} }{'Rights Change Title'}">$Const::lang->{ $variables->{useLang} }{'Rights Change'}
a300 1
		my $disable = ($variables->{id} =~ /_root$/) ? " disabled='disabled'" : "";
@


1.24
log
@fix
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.23 2004/02/13 17:09:33 jiri_schmid Exp $
d64 1
a64 1

a75 1

d77 2
a78 1

d90 1
a90 1
<input type="hidden" name="skin" value="$variables->{skin}"/>
d102 4
d112 2
a113 2
$obj->{name} = &Local::setLocalizedObj($obj->{name},$q->param('name'),$lang) if ($q->param('name'));
$obj->{description} = &Local::setLocalizedObj($obj->{description},$q->param('desc'),$lang) if ($q->param('desc'));
d206 5
a210 4
my $cnt = 0;
foreach (SOAP->GetLocalizedUsersList(@@{$accessObject->{members}})) {
			print "<option value='$accessObject->{members}[$cnt]'>$_</option>";
			$cnt++;
d231 1
a231 2
my $objType = &Local::loadMetadata($variables->{id},\$fullObj,\$obj);
my $project = SOAP->GetProjectName($variables->{id});
d241 1
a241 1
	<tr><td><input value="$project" type="text" id="PROJECT" disabled='disabled' style='width:100%' readonly='readonly'/></td></tr>
d321 3
a323 4
my $cnt = 0;
	foreach (SOAP->GetLocalizedGroupsList($variables->{useLang},@@{$obj->{ugroup}})) {
			print "<option value='@@{$obj->{ugroup}}[$cnt]'>$_</option>";
			$cnt++;
d335 5
a339 6
$cnt = 0;
#my $root = $variables->{proj}."_root";
	foreach (SOAP->GetLocalizedUsersList(@@{$obj->{uuser}})) { 
			print "<option value='@@{$obj->{uuser}}[$cnt]'>$_</option>";
			#$root = '' if @@{$obj->{uuser}}[$cnt] eq $root;
			$cnt++;
a340 1
	#print "<option value='$root'>$root</option>" if $root eq $variables->{id};
@


1.23
log
@major tabs control implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.22 2004/02/12 16:24:21 jiri_schmid Exp $
d341 1
a341 1
		</select>$root
@


1.22
log
@prototype of tabs hidding implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.21 2004/02/11 16:05:46 jiri_schmid Exp $
d51 1
a110 5
foreach ('R','W','E','D') {
	my $paramName = "rights$_";
	$rwx .= ($q->param($paramName)) ? $_ : '-';
}

d112 15
a126 3
foreach (@@Tabs::TabsCntrl) {	#store unselected values => forbidden tabs
	next if $q->param("tab$_");
	push(@@tabs,$_);
a127 1
$obj->{tabs} = join("",sort @@tabs);
a128 1
$obj->{change} = $q->param('Change');
d152 1
a152 1
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
d154 1
a154 1
	<tr><td><input value="$ID" type="text" name="name" id="NAME" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
d156 1
a156 1
	<tr><td><input value="" type="PASSWORD" name="name" id="NAME" size="$Const::wb_const->{ $variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
d247 1
a247 1
	my $langName = &Local::LocalizedObj($obj->{name}, "? $ID",$_, $Const::defaultLanguage);
d264 1
a264 1
	my $disable = ($ID =~ /_root$/) ? " disabled='disabled'" : "";
d269 1
a269 1
		print "<td style='text-align:center'><input$disable type='checkbox' name='$name' id='$name' $checked/></td>";
d288 1
d292 1
a292 1
			print "<td style='text-align:center'><input type='checkbox' value='$_' name='tab$_' $checked/></td></tr>";
d333 1
d336 1
d339 1
d341 1
a341 1
		</select>
@


1.21
log
@local format improvment and started implementation of tabs selection
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.20 2003/12/04 12:15:12 jiri_schmid Exp $
d14 1
d72 1
a72 1
	-onload=>"initVars(2);reload()",
d85 1
a85 1
&doWork(\$fullObj,\$obj,\$q,\$variables,$type,$user) if $q->param('Action') && $type eq 'role';
d95 3
a97 3
if ($type eq 'user') { &generateUser(\$variables,\$accessObject) }
elsif ($type eq 'group') { &generateGroup(\$variables,\$accessObject) }
elsif ($type eq 'role') { &generateRole(\$variables,\$fullObj,\$obj) }
d106 3
a108 3
my $lang = ($type eq 'role') ? $$q->param('saveLang') : $$variables->{useLang};
$$obj->{name} = &Local::setLocalizedObj($$obj->{name},$$q->param('name'),$lang) if ($$q->param('name'));
$$obj->{description} = &Local::setLocalizedObj($$obj->{description},$$q->param('desc'),$lang) if ($$q->param('desc'));
d112 1
a112 1
	$rwx .= ($$q->param($paramName)) ? $_ : '-';
d114 14
a127 7
$$obj->{rights} = $rwx if $type eq 'role';
$$obj->{change} = $$q->param('Change');
$$obj->{ugroup} = [$$q->param('ugroup')] if $type eq 'role';
$$obj->{uuser} = [$$q->param('uuser')] if $type eq 'role';
my $rtrnSave = SOAP->SaveMData($$fullObj,1);
$$variables->{saved} = 'true' if $rtrnSave;
#my $pr=	SOAP->GetProjectName($$variables->{id}); #project name
d136 3
a138 3
$$accessObject = SOAP->GetUserDetail($$variables->{id});
my $name = &Local::LocalizedObj($$accessObject->{name},undef,$$variables->{useLang},'en');
my $desc = &Local::LocalizedObj($$accessObject->{description},undef,$$variables->{useLang},'en');
d140 1
a140 1
<table><tr><td class='neutral_bold'><img src='$$variables->{skinPath}img/single.$$variables->{imgType}'/>&nbsp;$Const::lang->{ $$variables->{useLang} }{'Access user'}</td></tr></table>
d145 8
a152 8
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Name'}</td></tr>
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$Const::wb_const->{ $$variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Access login'}</td></tr>
	<tr><td><input value="$ID" type="text" name="name" id="NAME" size="$Const::wb_const->{ $$variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Access passwd'}</td></tr>
	<tr><td><input value="" type="PASSWORD" name="name" id="NAME" size="$Const::wb_const->{ $$variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Description'}</td></tr>
	<tr><td><textarea cols="$Const::wb_const->{ $$variables->{wb} }{itemWide}" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
d154 1
a154 1
	<tr><td>$Const::lang->{ $$variables->{useLang} }{'Access memberOFgroup'}</td></tr>
d166 1
a166 1
			<td class="buttons"><input type="reset" name="reset" value="$Const::lang->{ $$variables->{useLang} }{'Reset'}"/></td>
d178 3
a180 3
$$accessObject = SOAP->GetGroupDetail($$variables->{id});
my $name = &Local::LocalizedObj($$accessObject->{name},undef,$$variables->{useLang},'en');
my $desc = &Local::LocalizedObj($$accessObject->{description},undef,$$variables->{useLang},'en');
d182 1
a182 1
<table><tr><td class='neutral_bold'><img src='$$variables->{skinPath}img/group.$$variables->{imgType}'/>&nbsp;$Const::lang->{ $$variables->{useLang} }{'Access group'}</td></tr></table>
d187 4
a190 4
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Name'}</td></tr>
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$Const::wb_const->{ $$variables->{wb} }{nameWidth}" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Description'}</td></tr>
	<tr><td><textarea cols="$Const::wb_const->{ $$variables->{wb} }{itemWide}" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
d192 1
a192 1
	<tr><td>$Const::lang->{ $$variables->{useLang} }{'Access groupContain'}</td></tr>
d197 2
a198 2
foreach (SOAP->GetLocalizedUsersList(@@{$$accessObject->{members}})) {
			print "<option value='$$accessObject->{members}[$cnt]'>$_</option>";
d208 1
a208 1
			<td class="buttons"><input type="reset" name="reset" value="$Const::lang->{ $$variables->{useLang} }{'Reset'}"/></td>
d220 4
a223 4
my $objType = &Local::loadMetadata($$variables->{id},$fullObj,$obj);
my $project = SOAP->GetProjectName($$variables->{id});
my $name = &Local::LocalizedObj($$obj->{name},undef,$$variables->{useLang},'en');
my $desc = &Local::LocalizedObj($$obj->{description},undef,$$variables->{useLang},'en');
d225 1
a225 1
<table><tr><td class='neutral_bold'><img src='$$variables->{skinPath}img/role.$$variables->{imgType}'/>&nbsp;$Const::lang->{ $$variables->{useLang} }{'Access role'}</td></tr></table>
d230 1
a230 1
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{Project}</td></tr>
d232 1
a232 1
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Name'}</td></tr>
d235 2
a236 2
		<input value="$name" type="text" name="name" id="NAME" size="$Const::wb_const->{ $$variables->{wb} }{nameWidth}" maxlength="100"/>
		<input type='hidden' value="$$variables->{useLang}" name='saveLang' id='saveLang' />
d241 2
a242 2
	my $langName = &Local::LocalizedObj($$obj->{name}, "? $ID",$_, $Const::defaultLanguage);
	$selected = ($$variables->{useLang} eq $_) ? " selected='selected'" : "";
d249 2
a250 2
	<tr><td class="neutral_bold">$Const::lang->{ $$variables->{useLang} }{'Description'}</td></tr>
	<tr><td><textarea style='width:100%' rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
d254 3
a256 2
			<tr><td></td><td style='text-align:center'>&nbsp;$Const::lang->{ $$variables->{useLang} }{'Read'}&nbsp;</td><td style='text-align:center'>$Const::lang->{ $$variables->{useLang} }{'Execute'}</td><td style='text-align:center'>&nbsp;$Const::lang->{ $$variables->{useLang} }{'Write'}&nbsp;</td><td style='text-align:center'>$Const::lang->{ $$variables->{useLang} }{'Duplicate'}</td></tr>
			<tr><td class='neutral_bold'>$Const::lang->{ $$variables->{useLang} }{'right'}:</td>
d261 1
a261 1
		my $checked = ($$obj->{rights} =~ /$_/) ? "checked='checked'" : "";
d265 1
a265 1
		my $checked = ($$obj->{change}) ? "checked='checked'" : "";
d268 20
a289 1
	<tr><td title="$Const::lang->{ $$variables->{useLang} }{'Rights Change Title'}"><input$disable type='checkbox' name='Change' $checked />&nbsp;$Const::lang->{ $$variables->{useLang} }{'Rights Change'}</td></tr>
d291 1
a291 1
		<tr><td align="center">
d293 2
a294 2
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$Const::lang->{ $$variables->{useLang} }{'Save'}" onclick='selectSelect("ugroup","uuser")'/></td>
			<td class="buttons"><input type="button" name="reset" value="$Const::lang->{ $$variables->{useLang} }{'Reset'}" onclick="reload()"/></td>
d304 2
a305 2
		<td>$Const::lang->{ $$variables->{useLang} }{'Access Contain Group'}</td>
		<td style='text-align:right'><img class="cursor" src="$$variables->{skinPath}img/delete.$$variables->{imgType}" title="$Const::lang->{ $$variables->{useLang} }{Delete}" onclick="emptySelect('ugroup')"></td>
d311 2
a312 2
	foreach (SOAP->GetLocalizedGroupsList($$variables->{useLang},@@{$$obj->{ugroup}})) {
			print "<option value='@@{$$obj->{ugroup}}[$cnt]'>$_</option>";
d320 2
a321 2
		<td>$Const::lang->{ $$variables->{useLang} }{'Access Contain User'}</td>
		<td style='text-align:right'><img class="cursor" src="$$variables->{skinPath}img/delete.$$variables->{imgType}" title="$Const::lang->{ $$variables->{useLang} }{Delete}" onclick="emptySelect('uuser')"></td>
d326 2
a327 2
	foreach (SOAP->GetLocalizedUsersList(@@{$$obj->{uuser}})) { 
			print "<option value='@@{$$obj->{uuser}}[$cnt]'>$_</option>";
@


1.20
log
@img type changes tested and fixed
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.19 2003/11/07 16:50:50 jiri_schmid Exp $
d247 1
a247 1
			<tr><td class='neutral_bold'>$Const::lang->{ $$variables->{useLang} }{'Right'}:</td>
@


1.19
log
@tuning
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.18 2003/10/31 12:47:54 jiri_schmid Exp $
d47 1
a47 1
$variables->{imgType} = &Local::getImageType("$Const::myPath$variables->{skinPath}img/");
@


1.18
log
@mod perl rocks!
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.17 2003/10/16 14:08:51 jiri_schmid Exp $
a51 1
$variables->{use_lang} = ($q->param('Lang')) ? $q->param('Lang') : $q->param('active_lang');
d84 1
a84 1
&doWork(\$fullObj,\$obj,\$q,\$variables,$type) if $q->param('Action') && $type eq 'role';
d104 1
a104 1
my ($fullObj,$obj,$q,$variables,$type) = (shift,shift,shift,shift,shift);
d119 3
d214 2
a215 2
my $name = &Local::LocalizedObj($$obj->{name},undef,$$variables->{use_lang},'en');
my $desc = &Local::LocalizedObj($$obj->{description},undef,$$variables->{use_lang},'en');
d228 1
a228 1
		<input type='hidden' value="$$variables->{use_lang}" name='saveLang' id='saveLang' />
d234 1
a234 1
	$selected = ($$variables->{use_lang} eq $_) ? " selected='selected'" : "";
d283 1
a283 1
	foreach (SOAP->GetLocalizedGroupsList($$variables->{use_lang},@@{$$obj->{ugroup}})) {
@


1.17
log
@mod-perl implementation stage 1, rebuilding global vars in .pl to global pointers
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.16 2003/10/13 14:43:16 jiri_schmid Exp $
d8 3
d13 16
a28 17
our $q = new CGI;
use vars qw($lang $Languages $name_w $descr_w $itemWide $bearHost $bearPort @@Languages $DefaultLanguage $nameWide);
binmode STDOUT,":utf8";

require "const.def";
require "local/local_lib.pl";

our $User=$q->remote_user();

our $skin = (param('Skin')) ? param('Skin') : (param('skin')) ? param('skin') : "";
our $skinPath = ($skin) ? "skins/$skin/" : "";
my $style = ($skin) ? "${skinPath}css.css" : "css.css";
our $imgType = getImageType("${skinPath}img/");
our $use_lang = (param('Lang')) ? param('Lang') : param('active_lang');
my $use_enc = 'UTF-8';
my $type = (param('Type')) ? param('Type') : param('type');
require $Languages->{$use_lang}->{'src'};
d30 33
a62 1
print $q->header(-charset=>$use_enc);
d66 2
a67 2
	-lang=>$Languages->{$use_lang}->{lang},	#return language specification in format: language-country (it differs from param Lang)
	-encoding=>$use_enc,
d69 1
a69 1
			-content => "text/html; charset=$use_enc" }),
d71 1
a71 1
	-style=>{-src=>$style},
d76 1
a76 7
eval "use SOAP::Lite +autodispatch => 
	uri => 'Bear', 
	proxy => ['http://$bearHost:$bearPort/', 
	options => {compress_threshold => 10000}],
	encoding => 'UTF-8';	
	1"
or ( &ErrorDie("ERROR in eval of \"use SOAP::Lite ...\".") );
a77 1
my $serverVerbName="SOAP Server http://$bearHost:$bearPort/";
d79 5
a83 3
if (! eval "SOAP::Lite->self->fault") {
	ErrorDie('ERROR: '.$serverVerbName.' not responding<br><form><input type="submit" name="Refresh" value="Refresh" /></form>');
}
d85 1
a85 14
if (! $use_lang) {print "<span style=\"color:#f00; font-weight:bold; font-size:20px\">Break! - no user prefernces specified.</span><br/><br/><span><a href=\"index.cgi?TabAct=P\" target=\"_top\">Set and save user preferences first.</a></span></body></html>"; die;};

print startform(-action=>'', -name=>'AccessObject');

my $ID = param('Item_id');

our $AccessObject;

our $FullObj;
our $Obj;
our $ObjT;
our $saved = 'false';

&doWork if param('Action') && $type eq 'role';
d89 4
a92 4
<input type="hidden" name="skin" value="$skin"/>
<input type='hidden' value='$use_lang' id='activeLang' name='active_lang'>
<input type='hidden' value='$type' id='type' name='type'>
<script type='text/javascript'>var saved = $saved;</script>
d95 3
a97 3
if ($type eq 'user') { &generateUser }
elsif ($type eq 'group') { &generateGroup }
elsif ($type eq 'role') { &generateRole }
d100 1
a100 1
print &endform;
d105 4
a108 4
&loadMetadata;
my $lang = ($type eq 'role') ? param('saveLang') : $use_lang;
$Obj->{name} = setLocalizedObj($Obj->{name},param('name'),$lang) if (param('name'));
$Obj->{description} = setLocalizedObj($Obj->{description},param('desc'),$lang) if (param('desc'));
d112 1
a112 8
	$rwx .= (param($paramName)) ? $_ : '-';
}
$Obj->{rights} = $rwx if $type eq 'role';
$Obj->{change} = param('Change');
$Obj->{ugroup} = [param('ugroup')] if $type eq 'role';
$Obj->{uuser} = [param('uuser')] if $type eq 'role';
my $rtrnSave = SOAP->SaveMData($FullObj,1);
$saved = 'true' if $rtrnSave;
d114 6
a119 7

#---------------------------------------------------
sub loadMetadata {
	$FullObj = SOAP->GetMetadata($ID);
	$ObjT = (keys %{$FullObj})[0];		#object type
	$Obj = $FullObj->{$ObjT}->{$ID};	#ptr to main part of data structure
	$Obj->{description}=~s/\\n/\n/g;	#substitute NL
d125 4
a128 3
$AccessObject = SOAP->GetUserDetail($ID);
my $name = LocalizedObj($AccessObject->{name},undef,$use_lang,'en');
my $desc = LocalizedObj($AccessObject->{description},undef,$use_lang,'en');
d130 1
a130 1
<table><tr><td class='neutral_bold'><img src='${skinPath}img/single.$imgType'/>&nbsp;$lang->{'Access user'}</td></tr></table>
d135 8
a142 8
	<tr><td class="neutral_bold">$lang->{'Name'}</td></tr>
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$lang->{'Access login'}</td></tr>
	<tr><td><input value="$ID" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$lang->{'Access passwd'}</td></tr>
	<tr><td><input value="" type="PASSWORD" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$lang->{'Description'}</td></tr>
	<tr><td><textarea cols="$itemWide" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
d144 1
a144 1
	<tr><td>$lang->{'Access memberOFgroup'}</td></tr>
d156 1
a156 1
			<td class="buttons"><input type="reset" name="reset" value="$lang->{'Reset'}"/></td>
d167 4
a170 3
$AccessObject = SOAP->GetGroupDetail($ID);
my $name = LocalizedObj($AccessObject->{name},undef,$use_lang,'en');
my $desc = LocalizedObj($AccessObject->{description},undef,$use_lang,'en');
d172 1
a172 1
<table><tr><td class='neutral_bold'><img src='${skinPath}img/group.$imgType'/>&nbsp;$lang->{'Access group'}</td></tr></table>
d177 4
a180 4
	<tr><td class="neutral_bold">$lang->{'Name'}</td></tr>
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
	<tr><td class="neutral_bold">$lang->{'Description'}</td></tr>
	<tr><td><textarea cols="$itemWide" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
d182 1
a182 1
	<tr><td>$lang->{'Access groupContain'}</td></tr>
d187 2
a188 2
foreach (SOAP->GetLocalizedUsersList(@@{$AccessObject->{members}})) {
			print "<option value='$AccessObject->{members}[$cnt]'>$_</option>";
d198 1
a198 1
			<td class="buttons"><input type="reset" name="reset" value="$lang->{'Reset'}"/></td>
d209 5
a213 4
&loadMetadata;
my $project = SOAP->GetProjectName($ID);
my $name = LocalizedObj($Obj->{name},undef,$use_lang,'en');
my $desc = LocalizedObj($Obj->{description},undef,$use_lang,'en');
d215 1
a215 1
<table><tr><td class='neutral_bold'><img src='${skinPath}img/role.$imgType'/>&nbsp;$lang->{'Access role'}</td></tr></table>
d220 1
a220 1
	<tr><td class="neutral_bold">$lang->{Project}</td></tr>
d222 1
a222 1
	<tr><td class="neutral_bold">$lang->{'Name'}</td></tr>
d225 2
a226 2
		<input value="$name" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/>
		<input type='hidden' value="$use_lang" name='saveLang' id='saveLang' />
d230 3
a232 3
foreach (@@Languages) {
	my $langName = LocalizedObj($Obj->{name}, "? $ID",lc($_), $DefaultLanguage);
	$selected = ($use_lang eq $_) ? " selected='selected'" : "";
d239 1
a239 1
	<tr><td class="neutral_bold">$lang->{'Description'}</td></tr>
d244 2
a245 2
			<tr><td></td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td><td style='text-align:center'>$lang->{'Duplicate'}</td></tr>
			<tr><td class='neutral_bold'>$lang->{'Right'}:</td>
d247 1
a247 1
	my $disable = ($ID =~ /root$/) ? " disabled='disabled'" : "";
d249 2
a250 2
		my $name = "rights$_";
		my $checked = ($Obj->{rights} =~ /$_/) ? "checked='checked'" : "";
d254 1
a254 1
		my $checked = ($Obj->{change}) ? "checked='checked'" : "";
d259 1
a259 1
	<tr><td title="$lang->{'Rights Change Title'}"><input$disable type='checkbox' name='Change' $checked />&nbsp;$lang->{'Rights Change'}</td></tr>
d263 2
a264 2
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}" onclick='selectSelect("ugroup","uuser")'/></td>
			<td class="buttons"><input type="button" name="reset" value="$lang->{'Reset'}" onclick="reload()"/></td>
d274 2
a275 2
		<td>$lang->{'Access Contain Group'}</td>
		<td style='text-align:right'><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{Delete}" onclick="emptySelect('ugroup')"></td>
d281 2
a282 2
	foreach (SOAP->GetLocalizedGroupsList($use_lang,@@{$Obj->{ugroup}})) {
			print "<option value='@@{$Obj->{ugroup}}[$cnt]'>$_</option>";
d290 2
a291 2
		<td>$lang->{'Access Contain User'}</td>
		<td style='text-align:right'><img class="cursor" src="${skinPath}img/delete.$imgType" title="$lang->{Delete}" onclick="emptySelect('uuser')"></td>
d296 2
a297 2
	foreach (SOAP->GetLocalizedUsersList(@@{$Obj->{uuser}})) { 
			print "<option value='@@{$Obj->{uuser}}[$cnt]'>$_</option>";
d323 1
@


1.16
log
@description tab defined under two files, bug fixies
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.15 2003/09/29 09:21:54 jiri_schmid Exp $
d15 1
a15 1
require "local_lib.pl";
@


1.15
log
@code improvments a fixies
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.14 2003/09/15 13:04:03 jiri_schmid Exp $
d218 1
d221 2
a222 1
	print "<option value='$langName'>$_</option>";
@


1.14
log
@code changes and improvments
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.13 2003/09/09 09:41:30 jiri_schmid Exp $
d210 1
a210 1
	<tr><td><input value="$project" type="text" id="PROJECT" style='width:100%' readonly='readonly'/></td></tr>
d234 1
a234 1
	my $disable = ($ID eq 'root') ? " disabled='disabled'" : "";
@


1.13
log
@ACL for facts and attrs implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.12 2003/09/01 12:40:02 jiri_schmid Exp $
d38 1
a38 1
	-onload=>"initVars(2)",
d67 1
d76 1
d103 1
@


1.12
log
@skins implemented. mozilla skin - temporarily copy msie content
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.11 2003/08/26 15:35:41 jiri_schmid Exp $
d258 1
a258 1
		<td>$lang->{'Access groupContain'}</td>
d274 1
a274 1
		<td>$lang->{'Access groupContain'}</td>
@


1.11
log
@rights improvment, create delete duplicate rule implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.10 2003/08/22 16:00:53 jiri_schmid Exp $
d19 4
d37 1
a37 1
	-style=>{-src=>'css.css'},
d72 1
d118 1
a118 1
<table><tr><td class='neutral_bold'><img src='img/single.gif'/>&nbsp;$lang->{'Access user'}</td></tr></table>
d159 1
a159 1
<table><tr><td class='neutral_bold'><img src='img/group.gif'/>&nbsp;$lang->{'Access group'}</td></tr></table>
d201 1
a201 1
<table><tr><td class='neutral_bold'><img src='img/role.gif'/>&nbsp;$lang->{'Access role'}</td></tr></table>
d259 1
a259 1
		<td style='text-align:right'><img class="cursor" src="img/delete.gif" title="$lang->{Delete}" onclick="emptySelect('ugroup')"></td>
d275 1
a275 1
		<td style='text-align:right'><img class="cursor" src="img/delete.gif" title="$lang->{Delete}" onclick="emptySelect('uuser')"></td>
@


1.10
log
@access - rules changing implemented
@
text
@d3 1
a3 1
#  Folder Display
d5 1
a5 1
# $Id: access_obj.cgi,v 1.9 2003/08/21 14:23:28 jiri_schmid Exp $
d87 1
a87 1
foreach ('R','W','E') {
d92 1
d202 1
a202 1
	<tr><td><input value="$project" type="text" id="PROJECT" size="$name_w" readonly='readonly'/></td></tr>
d206 1
a206 1
		<input value="$name" type="text" name="name" id="NAME" size="$nameWide" maxlength="100"/>
d219 1
a219 1
	<tr><td><textarea cols="$itemWide" rows="3" name="desc" id="DESC">$desc</textarea></td></tr>
d223 1
a223 1
			<tr><td></td><td style='text-align:center'>&nbsp;$lang->{'Read'}&nbsp;</td><td style='text-align:center'>$lang->{'Execute'}</td><td style='text-align:center'>&nbsp;$lang->{'Write'}&nbsp;</td></tr>
d226 2
a227 1
	foreach ('R','W','E') {
d230 1
a230 1
		my $disable = ($ID eq 'root') ? " disabled='disabled'" : "";
d233 1
d238 1
@


1.9
log
@role implementation next step
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.8 2003/08/21 12:02:01 jiri_schmid Exp $
a74 1
print &endform;
d77 1
a77 1

d86 8
d137 1
a137 1
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}"/></td>
d141 1
a141 1
	<td></tr>
d165 1
a165 1
		<select multiple='multiple' style='width:100%'>
d167 5
a171 3
		foreach (@@{$AccessObject->{members}}) {
			print "<option>$_</option>";
		}
d178 1
a178 1
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}"/></td>
d182 1
a182 1
	<td></tr>
d206 1
a206 1
		<input type='hidden' value="$use_lang" name='saveLang' id='saveLang'/>
a219 1
	<tr><td>$lang->{'Access groupContain'}</td></tr>
d221 13
a233 5
		<select multiple='multiple' style='width:100%'>
			<option>Ja</option>
			<option>Mne</option>
			<option>Id</option>
		</select>
d236 1
a236 1
	<tr><td align='center'>
d238 2
a239 2
		<tr>	<td class="buttons"><input type="submit" name="Action" value="$lang->{'Save'}"/></td>
			<td class="buttons"><input type="reset" name="reset" value="$lang->{'Reset'}"/></td>
d242 36
a277 1
	<td></tr>
@


1.8
log
@description for access tree changes
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.7 2003/08/19 13:05:55 jiri_schmid Exp $
d11 1
a11 1
use vars qw($lang $Languages $name_w $descr_w $itemWide $bearHost $bearPort);
d59 6
a64 1
&doWork if param('Action');
d83 5
a87 1
my $fullObj = 
a91 1
	my $ID = shift;
d181 1
a181 6
my ($FullObj, $Obj);
if ($ID) {
	$FullObj = SOAP->GetMetadata($ID);
	$Obj = $FullObj->{urole}->{$ID};	#ptr to main part of data structure
	$Obj->{description}=~s/\\n/\n/g;	#substitute NL
}
d185 1
a185 1
print <<END
d194 14
a207 1
	<tr><td><input value="$name" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
@


1.7
log
@formats2d implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.6 2003/08/18 13:17:09 jiri_schmid Exp $
d19 1
a19 1
my $use_lang = param('Lang');
d21 1
a21 1
my $type = param('Type');
d38 7
a44 7
	eval "use SOAP::Lite +autodispatch => 
		uri => 'Bear', 
		proxy => ['http://$bearHost:$bearPort/', 
		options => {compress_threshold => 10000}],
		encoding => 'UTF-8';	
		1"
	or ( &ErrorDie("ERROR in eval of \"use SOAP::Lite ...\".") );
d46 1
a46 1
	my $serverVerbName="SOAP Server http://$bearHost:$bearPort/";
d48 3
a50 3
	if (! eval "SOAP::Lite->self->fault") {
		ErrorDie('ERROR: '.$serverVerbName.' not responding<br><form><input type="submit" name="Refresh" value="Refresh" /></form>');
	}
d57 1
d59 7
d76 13
d173 9
d189 1
a189 1
	<tr><td><input value="" type="text" id="PROJECT" size="$name_w" readonly='readonly'/></td></tr>
d191 1
a191 1
	<tr><td><input value="" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
d193 1
a193 1
	<tr><td><textarea cols="$itemWide" rows="3" name="desc" id="DESC"></textarea></td></tr>
d228 3
@


1.6
log
@admin page reading rutines implemented
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.5 2003/08/14 12:43:47 jiri_schmid Exp $
a61 1
else {print "tuuuuudle"}
@


1.5
log
@huge code, minor functionality and design improvment on main tree
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.4 2003/08/13 13:16:25 jiri_schmid Exp $
d11 1
a11 1
use vars qw($lang $Languages $name_w $descr_w $itemWide);
d37 15
d54 5
a58 1
print startform(-action=>'', -name=>'user');
d73 3
d83 1
a83 1
	<tr><td><input value="" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
d85 1
a85 1
	<tr><td><input value="" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
d89 1
a89 1
	<tr><td><textarea cols="$itemWide" rows="3" name="desc" id="DESC"></textarea></td></tr>
d93 4
a96 5
		<select multiple='multiple'>
			<option>Admin</option>
			<option>Root</option>
			<option>SuperRoot</option>
			<option>SuperAdmin</option>
d114 4
a117 1
print <<END
d124 1
a124 1
	<tr><td><input value="" type="text" name="name" id="NAME" size="$name_w" maxlength="100"/></td></tr>
d126 1
a126 1
	<tr><td><textarea cols="$itemWide" rows="3" name="desc" id="DESC"></textarea></td></tr>
d130 6
a135 4
		<select multiple='multiple'>
			<option>Ja</option>
			<option>Mne</option>
			<option>Id</option>
d168 1
a168 1
		<select multiple='multiple'>
@


1.4
log
@setting up rights inetrface for each object implemnted
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.3 2003/08/12 11:09:26 jiri_schmid Exp $
d39 1
d44 1
a44 1

d78 8
a86 2
	

a87 1

d112 8
a120 1

d148 8
a156 1

@


1.3
log
@minor changes
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.2 2003/08/12 09:19:16 jiri_schmid Exp $
d38 1
a38 7
my $title = "Access $type";
print <<END;
<table><tr><td class='neutral_bold'>$lang->{$title}</td></tr></table>
<table class="page_skeleton">
<tr class="page_skeleton">
<td class="page_skeleton">
END
d54 4
a57 1

d88 4
d115 4
@


1.2
log
@ACL implementation, datas moved into beard"s caches
@
text
@d5 1
a5 1
# $Id: access_obj.cgi,v 1.1 2003/08/11 13:51:26 jiri_schmid Exp $
a27 1
	-class=>"$type",
d46 2
a47 2
elsif ($type eq 'group') { &generateGroupRule }
elsif ($type eq 'role') { &generateGroupRule }
d89 1
a89 1
sub generateGroupRule {
d92 25
@


1.1
log
@necessary files for admin page added
@
text
@d5 1
a5 1
# $Id: access.cgi,v 1.2 2003/08/11 12:30:56 jiri_schmid Exp $
d48 1
a48 1
elsif ($type eq 'rule') { &generateGroupRule }
@

